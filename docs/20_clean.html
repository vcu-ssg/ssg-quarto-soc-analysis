<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Analysis of Teaching - Cleaning the data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Analysis of Teaching</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./10_download.html" rel="" target="">
 <span class="menu-text">Download</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./20_clean.html" rel="" target="" aria-current="page">
 <span class="menu-text">Clean</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./30_explore.html" rel="" target="">
 <span class="menu-text">Explore</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-sources" id="toc-data-sources" class="nav-link active" data-scroll-target="#data-sources">Data sources</a></li>
  <li><a href="#data-cleaning" id="toc-data-cleaning" class="nav-link" data-scroll-target="#data-cleaning">Data Cleaning</a>
  <ul class="collapse">
  <li><a href="#combining-to-single-data-frame" id="toc-combining-to-single-data-frame" class="nav-link" data-scroll-target="#combining-to-single-data-frame">Combining to single data frame</a></li>
  <li><a href="#merge-in-the-term-and-period-data-from-the-xlsx_df-dataframe" id="toc-merge-in-the-term-and-period-data-from-the-xlsx_df-dataframe" class="nav-link" data-scroll-target="#merge-in-the-term-and-period-data-from-the-xlsx_df-dataframe">Merge in the term and period data from the xlsx_df dataframe</a></li>
  <li><a href="#fix-known-errors" id="toc-fix-known-errors" class="nav-link" data-scroll-target="#fix-known-errors">Fix known errors</a></li>
  <li><a href="#reshape-the-data" id="toc-reshape-the-data" class="nav-link" data-scroll-target="#reshape-the-data">Reshape the data</a></li>
  <li><a href="#clean-up-rows" id="toc-clean-up-rows" class="nav-link" data-scroll-target="#clean-up-rows">Clean up rows</a></li>
  <li><a href="#add-additional-columns" id="toc-add-additional-columns" class="nav-link" data-scroll-target="#add-additional-columns">Add additional columns</a></li>
  <li><a href="#merge-persistent-instructor-data" id="toc-merge-persistent-instructor-data" class="nav-link" data-scroll-target="#merge-persistent-instructor-data">Merge persistent instructor data</a></li>
  <li><a href="#merge-persistent-course-data" id="toc-merge-persistent-course-data" class="nav-link" data-scroll-target="#merge-persistent-course-data">Merge persistent course data</a></li>
  <li><a href="#identify-shared-rooms" id="toc-identify-shared-rooms" class="nav-link" data-scroll-target="#identify-shared-rooms">Identify shared rooms</a></li>
  <li><a href="#find-all-courses-taught-by-same-instructor-at-the-same-time" id="toc-find-all-courses-taught-by-same-instructor-at-the-same-time" class="nav-link" data-scroll-target="#find-all-courses-taught-by-same-instructor-at-the-same-time">Find all courses taught by same instructor at the same time</a></li>
  <li><a href="#cgep-convert-to-ind-rather-than-lec-from-workload-perspective" id="toc-cgep-convert-to-ind-rather-than-lec-from-workload-perspective" class="nav-link" data-scroll-target="#cgep-convert-to-ind-rather-than-lec-from-workload-perspective">CGEP: convert to IND rather than LEC from workload perspective</a></li>
  <li><a href="#add-a-bunch-of-spare-columns" id="toc-add-a-bunch-of-spare-columns" class="nav-link" data-scroll-target="#add-a-bunch-of-spare-columns">Add a bunch of spare columns</a></li>
  <li><a href="#compute-appropriate-aggregate-measures" id="toc-compute-appropriate-aggregate-measures" class="nav-link" data-scroll-target="#compute-appropriate-aggregate-measures">Compute appropriate aggregate measures</a></li>
  <li><a href="#placeholder-workload-model-assignments" id="toc-placeholder-workload-model-assignments" class="nav-link" data-scroll-target="#placeholder-workload-model-assignments">Placeholder Workload model assignments</a></li>
  </ul></li>
  <li><a href="#sample-workload-model" id="toc-sample-workload-model" class="nav-link" data-scroll-target="#sample-workload-model">Sample workload model</a>
  <ul class="collapse">
  <li><a href="#assign-base-workload-to-all-sections" id="toc-assign-base-workload-to-all-sections" class="nav-link" data-scroll-target="#assign-base-workload-to-all-sections">Assign BASE workload to all sections</a></li>
  <li><a href="#adjust-for-courses-taught-at-same-time-by-same-instructor" id="toc-adjust-for-courses-taught-at-same-time-by-same-instructor" class="nav-link" data-scroll-target="#adjust-for-courses-taught-at-same-time-by-same-instructor">Adjust for courses taught at same time by same instructor</a></li>
  <li><a href="#distinguish-capstone-workloads" id="toc-distinguish-capstone-workloads" class="nav-link" data-scroll-target="#distinguish-capstone-workloads">Distinguish capstone workloads</a></li>
  <li><a href="#distinguish-vip-workloads" id="toc-distinguish-vip-workloads" class="nav-link" data-scroll-target="#distinguish-vip-workloads">Distinguish VIP workloads</a></li>
  <li><a href="#distinguish-lab-workloads" id="toc-distinguish-lab-workloads" class="nav-link" data-scroll-target="#distinguish-lab-workloads">Distinguish LAB workloads</a></li>
  <li><a href="#distinguish-res-ind-and-fld" id="toc-distinguish-res-ind-and-fld" class="nav-link" data-scroll-target="#distinguish-res-ind-and-fld">Distinguish RES, IND and FLD</a></li>
  <li><a href="#distinguish-sem-workloads" id="toc-distinguish-sem-workloads" class="nav-link" data-scroll-target="#distinguish-sem-workloads">Distinguish SEM workloads</a></li>
  <li><a href="#adjust-for-large-lectures" id="toc-adjust-for-large-lectures" class="nav-link" data-scroll-target="#adjust-for-large-lectures">Adjust for large lectures</a></li>
  <li><a href="#checks-and-verfications" id="toc-checks-and-verfications" class="nav-link" data-scroll-target="#checks-and-verfications">Checks and verfications</a></li>
  </ul></li>
  <li><a href="#store-the-dataframe" id="toc-store-the-dataframe" class="nav-link" data-scroll-target="#store-the-dataframe">Store the dataframe</a>
  <ul class="collapse">
  <li><a href="#store-to-a-local-csv-file" id="toc-store-to-a-local-csv-file" class="nav-link" data-scroll-target="#store-to-a-local-csv-file">Store to a local CSV file</a></li>
  <li><a href="#store-the-data-in-google-sheets" id="toc-store-the-data-in-google-sheets" class="nav-link" data-scroll-target="#store-the-data-in-google-sheets">Store the data in google sheets</a></li>
  <li><a href="#freshen-persistent-instructor-data" id="toc-freshen-persistent-instructor-data" class="nav-link" data-scroll-target="#freshen-persistent-instructor-data">Freshen persistent instructor data</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Cleaning the data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>This script describes the data and walks through a process of data cleaning.</p>
<p>At completion of this script all the individual semester data files will be combined into a single dataframe for analysis, and the dataframe will be refactored for cleaner analysis.</p>
<section id="data-sources" class="level2">
<h2 class="anchored" data-anchor-id="data-sources">Data sources</h2>
<p>The files are named appropriately and stored in the <em>data</em> folder in this repository.</p>
<div class="cell" data-execution_count="1">
<div class="cell-output cell-output-display" data-execution_count="1">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">File name</th>
<th style="text-align: left;">Term Code</th>
<th style="text-align: left;">Acad Year</th>
<th style="text-align: left;">Period Code</th>
<th style="text-align: left;">Period Name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">VCU-SOC-202110-FA2020.xlsx</td>
<td style="text-align: left;">202110</td>
<td style="text-align: left;">AY20-21</td>
<td style="text-align: left;">FA2020</td>
<td style="text-align: left;">Fall 2020</td>
</tr>
<tr class="even">
<td style="text-align: left;">VCU-SOC-202120-SP2021.xlsx</td>
<td style="text-align: left;">202120</td>
<td style="text-align: left;">AY20-21</td>
<td style="text-align: left;">SP2021</td>
<td style="text-align: left;">Spring 2021</td>
</tr>
<tr class="odd">
<td style="text-align: left;">VCU-SOC-202130-SU2021.xlsx</td>
<td style="text-align: left;">202130</td>
<td style="text-align: left;">AY20-21</td>
<td style="text-align: left;">SU2021</td>
<td style="text-align: left;">Summer 2021</td>
</tr>
<tr class="even">
<td style="text-align: left;">VCU-SOC-202210-FA2021.xlsx</td>
<td style="text-align: left;">202210</td>
<td style="text-align: left;">AY21-22</td>
<td style="text-align: left;">FA2021</td>
<td style="text-align: left;">Fall 2021</td>
</tr>
<tr class="odd">
<td style="text-align: left;">VCU-SOC-202220-SP2022.xlsx</td>
<td style="text-align: left;">202220</td>
<td style="text-align: left;">AY21-22</td>
<td style="text-align: left;">SP2022</td>
<td style="text-align: left;">Spring 2022</td>
</tr>
<tr class="even">
<td style="text-align: left;">VCU-SOC-202230-SU2022.xlsx</td>
<td style="text-align: left;">202230</td>
<td style="text-align: left;">AY21-22</td>
<td style="text-align: left;">SU2022</td>
<td style="text-align: left;">Summer 2022</td>
</tr>
<tr class="odd">
<td style="text-align: left;">VCU-SOC-202310-FA2022.xlsx</td>
<td style="text-align: left;">202310</td>
<td style="text-align: left;">AY22-23</td>
<td style="text-align: left;">FA2022</td>
<td style="text-align: left;">Fall 2022</td>
</tr>
<tr class="even">
<td style="text-align: left;">VCU-SOC-202320-SP2023.xlsx</td>
<td style="text-align: left;">202320</td>
<td style="text-align: left;">AY22-23</td>
<td style="text-align: left;">SP2023</td>
<td style="text-align: left;">Spring 2023</td>
</tr>
<tr class="odd">
<td style="text-align: left;">VCU-SOC-202330-SU2023.xlsx</td>
<td style="text-align: left;">202330</td>
<td style="text-align: left;">AY22-23</td>
<td style="text-align: left;">SU2023</td>
<td style="text-align: left;">Summer 2023</td>
</tr>
<tr class="even">
<td style="text-align: left;">VCU-SOC-202410-FA2023.xlsx</td>
<td style="text-align: left;">202410</td>
<td style="text-align: left;">AY23-24</td>
<td style="text-align: left;">FA2023</td>
<td style="text-align: left;">Fall 2023</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="data-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="data-cleaning">Data Cleaning</h2>
<p>The following sections combine the individual sources of data and clean them up.</p>
<section id="combining-to-single-data-frame" class="level3">
<h3 class="anchored" data-anchor-id="combining-to-single-data-frame">Combining to single data frame</h3>
<p>The following section combines each XLSX into a single data frame. The contents of the files are variable in length depending on the number of sections taught during any given semester.</p>
<p>The appropriate block starts one row after the row with the keyword <em>TERM</em> in the first column, denoting the header row. The appropriate block ends with the row prior to the row with the keyword <em>N =</em>.</p>
<p>We’re assuming that all xlsx workbooks share the same columns and names.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty list to store trimmed DataFrames</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>trimmed_dfs <span class="op">=</span> []</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate through the list of XLSX file names</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> file_name <span class="kw">in</span> xlsx_df[<span class="st">'file_name'</span>]:</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load the XLSX file into a DataFrame</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    full_path <span class="op">=</span> os.path.join(directory_path, file_name)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_excel(full_path)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the row index where "TERM" is in the first column</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    term_index <span class="op">=</span> df.index[df.iloc[:, <span class="dv">0</span>] <span class="op">==</span> <span class="st">"TERM"</span>].tolist()[<span class="dv">0</span>]</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the row index where "N=" is in the first column</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    n_index <span class="op">=</span> df.index[df.iloc[:, <span class="dv">0</span>].<span class="bu">str</span>.startswith(<span class="st">"N ="</span>).fillna(<span class="va">False</span>)].tolist()[<span class="dv">0</span>]</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clip the desired block and add column names</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    trimmed_df <span class="op">=</span> df.loc[term_index <span class="op">+</span> <span class="dv">1</span> : n_index <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    trimmed_df.columns <span class="op">=</span> df.iloc[term_index].values</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Append the trimmed DataFrame to the list</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    trimmed_dfs.append(trimmed_df)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the individual dataframes into one big one.</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>sections_df <span class="op">=</span> pd.concat(trimmed_dfs, ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="merge-in-the-term-and-period-data-from-the-xlsx_df-dataframe" class="level3">
<h3 class="anchored" data-anchor-id="merge-in-the-term-and-period-data-from-the-xlsx_df-dataframe">Merge in the term and period data from the xlsx_df dataframe</h3>
<p>The following code merges in the term and period data with the section data. First ensure that the key columns are strings, then merge away.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>sections_df[<span class="st">'SECT'</span>] <span class="op">=</span> sections_df[<span class="st">'SECT'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>sections_df[<span class="st">'TERM'</span>] <span class="op">=</span> sections_df[<span class="st">'TERM'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>xlsx_df[<span class="st">'term_code'</span>] <span class="op">=</span> xlsx_df[<span class="st">'term_code'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>sections_df <span class="op">=</span> pd.merge(sections_df,xlsx_df,left_on<span class="op">=</span><span class="st">'TERM'</span>, right_on<span class="op">=</span><span class="st">'term_code'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fix-known-errors" class="level3">
<h3 class="anchored" data-anchor-id="fix-known-errors">Fix known errors</h3>
<p>The data in Banner doesn’t always reflect reality. This step corrects known errors in the data.</p>
<p>Note that the section data are stored one row per term-crn-meeting period.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Spring 2023: CMSC475 John Leonard taught for David Shepherd</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>fix(<span class="dv">1</span>,<span class="st">'Swap Leonard for Shepherd'</span>,{<span class="st">'TERM'</span>:<span class="st">'202320'</span>,<span class="st">'CRN'</span>:<span class="st">'43471'</span>},{<span class="st">'PRIMARY INSTRUCTOR FIRST NAME'</span>:<span class="st">'John'</span>,<span class="st">'PRIMARY INSTRUCTOR LAST NAME'</span>:<span class="st">'Leonard'</span>})</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fall 2024: CMSC391 is cross listed with COAR463.</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Total enrollment 34 across two instructors (Bennett and Leonard)</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Currently Banner shows only 20 in the JL section and doesn't mention the COAR section.</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>fix(<span class="dv">2</span>,<span class="st">'Fix incorrect cross listing'</span>,{<span class="st">'TERM'</span>:<span class="st">'202410'</span>,<span class="st">'CRN'</span>:<span class="st">'46263'</span>},{<span class="st">'ACTUAL ENROLLMENT'</span>:<span class="dv">34</span>})</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>fix(<span class="dv">3</span>,<span class="st">"Remove Duke as 2nd instructor"</span>,{<span class="st">'TERM'</span>:<span class="st">'202410'</span>,<span class="st">'CRN'</span>:<span class="st">'40553'</span>},{<span class="st">'SECONDARY INSTRUCTOR FIRST NAME'</span>:<span class="st">''</span>,<span class="st">'SECONDARY INSTRUCTOR LAST NAME'</span>:<span class="st">''</span>})</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>fix(<span class="dv">4</span>,<span class="st">"Remove Duke as 2nd instructor"</span>,{<span class="st">'TERM'</span>:<span class="st">'202410'</span>,<span class="st">'CRN'</span>:<span class="st">'40554'</span>},{<span class="st">'SECONDARY INSTRUCTOR FIRST NAME'</span>:<span class="st">''</span>,<span class="st">'SECONDARY INSTRUCTOR LAST NAME'</span>:<span class="st">''</span>})</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>fix(<span class="dv">5</span>,<span class="st">"Remove Duke as 2nd instructor"</span>,{<span class="st">'TERM'</span>:<span class="st">'202410'</span>,<span class="st">'CRN'</span>:<span class="st">'40555'</span>},{<span class="st">'SECONDARY INSTRUCTOR FIRST NAME'</span>:<span class="st">''</span>,<span class="st">'SECONDARY INSTRUCTOR LAST NAME'</span>:<span class="st">''</span>})</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>fix(<span class="dv">6</span>,<span class="st">"Remove Sparks as 2nd instructor"</span>,{<span class="st">'TERM'</span>:<span class="st">'202320'</span>,<span class="st">'CRN'</span>:<span class="st">'17442'</span>},{<span class="st">'SECONDARY INSTRUCTOR FIRST NAME'</span>:<span class="st">''</span>,<span class="st">'SECONDARY INSTRUCTOR LAST NAME'</span>:<span class="st">''</span>})</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>fix(<span class="dv">7</span>,<span class="st">"Remove Duke as 2nd instructor"</span>,{<span class="st">'TERM'</span>:<span class="st">'202320'</span>,<span class="st">'CRN'</span>:<span class="st">'33698'</span>},{<span class="st">'SECONDARY INSTRUCTOR FIRST NAME'</span>:<span class="st">''</span>,<span class="st">'SECONDARY INSTRUCTOR LAST NAME'</span>:<span class="st">''</span>})</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>fix(<span class="dv">8</span>,<span class="st">"Remove Duke as 2nd instructor"</span>,{<span class="st">'TERM'</span>:<span class="st">'202320'</span>,<span class="st">'CRN'</span>:<span class="st">'41891'</span>},{<span class="st">'SECONDARY INSTRUCTOR FIRST NAME'</span>:<span class="st">''</span>,<span class="st">'SECONDARY INSTRUCTOR LAST NAME'</span>:<span class="st">''</span>})</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>fix(<span class="dv">9</span>,<span class="st">"Capstone common course is LEC not SEM"</span>,{<span class="st">'TERM'</span>:<span class="st">'202320'</span>,<span class="st">'CRN'</span>:<span class="st">'45290'</span>},{<span class="st">'TYPE'</span>:<span class="st">'LEC'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="reshape-the-data" class="level3">
<h3 class="anchored" data-anchor-id="reshape-the-data">Reshape the data</h3>
<p>The current dataframe <em>sections_df</em> contains one record per term-crn-meeting period tuple. Within each tuple there can be up to 2 instructors. We need to reshape the data with the instructors in a single column.</p>
<p>While we’re here we can combine instructor first and last name, and drop verbose columns.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> sections_df.columns</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>values_to_remove <span class="op">=</span> [<span class="st">'PRIMARY INSTRUCTOR FIRST NAME'</span>,<span class="st">'PRIMARY INSTRUCTOR LAST NAME'</span>,<span class="st">'SECONDARY INSTRUCTOR FIRST NAME'</span>,<span class="st">'SECONDARY INSTRUCTOR LAST NAME'</span>]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> cols <span class="cf">if</span> x <span class="kw">not</span> <span class="kw">in</span> values_to_remove]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>sections_df[<span class="st">'ins1_last'</span>] <span class="op">=</span> sections_df[<span class="st">'PRIMARY INSTRUCTOR LAST NAME'</span>]</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>sections_df[<span class="st">'ins1_first'</span>] <span class="op">=</span> sections_df[<span class="st">'PRIMARY INSTRUCTOR FIRST NAME'</span>]</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>sections_df[<span class="st">'ins2_last'</span>] <span class="op">=</span> sections_df[<span class="st">'SECONDARY INSTRUCTOR LAST NAME'</span>]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>sections_df[<span class="st">'ins2_first'</span>] <span class="op">=</span> sections_df[<span class="st">'SECONDARY INSTRUCTOR FIRST NAME'</span>]</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>sections_df[<span class="st">'instructor_1'</span>] <span class="op">=</span> sections_df[<span class="st">'ins1_last'</span>]<span class="op">+</span>sections_df[<span class="st">'ins1_first'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">','</span> <span class="cf">if</span> x <span class="op">!=</span> <span class="st">""</span> <span class="cf">else</span> <span class="st">""</span>)<span class="op">+</span>sections_df[<span class="st">'ins1_first'</span>]</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>sections_df[<span class="st">'instructor_2'</span>] <span class="op">=</span> sections_df[<span class="st">'ins2_last'</span>]<span class="op">+</span>sections_df[<span class="st">'ins2_first'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">','</span> <span class="cf">if</span> x <span class="op">!=</span> <span class="st">""</span> <span class="cf">else</span> <span class="st">""</span>)<span class="op">+</span>sections_df[<span class="st">'ins2_first'</span>]</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>sections_df[<span class="st">'instructor_1'</span>].fillna(<span class="st">''</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>sections_df[<span class="st">'instructor_2'</span>].fillna(<span class="st">''</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>stacked_df <span class="op">=</span> pd.melt(sections_df,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    id_vars<span class="op">=</span>cols,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    value_vars<span class="op">=</span>[<span class="st">'instructor_1'</span>,<span class="st">'instructor_2'</span>],</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    var_name<span class="op">=</span><span class="st">'instructor source'</span>,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    value_name<span class="op">=</span><span class="st">'instructor'</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="clean-up-rows" class="level3">
<h3 class="anchored" data-anchor-id="clean-up-rows">Clean up rows</h3>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove rows with empty instructor 1.  Keep rows with empty instructor 1.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>stacked_df <span class="op">=</span> stacked_df[ <span class="op">~</span> ((stacked_df[<span class="st">'instructor source'</span>]<span class="op">==</span><span class="st">'instructor_2'</span>) <span class="op">&amp;</span> (stacked_df[<span class="st">'instructor'</span>]<span class="op">==</span><span class="st">''</span>)) ]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># replace any missing instructors with note</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[stacked_df[<span class="st">"instructor"</span>].isin([<span class="st">''</span>]),<span class="st">"instructor"</span>] <span class="op">=</span> stacked_df[stacked_df[<span class="st">"instructor"</span>].isin([<span class="st">''</span>])][<span class="st">'COURSE'</span>]<span class="op">+</span><span class="st">' '</span><span class="op">+</span>stacked_df[stacked_df[<span class="st">"instructor"</span>].isin([<span class="st">''</span>])][<span class="st">'TERM'</span>]<span class="op">+</span><span class="st">' '</span><span class="op">+</span>stacked_df[stacked_df[<span class="st">"instructor"</span>].isin([<span class="st">''</span>])][<span class="st">'CRN'</span>]</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># drop rows with zero enrollments</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>stacked_df <span class="op">=</span> stacked_df[stacked_df[<span class="st">'ACTUAL ENROLLMENT'</span>]<span class="op">&gt;</span><span class="dv">0</span>]</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort the data frame so it looks pretty in the output file.</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>stacked_df <span class="op">=</span> stacked_df.sort_values([<span class="st">'TERM'</span>,<span class="st">'DEPT'</span>,<span class="st">'COURSE'</span>,<span class="st">'SECT'</span>,<span class="st">'instructor source'</span>,<span class="st">'instructor'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="add-additional-columns" class="level3">
<h3 class="anchored" data-anchor-id="add-additional-columns">Add additional columns</h3>
<p>We may need the subject and the course number in the workload model analysis.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">"course_subject"</span>] <span class="op">=</span> stacked_df[<span class="st">"COURSE"</span>].<span class="bu">str</span>[:<span class="dv">4</span>]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">"course_number"</span>] <span class="op">=</span> stacked_df[<span class="st">"COURSE"</span>].<span class="bu">str</span>[<span class="dv">4</span>:]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of instructors sharing a common CRN.</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">"instructor_cnt"</span>] <span class="op">=</span> stacked_df.groupby([<span class="st">'TERM'</span>,<span class="st">'COURSE'</span>,<span class="st">'CRN'</span>])[<span class="st">'CRN'</span>].transform(<span class="st">'count'</span>) <span class="op">/</span> stacked_df.groupby([<span class="st">'TERM'</span>,<span class="st">'COURSE'</span>,<span class="st">'CRN'</span>,<span class="st">'instructor'</span>])[<span class="st">'instructor'</span>].transform(<span class="st">'count'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="merge-persistent-instructor-data" class="level3">
<h3 class="anchored" data-anchor-id="merge-persistent-instructor-data">Merge persistent instructor data</h3>
<p>We’re storing some of the results in google sheets. Further, we’re using google sheets to store persistent data not found in the VCU course schedule report.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define scope</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>scope <span class="op">=</span> [<span class="st">'https://spreadsheets.google.com/feeds'</span>, <span class="st">'https://www.googleapis.com/auth/drive'</span>]</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create credentials object</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>credential_file <span class="op">=</span> os.path.join(os.path.expanduser(<span class="st">"~"</span>), <span class="st">".gsecrets"</span>, <span class="st">"gsheets-credentials.json"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.isfile( credential_file ):</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Missing credential file:"</span>,credential_file)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  sys.exit()</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># authorize the client</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>creds <span class="op">=</span> ServiceAccountCredentials.from_json_keyfile_name(credential_file, scope)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> gspread.authorize(creds)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>spreadsheet_key <span class="op">=</span> <span class="st">"1ZK7k8M85CXLof6FdeJYJuGFbfjsOXrCv5mc7OgUInWw"</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>worksheet_name <span class="op">=</span> <span class="st">"Instructor data"</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>sheet <span class="op">=</span> client.open_by_key(spreadsheet_key).worksheet(worksheet_name)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>instructor_df <span class="op">=</span> get_as_dataframe(worksheet<span class="op">=</span>sheet, evaluate_formulas<span class="op">=</span><span class="va">True</span> )</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>stacked_df <span class="op">=</span> pd.merge( stacked_df,instructor_df,left_on<span class="op">=</span><span class="st">'instructor'</span>,right_on<span class="op">=</span><span class="st">'instructor'</span>,how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>worksheet_name <span class="op">=</span> <span class="st">"Instructor notes"</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>sheet <span class="op">=</span> client.open_by_key(spreadsheet_key).worksheet(worksheet_name)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>instructor_notes_df <span class="op">=</span> get_as_dataframe(worksheet<span class="op">=</span>sheet, evaluate_formulas<span class="op">=</span><span class="va">True</span> )</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>stacked_df <span class="op">=</span> pd.merge( stacked_df,instructor_notes_df,left_on<span class="op">=</span><span class="st">'instructor'</span>,right_on<span class="op">=</span><span class="st">'instructor'</span>,how<span class="op">=</span><span class="st">'left'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="merge-persistent-course-data" class="level3">
<h3 class="anchored" data-anchor-id="merge-persistent-course-data">Merge persistent course data</h3>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># spreadsheet_key = "1ZK7k8M85CXLof6FdeJYJuGFbfjsOXrCv5mc7OgUInWw" from above!</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>worksheet_name <span class="op">=</span> <span class="st">"Course notes"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>sheet <span class="op">=</span> client.open_by_key(spreadsheet_key).worksheet(worksheet_name)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>course_notes_df <span class="op">=</span> get_as_dataframe(worksheet<span class="op">=</span>sheet, evaluate_formulas<span class="op">=</span><span class="va">True</span> )</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>stacked_df <span class="op">=</span> pd.merge( stacked_df,course_notes_df,left_on<span class="op">=</span><span class="st">'COURSE'</span>,right_on<span class="op">=</span><span class="st">'crse'</span>,how<span class="op">=</span><span class="st">'left'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="identify-shared-rooms" class="level3">
<h3 class="anchored" data-anchor-id="identify-shared-rooms">Identify shared rooms</h3>
<p>Many larger courses comprise of multiple CRN sharing a single classroom period. We need to identify unique combinations of days of week and rooms and assign store these for later aggregation.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>time_cols <span class="op">=</span> [<span class="st">'MON-IND'</span>,<span class="st">'TUE-IND'</span>,<span class="st">'WED-IND'</span>,<span class="st">'THU-IND'</span>,<span class="st">'FRI-IND'</span>,<span class="st">'SAT-IND'</span>,<span class="st">'SUN-IND'</span>,<span class="st">'BEGIN TIME'</span>,<span class="st">'END TIME'</span>]</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>room_cols <span class="op">=</span> [<span class="st">'BUILDING'</span>,<span class="st">'ROOM'</span>]</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">"time_code"</span>] <span class="op">=</span> <span class="st">""</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> time_cols:</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    stacked_df[col] <span class="op">=</span> stacked_df[col].fillna(<span class="st">'.'</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    stacked_df[<span class="st">"time_code"</span>] <span class="op">=</span> stacked_df[<span class="st">"time_code"</span>] <span class="op">+</span> stacked_df[col].astype(<span class="bu">str</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'time_id'</span>] <span class="op">=</span> pd.factorize(stacked_df[<span class="st">'time_code'</span>])[<span class="dv">0</span>]</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">"room_code"</span>] <span class="op">=</span> <span class="st">""</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> room_cols:</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    stacked_df[col] <span class="op">=</span> stacked_df[col].fillna(<span class="st">'.'</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    stacked_df[<span class="st">"room_code"</span>] <span class="op">=</span> stacked_df[<span class="st">"room_code"</span>] <span class="op">+</span> stacked_df[col].astype(<span class="bu">str</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'room_id'</span>] <span class="op">=</span> pd.factorize(stacked_df[<span class="st">'room_code'</span>])[<span class="dv">0</span>]</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">"meeting_code"</span>] <span class="op">=</span> stacked_df[<span class="st">"room_code"</span>] <span class="op">+</span> stacked_df[<span class="st">"time_code"</span>]</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'meeting_id'</span>] <span class="op">=</span> pd.factorize(stacked_df[<span class="st">'meeting_code'</span>])[<span class="dv">0</span>]</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>day_cols <span class="op">=</span> [<span class="st">'MON-IND'</span>,<span class="st">'TUE-IND'</span>,<span class="st">'WED-IND'</span>,<span class="st">'THU-IND'</span>,<span class="st">'FRI-IND'</span>,<span class="st">'SAT-IND'</span>,<span class="st">'SUN-IND'</span>]</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">"mtgs_per_wk"</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> day_cols:</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    stacked_df[col] <span class="op">=</span> stacked_df[col].fillna(<span class="st">'.'</span>)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    stacked_df[<span class="st">'mtgs_per_wk'</span>] <span class="op">=</span> stacked_df[<span class="st">"mtgs_per_wk"</span>] <span class="op">+</span> (stacked_df[col] <span class="op">!=</span> <span class="st">"."</span>).astype(<span class="bu">int</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">"BEGIN TIME"</span>] <span class="op">=</span> stacked_df[<span class="st">"BEGIN TIME"</span>].replace(<span class="st">"."</span>,<span class="st">"0"</span>)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">"END TIME"</span>] <span class="op">=</span> stacked_df[<span class="st">"END TIME"</span>].replace(<span class="st">"."</span>,<span class="st">"0"</span>)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'mtg_length'</span>] <span class="op">=</span> stacked_df[<span class="st">"END TIME"</span>].astype(<span class="bu">int</span>) <span class="op">-</span> stacked_df[<span class="st">"BEGIN TIME"</span>].astype(<span class="bu">int</span>)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'shared_mtgs_cnt'</span>] <span class="op">=</span>  stacked_df.groupby([<span class="st">'TERM'</span>,<span class="st">'instructor'</span>,<span class="st">'time_id'</span>])[<span class="st">'time_id'</span>].transform(<span class="st">'count'</span>)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[(stacked_df[<span class="st">'time_code'</span>].isin([<span class="st">'.........'</span>])),<span class="st">'shared_mtgs_cnt'</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'mtgs_per_crn'</span>] <span class="op">=</span>  stacked_df.groupby([<span class="st">'TERM'</span>,<span class="st">'CRN'</span>,<span class="st">'instructor'</span>])[<span class="st">'CRN'</span>].transform(<span class="st">'count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="find-all-courses-taught-by-same-instructor-at-the-same-time" class="level3">
<h3 class="anchored" data-anchor-id="find-all-courses-taught-by-same-instructor-at-the-same-time">Find all courses taught by same instructor at the same time</h3>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> concat_courses(group):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">','</span>.join(group[<span class="st">'COURSE'</span>])</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>temp_df <span class="op">=</span> pd.DataFrame()<span class="op">;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>keys <span class="op">=</span> [<span class="st">'TERM'</span>,<span class="st">'instructor'</span>,<span class="st">'time_code'</span>]</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>temp_df[<span class="st">"concat"</span>] <span class="op">=</span> stacked_df.groupby(keys).<span class="bu">apply</span>(concat_courses)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>temp_df[<span class="st">"list"</span>] <span class="op">=</span> temp_df[<span class="st">"concat"</span>].<span class="bu">apply</span>( <span class="kw">lambda</span> x :  <span class="bu">list</span>(<span class="bu">set</span>(x.split(<span class="st">","</span>))) )</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>temp_df[<span class="st">"combined_count"</span>] <span class="op">=</span> temp_df[<span class="st">"list"</span>].<span class="bu">apply</span>( <span class="kw">lambda</span> x :  <span class="bu">len</span>(x) )</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>temp_df[<span class="st">"combined_sections"</span>] <span class="op">=</span> temp_df[<span class="st">"list"</span>].<span class="bu">apply</span>( <span class="kw">lambda</span> x :  <span class="st">","</span>.join(x) )</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>temp_df <span class="op">=</span> temp_df.reset_index()</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>temp_df <span class="op">=</span> temp_df[ (temp_df[<span class="st">'time_code'</span>]<span class="op">!=</span><span class="st">'.........'</span>)<span class="op">&amp;</span>(temp_df[<span class="st">'combined_count'</span>]<span class="op">&gt;</span><span class="dv">1</span>)]</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>temp_df <span class="op">=</span> temp_df[[<span class="st">'TERM'</span>,<span class="st">'instructor'</span>,<span class="st">'time_code'</span>,<span class="st">'combined_count'</span>,<span class="st">'combined_sections'</span>]]</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>stacked_df <span class="op">=</span> pd.merge(stacked_df,temp_df,left_on<span class="op">=</span>keys, right_on<span class="op">=</span>keys,how<span class="op">=</span><span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cgep-convert-to-ind-rather-than-lec-from-workload-perspective" class="level3">
<h3 class="anchored" data-anchor-id="cgep-convert-to-ind-rather-than-lec-from-workload-perspective">CGEP: convert to IND rather than LEC from workload perspective</h3>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to set the 'TYPE' column based on a string search in 'TITLE'</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> set_type_based_on_search(row):</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> row[<span class="st">'TITLE'</span>]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    newtype <span class="op">=</span> row[<span class="st">'TYPE'</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'CGEP'</span> <span class="kw">in</span> title:</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        newtype <span class="op">=</span> <span class="st">'IND'</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> newtype</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the function to the entire DataFrame</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'TYPE'</span>] <span class="op">=</span> stacked_df.<span class="bu">apply</span>(set_type_based_on_search, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="add-a-bunch-of-spare-columns" class="level3">
<h3 class="anchored" data-anchor-id="add-a-bunch-of-spare-columns">Add a bunch of spare columns</h3>
<p>It’s getting old adding new columns, then having to rework the formuluas in the rather brittle google sheet. I’m adding a few spare columns here to be used as necessary. This is the best place to add the new columns, just prior to the calculation of the aggregate measures and workload attributes.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">"spare_col_1"</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">"spare_col_2"</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">"spare_col_3"</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">"spare_col_4"</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">"spare_col_5"</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">"spare_col_6"</span>] <span class="op">=</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that several spare columns have been added to persistent google sheets (instructor and course).</p>
</section>
<section id="compute-appropriate-aggregate-measures" class="level3">
<h3 class="anchored" data-anchor-id="compute-appropriate-aggregate-measures">Compute appropriate aggregate measures</h3>
<p>These measures are used in later calculations for numbers of courses, sections, instructors, etc.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create various aggregate columns</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'sum_term'</span>] <span class="op">=</span> <span class="fl">1.0</span> <span class="op">/</span> stacked_df.groupby([<span class="st">'TERM'</span>])[<span class="st">'TERM'</span>].transform(<span class="st">'count'</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'sum_term_crse'</span>] <span class="op">=</span> <span class="fl">1.0</span> <span class="op">/</span> stacked_df.groupby([<span class="st">'TERM'</span>,<span class="st">'COURSE'</span>])[<span class="st">'COURSE'</span>].transform(<span class="st">'count'</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'sum_term_crse_crn'</span>] <span class="op">=</span> <span class="fl">1.0</span> <span class="op">/</span> stacked_df.groupby([<span class="st">'TERM'</span>,<span class="st">'COURSE'</span>,<span class="st">'CRN'</span>])[<span class="st">'CRN'</span>].transform(<span class="st">'count'</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'sum_term_crse_crn_students'</span>] <span class="op">=</span> stacked_df[<span class="st">'ACTUAL ENROLLMENT'</span>] <span class="op">*</span> stacked_df[<span class="st">'sum_term_crse_crn'</span>]</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'sum_term_crse_crn_hours'</span>] <span class="op">=</span>  stacked_df[<span class="st">'sum_term_crse_crn_students'</span>] <span class="op">*</span> stacked_df[<span class="st">'MAX CREDITS'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="placeholder-workload-model-assignments" class="level3">
<h3 class="anchored" data-anchor-id="placeholder-workload-model-assignments">Placeholder Workload model assignments</h3>
<p>These are placeholders for any proposed workload model based on course and instructor attributes.</p>
<p>For each workload model, there is a:</p>
<ul>
<li><em>sum_term_crse_wrkld</em> containing the numeric assignment of workload for that entry in the dataframe.</li>
<li><em>wrkld_</em>_type* containing the recoded course type. For example, some LEC sections that are actually labs are coded labs. Capstones are also highlighted.</li>
<li><em>wrkld_note</em> containing a note about the specific workload assignment.</li>
</ul>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'wrkld_sample_type'</span>] <span class="op">=</span> stacked_df[<span class="st">'TYPE'</span>]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'sum_term_crse_wrkld_sample'</span>] <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'wrkld_sample_note'</span>] <span class="op">=</span> <span class="st">""</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'wrkld_a_type'</span>] <span class="op">=</span> stacked_df[<span class="st">'TYPE'</span>]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'sum_term_crse_wrkld_a'</span>] <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'wrkld_a_note'</span>] <span class="op">=</span> <span class="st">""</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'wrkld_b_type'</span>] <span class="op">=</span> stacked_df[<span class="st">'TYPE'</span>]</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'sum_term_crse_wrkld_b'</span>] <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'wrkld_b_note'</span>] <span class="op">=</span> <span class="st">""</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'wrkld_c_type'</span>] <span class="op">=</span> stacked_df[<span class="st">'TYPE'</span>]</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'sum_term_crse_wrkld_c'</span>] <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">'wrkld_c_note'</span>] <span class="op">=</span> <span class="st">""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="sample-workload-model" class="level2">
<h2 class="anchored" data-anchor-id="sample-workload-model">Sample workload model</h2>
<p>This is the sample workload model. The assigned faculty workoad will be stored in the <em>sum_term_crse_wrklod_sample</em> field. Here is the model:</p>
<ol type="1">
<li>Each section/CRN is worth a full teaching credit.</li>
<li>Research, indepedent study and coop/intern sections receive zero teaching credit in this workload model. Instructors receive <em>credit</em> through their salary if they’re staff. Research active faculty get reduced teaching loads.</li>
<li>Lab sections including actual course labs, capstone/senior design, and VIP receive 1/3 credit. This is consistent with the model that 3 lab hours is equivalent to 1 teaching hour. (e.g., 3-3-4 courses.) NOTE that laboratory sections are NOT coded as separate labs, rather they are coded as LEC making it difficult to discern these. See EGRE306 for an example.</li>
<li>Seminar sections get full section credit as a positive incentive. There is a limited number of SEM courses, they are important to the curriculum, and we want them covered.</li>
<li>Capstone designs are scaled to give one LAB (0.33 per above) unit per groups of 4 students.</li>
</ol>
<section id="assign-base-workload-to-all-sections" class="level3">
<h3 class="anchored" data-anchor-id="assign-base-workload-to-all-sections">Assign BASE workload to all sections</h3>
<p>This base workload assignment will be overwritten as various scenarios are explored.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign standard workload : One teaching course shared across multiple instructors</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>stacked_df[<span class="st">"sum_term_crse_wrkld_sample"</span>] <span class="op">=</span> <span class="fl">1.0</span> <span class="op">/</span> stacked_df[<span class="st">"instructor_cnt"</span>]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'LEC'</span>),<span class="st">'wrkld_sample_note'</span>] <span class="op">=</span> <span class="st">"BASE: [wrkld] "</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'LEC'</span>)<span class="op">&amp;</span>(stacked_df[<span class="st">'instructor_cnt'</span>]<span class="op">&gt;</span><span class="fl">1.0</span>),<span class="st">'wrkld_sample_note'</span>] <span class="op">=</span> <span class="st">"BASE: [wrkld] / (2 co-teaching) "</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="adjust-for-courses-taught-at-same-time-by-same-instructor" class="level3">
<h3 class="anchored" data-anchor-id="adjust-for-courses-taught-at-same-time-by-same-instructor">Adjust for courses taught at same time by same instructor</h3>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust for combined lectures (this code is deprecated for a smarter logi)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="dv">0</span>):</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    stacked_df.loc[(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'LEC'</span>)<span class="op">&amp;</span>(stacked_df[<span class="st">'combined_count'</span>]<span class="op">&gt;</span><span class="dv">1</span>),<span class="st">'sum_term_crse_wrkld_sample'</span>] <span class="op">=</span> stacked_df.loc[(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'LEC'</span>)<span class="op">&amp;</span>(stacked_df[<span class="st">'combined_count'</span>]<span class="op">&gt;</span><span class="dv">1</span>),<span class="st">'sum_term_crse_wrkld_sample'</span>] <span class="op">/</span> stacked_df.loc[(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'LEC'</span>)<span class="op">&amp;</span>(stacked_df[<span class="st">'combined_count'</span>]<span class="op">&gt;</span><span class="dv">1</span>),<span class="st">'combined_count'</span>] </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    stacked_df.loc[(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'LEC'</span>)<span class="op">&amp;</span>(stacked_df[<span class="st">'combined_count'</span>]<span class="op">&gt;</span><span class="dv">1</span>),<span class="st">'wrkld_sample_note'</span>] <span class="op">=</span> stacked_df.loc[(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'LEC'</span>)<span class="op">&amp;</span>(stacked_df[<span class="st">'combined_count'</span>]<span class="op">&gt;</span><span class="dv">1</span>),<span class="st">'wrkld_sample_note'</span>] <span class="op">+</span> <span class="st">": combined("</span><span class="op">+</span>stacked_df.loc[(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'LEC'</span>)<span class="op">&amp;</span>(stacked_df[<span class="st">'combined_count'</span>]<span class="op">&gt;</span><span class="dv">1</span>),<span class="st">'combined_sections'</span>]<span class="op">+</span><span class="st">")"</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># adjust for CRN sharing same teaching time</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[(stacked_df[<span class="st">'shared_mtgs_cnt'</span>]<span class="op">&gt;</span><span class="dv">1</span>),<span class="st">'sum_term_crse_wrkld_sample'</span>] <span class="op">=</span> stacked_df.loc[(stacked_df[<span class="st">'shared_mtgs_cnt'</span>]<span class="op">&gt;</span><span class="dv">1</span>),<span class="st">'sum_term_crse_wrkld_sample'</span>] <span class="op">/</span> stacked_df.loc[(stacked_df[<span class="st">'shared_mtgs_cnt'</span>]<span class="op">&gt;</span><span class="dv">1</span>),<span class="st">'shared_mtgs_cnt'</span>] </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[(stacked_df[<span class="st">'shared_mtgs_cnt'</span>]<span class="op">&gt;</span><span class="dv">1</span>),<span class="st">'wrkld_sample_note'</span>] <span class="op">=</span> (</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  stacked_df.loc[(stacked_df[<span class="st">'shared_mtgs_cnt'</span>]<span class="op">&gt;</span><span class="dv">1</span>),<span class="st">'wrkld_sample_note'</span>] <span class="op">+</span> <span class="st">"/ "</span> <span class="op">+</span> </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  stacked_df.loc[(stacked_df[<span class="st">'shared_mtgs_cnt'</span>]<span class="op">&gt;</span><span class="dv">1</span>),<span class="st">'shared_mtgs_cnt'</span>].astype(<span class="bu">str</span>) <span class="op">+</span><span class="st">" CRN at same time"</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="distinguish-capstone-workloads" class="level3">
<h3 class="anchored" data-anchor-id="distinguish-capstone-workloads">Distinguish capstone workloads</h3>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign CAP workload</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>capstones_per_lecture <span class="op">=</span> <span class="fl">3.0</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>students_per_capstone <span class="op">=</span> <span class="fl">4.0</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>senior_design_courses <span class="op">=</span> [<span class="st">'CLSC403'</span>,<span class="st">'EGRB401'</span>,<span class="st">'EGRB402'</span>,<span class="st">'CMSC441'</span>,<span class="st">'CMSC442'</span>,<span class="st">'CMSC451'</span>,<span class="st">'CMSC452'</span>,<span class="st">'EGMN402'</span>,<span class="st">'EGMN403'</span>,<span class="st">'ENGR402'</span>,<span class="st">'ENGR403'</span>,<span class="st">'EGRE404'</span>,<span class="st">'EGRE405'</span>]</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> course <span class="kw">in</span> senior_design_courses:</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>   stacked_df.loc[(stacked_df[<span class="st">'COURSE'</span>]<span class="op">==</span>course)<span class="op">&amp;</span>(stacked_df[<span class="st">'TYPE'</span>]<span class="op">==</span><span class="st">'LAB'</span>),<span class="st">'wrkld_sample_type'</span>] <span class="op">=</span> <span class="st">'CAP'</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>   stacked_df.loc[(stacked_df[<span class="st">'COURSE'</span>]<span class="op">==</span>course)<span class="op">&amp;</span>(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'CAP'</span>),<span class="st">'wrkld_sample_note'</span>] <span class="op">=</span> <span class="ss">f'RULE: [wrkld]=</span><span class="sc">{</span>(<span class="fl">1.0</span><span class="op">/</span>capstones_per_lecture)<span class="sc">:0.2f}</span><span class="ss"> for every </span><span class="sc">{</span>students_per_capstone<span class="sc">}</span><span class="ss"> students in CAP'</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>   stacked_df.loc[(stacked_df[<span class="st">'COURSE'</span>]<span class="op">==</span>course)<span class="op">&amp;</span>(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'CAP'</span>),<span class="st">'sum_term_crse_wrkld_sample'</span>] <span class="op">=</span> (</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>     stacked_df.loc[(stacked_df[<span class="st">'COURSE'</span>]<span class="op">==</span>course)<span class="op">&amp;</span>(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'CAP'</span>),<span class="st">'sum_term_crse_crn'</span>] <span class="op">/</span> capstones_per_lecture <span class="op">*</span> ( stacked_df.loc[(stacked_df[<span class="st">'COURSE'</span>]<span class="op">==</span>course)<span class="op">&amp;</span>(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'CAP'</span>),<span class="st">'ACTUAL ENROLLMENT'</span>].astype(<span class="bu">int</span>) <span class="op">/</span> students_per_capstone) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="distinguish-vip-workloads" class="level3">
<h3 class="anchored" data-anchor-id="distinguish-vip-workloads">Distinguish VIP workloads</h3>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign VIP workload</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>vips_per_lecture <span class="op">=</span> <span class="fl">3.0</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[stacked_df[<span class="st">'course_number'</span>].isin([<span class="st">'497'</span>]),<span class="st">'wrkld_sample_type'</span>] <span class="op">=</span> <span class="st">"VIP"</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[stacked_df[<span class="st">'wrkld_sample_type'</span>].isin([<span class="st">'VIP'</span>]),<span class="st">'wrkld_sample_note'</span>] <span class="op">=</span> <span class="ss">f"RULE: [wrkld]=</span><span class="sc">{</span>(<span class="fl">1.0</span><span class="op">/</span>vips_per_lecture)<span class="sc">:0.2f}</span><span class="ss"> for VIP"</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[(stacked_df[<span class="st">'wrkld_sample_type'</span>].isin([<span class="st">'VIP'</span>]))<span class="op">&amp;</span>(stacked_df[<span class="st">'instructor_cnt'</span>]<span class="op">&gt;</span><span class="fl">1.0</span>),<span class="st">'wrkld_sample_note'</span>] <span class="op">=</span> <span class="ss">f"RULE: [wrkld]=</span><span class="sc">{</span>(<span class="fl">1.0</span><span class="op">/</span>vips_per_lecture)<span class="sc">:0.2f}</span><span class="ss"> for VIP (co-teaching)"</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[stacked_df[<span class="st">'wrkld_sample_type'</span>].isin([<span class="st">'VIP'</span>]),<span class="st">'sum_term_crse_wrkld_sample'</span>] <span class="op">=</span> stacked_df.loc[stacked_df[<span class="st">'wrkld_sample_type'</span>].isin([<span class="st">'VIP'</span>]),<span class="st">'sum_term_crse_wrkld_sample'</span>] <span class="op">/</span> vips_per_lecture</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="distinguish-lab-workloads" class="level3">
<h3 class="anchored" data-anchor-id="distinguish-lab-workloads">Distinguish LAB workloads</h3>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign LAB workload</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>labs_per_lecture <span class="op">=</span> <span class="fl">3.0</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">#stacked_df.loc[(stacked_df['MAX CREDITS']==4)&amp;(stacked_df['wrkld_sample_type']=='LEC')&amp;(stacked_df['mtgs_per_wk']==1&amp;(! stacked_df['course_number'].isin(['291','391','491','591','691','791'])),'wrkld_sample_type'] = 'LAB'</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[(stacked_df[<span class="st">'mtgs_per_crn'</span>]<span class="op">&gt;</span><span class="dv">1</span>)<span class="op">&amp;</span>(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'LEC'</span>)<span class="op">&amp;</span>(stacked_df[<span class="st">'mtgs_per_wk'</span>]<span class="op">==</span><span class="dv">1</span>),<span class="st">'wrkld_sample_type'</span>] <span class="op">=</span> <span class="st">'LAB'</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[stacked_df[<span class="st">'wrkld_sample_type'</span>].isin([<span class="st">'LAB'</span>]),<span class="st">'wrkld_sample_note'</span>] <span class="op">=</span> <span class="ss">f"RULE: [wrkld]=</span><span class="sc">{</span>(<span class="fl">1.0</span><span class="op">/</span>labs_per_lecture)<span class="sc">:0.2f}</span><span class="ss"> for LAB"</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[stacked_df[<span class="st">'wrkld_sample_type'</span>].isin([<span class="st">'LAB'</span>]),<span class="st">'sum_term_crse_wrkld_sample'</span>] <span class="op">=</span> stacked_df.loc[stacked_df[<span class="st">'wrkld_sample_type'</span>].isin([<span class="st">'LAB'</span>]),<span class="st">'sum_term_crse_wrkld_sample'</span>] <span class="op">/</span> labs_per_lecture</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">#stacked_df.loc[(stacked_df['MAX CREDITS']==4)&amp;(stacked_df['wrkld_sample_type']=='LAB')&amp;(stacked_df['mtgs_per_wk']==1),'wrkld_sample_note'] = stacked_df.loc[(stacked_df['MAX CREDITS']==4)&amp;(stacked_df['wrkld_sample_type']=='LAB')&amp;(stacked_df['mtgs_per_wk']==1),'wrkld_sample_note'] + " (LAB: 4-credit rule)"</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[(stacked_df[<span class="st">'mtgs_per_crn'</span>]<span class="op">&gt;</span><span class="dv">1</span>)<span class="op">&amp;</span>(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'LAB'</span>)<span class="op">&amp;</span>(stacked_df[<span class="st">'mtgs_per_wk'</span>]<span class="op">==</span><span class="dv">1</span>),<span class="st">'wrkld_sample_note'</span>] <span class="op">=</span> stacked_df.loc[(stacked_df[<span class="st">'mtgs_per_crn'</span>]<span class="op">&gt;</span><span class="dv">1</span>)<span class="op">&amp;</span>(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'LAB'</span>)<span class="op">&amp;</span>(stacked_df[<span class="st">'mtgs_per_wk'</span>]<span class="op">==</span><span class="dv">1</span>),<span class="st">'wrkld_sample_note'</span>] <span class="op">+</span> <span class="st">" (LAB: 1 mtg per wk rule)"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="distinguish-res-ind-and-fld" class="level3">
<h3 class="anchored" data-anchor-id="distinguish-res-ind-and-fld">Distinguish RES, IND and FLD</h3>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclude teaching credit for research (RES), independent study (IND), and intern/coop (FLD).</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Credit is given for these activities in reduced teaching (research active) or summer pay.</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[stacked_df[<span class="st">'wrkld_sample_type'</span>].isin([<span class="st">'RES'</span>,<span class="st">'IND'</span>,<span class="st">'FLD'</span>]),<span class="st">'wrkld_sample_note'</span>] <span class="op">=</span> <span class="st">"RULE: [wrkld]=0.00 for INS, RES and FLD"</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[stacked_df[<span class="st">'wrkld_sample_type'</span>].isin([<span class="st">'RES'</span>,<span class="st">'IND'</span>,<span class="st">'FLD'</span>]),<span class="st">'sum_term_crse_wrkld_sample'</span>] <span class="op">=</span> <span class="fl">0.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="distinguish-sem-workloads" class="level3">
<h3 class="anchored" data-anchor-id="distinguish-sem-workloads">Distinguish SEM workloads</h3>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign SEM workload</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure that SEM get full credit because we want to reward the faculty member for doing it!</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>seminars_per_lecture <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[stacked_df[<span class="st">'wrkld_sample_type'</span>].isin([<span class="st">'SEM'</span>]),<span class="st">'wrkld_sample_note'</span>] <span class="op">=</span> <span class="ss">f"RULE: [wrkld] / </span><span class="sc">{</span>seminars_per_lecture<span class="sc">}</span><span class="ss"> for SEM"</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[(stacked_df[<span class="st">'wrkld_sample_type'</span>].isin([<span class="st">'SEM'</span>]))<span class="op">&amp;</span>(stacked_df[<span class="st">'instructor_cnt'</span>]<span class="op">&gt;</span><span class="fl">1.0</span>),<span class="st">'wrkld_sample_note'</span>] <span class="op">=</span> <span class="ss">f"RULE: [wrkld] / </span><span class="sc">{</span>seminars_per_lecture<span class="sc">}</span><span class="ss"> for SEM (co-teaching)"</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[stacked_df[<span class="st">'wrkld_sample_type'</span>].isin([<span class="st">'SEM'</span>]),<span class="st">'sum_term_crse_wrkld_sample'</span>] <span class="op">=</span> stacked_df.loc[stacked_df[<span class="st">'wrkld_sample_type'</span>].isin([<span class="st">'SEM'</span>]),<span class="st">'sum_term_crse_wrkld_sample'</span>] <span class="op">/</span> seminars_per_lecture</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="adjust-for-large-lectures" class="level3">
<h3 class="anchored" data-anchor-id="adjust-for-large-lectures">Adjust for large lectures</h3>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For large lectures - reset lecture units</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>weight <span class="op">=</span> <span class="fl">1.5</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>threshhold <span class="op">=</span> <span class="dv">80</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[(stacked_df[<span class="st">'ACTUAL ENROLLMENT'</span>]<span class="op">&gt;=</span>threshhold)<span class="op">&amp;</span>(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'LEC'</span>),<span class="st">"sum_term_crse_wrkld_sample"</span>] <span class="op">=</span> weight <span class="op">/</span> stacked_df[<span class="st">"instructor_cnt"</span>]</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[(stacked_df[<span class="st">'ACTUAL ENROLLMENT'</span>]<span class="op">&gt;=</span>threshhold)<span class="op">&amp;</span>(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'LEC'</span>),<span class="st">"wrkld_sample_note"</span>] <span class="op">=</span> <span class="ss">f"BASE: [wrkld] = </span><span class="sc">{</span>weight<span class="sc">}</span><span class="ss"> per CRN ENRL&gt;=</span><span class="sc">{</span>threshhold<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[(stacked_df[<span class="st">'ACTUAL ENROLLMENT'</span>]<span class="op">&gt;=</span>threshhold)<span class="op">&amp;</span>(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'LEC'</span>)<span class="op">&amp;</span>(stacked_df[<span class="st">'instructor_cnt'</span>]<span class="op">&gt;</span><span class="fl">1.0</span>),<span class="st">'wrkld_sample_note'</span>] <span class="op">=</span> <span class="ss">f"BASE: [wrkld]=</span><span class="sc">{</span>weight<span class="op">/</span><span class="fl">2.0</span><span class="sc">}</span><span class="ss"> per CRN ENRL&gt;=</span><span class="sc">{</span>threshhold<span class="sc">}</span><span class="ss"> (co-teaching)"</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>weight <span class="op">=</span> <span class="fl">2.0</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>threshhold <span class="op">=</span> <span class="dv">160</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[(stacked_df[<span class="st">'ACTUAL ENROLLMENT'</span>]<span class="op">&gt;=</span>threshhold)<span class="op">&amp;</span>(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'LEC'</span>),<span class="st">"sum_term_crse_wrkld_sample"</span>] <span class="op">=</span> weight <span class="op">/</span> stacked_df[<span class="st">"instructor_cnt"</span>]</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[(stacked_df[<span class="st">'ACTUAL ENROLLMENT'</span>]<span class="op">&gt;=</span>threshhold)<span class="op">&amp;</span>(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'LEC'</span>),<span class="st">"wrkld_sample_note"</span>] <span class="op">=</span> <span class="ss">f"BASE: [wrkld] = </span><span class="sc">{</span>weight<span class="sc">}</span><span class="ss"> per CRN ENRL&gt;=</span><span class="sc">{</span>threshhold<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[(stacked_df[<span class="st">'ACTUAL ENROLLMENT'</span>]<span class="op">&gt;=</span>threshhold)<span class="op">&amp;</span>(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'LEC'</span>)<span class="op">&amp;</span>(stacked_df[<span class="st">'instructor_cnt'</span>]<span class="op">&gt;</span><span class="fl">1.0</span>),<span class="st">'wrkld_sample_note'</span>] <span class="op">=</span> <span class="ss">f"BASE: [wrkld]=</span><span class="sc">{</span>weight<span class="op">/</span><span class="fl">2.0</span><span class="sc">}</span><span class="ss"> per CRN ENRL&gt;=</span><span class="sc">{</span>threshhold<span class="sc">}</span><span class="ss"> (co-teaching)"</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>weight <span class="op">=</span> <span class="fl">2.5</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>threshhold <span class="op">=</span> <span class="dv">240</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[(stacked_df[<span class="st">'ACTUAL ENROLLMENT'</span>]<span class="op">&gt;=</span>threshhold)<span class="op">&amp;</span>(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'LEC'</span>),<span class="st">"sum_term_crse_wrkld_sample"</span>] <span class="op">=</span> weight <span class="op">/</span> stacked_df[<span class="st">"instructor_cnt"</span>]</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[(stacked_df[<span class="st">'ACTUAL ENROLLMENT'</span>]<span class="op">&gt;=</span>threshhold)<span class="op">&amp;</span>(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'LEC'</span>),<span class="st">"wrkld_sample_note"</span>] <span class="op">=</span> <span class="ss">f"BASE: [wrkld] = </span><span class="sc">{</span>weight<span class="sc">}</span><span class="ss"> per CRN ENRL&gt;=</span><span class="sc">{</span>threshhold<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>stacked_df.loc[(stacked_df[<span class="st">'ACTUAL ENROLLMENT'</span>]<span class="op">&gt;=</span>threshhold)<span class="op">&amp;</span>(stacked_df[<span class="st">'wrkld_sample_type'</span>]<span class="op">==</span><span class="st">'LEC'</span>)<span class="op">&amp;</span>(stacked_df[<span class="st">'instructor_cnt'</span>]<span class="op">&gt;</span><span class="fl">1.0</span>),<span class="st">'wrkld_sample_note'</span>] <span class="op">=</span> <span class="ss">f"BASE: [wrkld]=</span><span class="sc">{</span>weight<span class="op">/</span><span class="fl">2.0</span><span class="sc">}</span><span class="ss"> per CRN ENRL&gt;=</span><span class="sc">{</span>threshhold<span class="sc">}</span><span class="ss"> (co-teaching)"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="checks-and-verfications" class="level3">
<h3 class="anchored" data-anchor-id="checks-and-verfications">Checks and verfications</h3>
<p>The following code blocks are added as unique situations are discovered. The code below shows how these situations are handled.</p>
<p>As odd situations are revealed, add a code block here to clearly show the inconsistency. Then, change the workload code above until the situation clears up AND you don’t screw up any of the other situations.</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>stacked_df[(stacked_df[<span class="st">"TERM"</span>]<span class="op">==</span><span class="st">'202410'</span>)<span class="op">&amp;</span>(stacked_df[<span class="st">"COURSE"</span>]<span class="op">==</span><span class="st">'EGMN416'</span>)][[<span class="st">'COURSE'</span>,<span class="st">'instructor'</span>,<span class="st">'CRN'</span>,<span class="st">'MAX CREDITS'</span>,<span class="st">'time_code'</span>,<span class="st">'mtg_length'</span>,<span class="st">'shared_mtgs_cnt'</span>,<span class="st">'mtgs_per_wk'</span>,<span class="st">'mtgs_per_crn'</span>,<span class="st">'combined_count'</span>,<span class="st">'combined_sections'</span>,<span class="st">'sum_term_crse_wrkld_sample'</span>,<span class="st">'wrkld_sample_type'</span>,<span class="st">'wrkld_sample_note'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">COURSE</th>
<th data-quarto-table-cell-role="th">instructor</th>
<th data-quarto-table-cell-role="th">CRN</th>
<th data-quarto-table-cell-role="th">MAX CREDITS</th>
<th data-quarto-table-cell-role="th">time_code</th>
<th data-quarto-table-cell-role="th">mtg_length</th>
<th data-quarto-table-cell-role="th">shared_mtgs_cnt</th>
<th data-quarto-table-cell-role="th">mtgs_per_wk</th>
<th data-quarto-table-cell-role="th">mtgs_per_crn</th>
<th data-quarto-table-cell-role="th">combined_count</th>
<th data-quarto-table-cell-role="th">combined_sections</th>
<th data-quarto-table-cell-role="th">sum_term_crse_wrkld_sample</th>
<th data-quarto-table-cell-role="th">wrkld_sample_type</th>
<th data-quarto-table-cell-role="th">wrkld_sample_note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4117</td>
<td>EGMN416</td>
<td>Hadimani,Ravi</td>
<td>45899</td>
<td>3</td>
<td>....F..14001650</td>
<td>250</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>NaN</td>
<td>NaN</td>
<td>0.333333</td>
<td>LAB</td>
<td>RULE: [wrkld]=0.33 for LAB (LAB: 1 mtg per wk ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4118</td>
<td>EGMN416</td>
<td>Hadimani,Ravi</td>
<td>45899</td>
<td>3</td>
<td>M...F..13001350</td>
<td>50</td>
<td>3</td>
<td>2</td>
<td>2</td>
<td>NaN</td>
<td>NaN</td>
<td>0.333333</td>
<td>LEC</td>
<td>BASE: [wrkld] / 3 CRN at same time</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4119</td>
<td>EGMN416</td>
<td>Hadimani,Ravi</td>
<td>32709</td>
<td>3</td>
<td>M......14001650</td>
<td>250</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>NaN</td>
<td>NaN</td>
<td>0.166667</td>
<td>LAB</td>
<td>RULE: [wrkld]=0.33 for LAB (LAB: 1 mtg per wk ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4120</td>
<td>EGMN416</td>
<td>Hadimani,Ravi</td>
<td>32709</td>
<td>3</td>
<td>M...F..13001350</td>
<td>50</td>
<td>3</td>
<td>2</td>
<td>2</td>
<td>NaN</td>
<td>NaN</td>
<td>0.333333</td>
<td>LEC</td>
<td>BASE: [wrkld] / 3 CRN at same time</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4121</td>
<td>EGMN416</td>
<td>Hadimani,Ravi</td>
<td>46922</td>
<td>3</td>
<td>M......14001650</td>
<td>250</td>
<td>2</td>
<td>1</td>
<td>2</td>
<td>NaN</td>
<td>NaN</td>
<td>0.166667</td>
<td>LAB</td>
<td>RULE: [wrkld]=0.33 for LAB (LAB: 1 mtg per wk ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4122</td>
<td>EGMN416</td>
<td>Hadimani,Ravi</td>
<td>46922</td>
<td>3</td>
<td>M...F..13001350</td>
<td>50</td>
<td>3</td>
<td>2</td>
<td>2</td>
<td>NaN</td>
<td>NaN</td>
<td>0.333333</td>
<td>LEC</td>
<td>BASE: [wrkld] / 3 CRN at same time</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>stacked_df[(stacked_df[<span class="st">"TERM"</span>]<span class="op">==</span><span class="st">'202320'</span>)<span class="op">&amp;</span>(stacked_df[<span class="st">"instructor"</span>]<span class="op">==</span><span class="st">'Heise,Rebecca'</span>)][[<span class="st">'COURSE'</span>,<span class="st">'instructor'</span>,<span class="st">'CRN'</span>,<span class="st">'MAX CREDITS'</span>,<span class="st">'time_code'</span>,<span class="st">'mtg_length'</span>,<span class="st">'shared_mtgs_cnt'</span>,<span class="st">'mtgs_per_wk'</span>,<span class="st">'mtgs_per_crn'</span>,<span class="st">'combined_count'</span>,<span class="st">'combined_sections'</span>,<span class="st">'sum_term_crse_wrkld_sample'</span>,<span class="st">'wrkld_sample_type'</span>,<span class="st">'wrkld_sample_note'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">COURSE</th>
<th data-quarto-table-cell-role="th">instructor</th>
<th data-quarto-table-cell-role="th">CRN</th>
<th data-quarto-table-cell-role="th">MAX CREDITS</th>
<th data-quarto-table-cell-role="th">time_code</th>
<th data-quarto-table-cell-role="th">mtg_length</th>
<th data-quarto-table-cell-role="th">shared_mtgs_cnt</th>
<th data-quarto-table-cell-role="th">mtgs_per_wk</th>
<th data-quarto-table-cell-role="th">mtgs_per_crn</th>
<th data-quarto-table-cell-role="th">combined_count</th>
<th data-quarto-table-cell-role="th">combined_sections</th>
<th data-quarto-table-cell-role="th">sum_term_crse_wrkld_sample</th>
<th data-quarto-table-cell-role="th">wrkld_sample_type</th>
<th data-quarto-table-cell-role="th">wrkld_sample_note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">3128</td>
<td>EGRB111</td>
<td>Heise,Rebecca</td>
<td>43476</td>
<td>3</td>
<td>M.W.F..900950</td>
<td>50</td>
<td>1</td>
<td>3</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
<td>LEC</td>
<td>BASE: [wrkld]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3150</td>
<td>EGRB411</td>
<td>Heise,Rebecca</td>
<td>40539</td>
<td>3</td>
<td>M.W.F..10001050</td>
<td>50</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>2.0</td>
<td>EGRB517,EGRB411</td>
<td>0.5</td>
<td>LEC</td>
<td>BASE: [wrkld] / 2 CRN at same time</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3154</td>
<td>EGRB491</td>
<td>Heise,Rebecca</td>
<td>45797</td>
<td>3</td>
<td>.........</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
<td>LEC</td>
<td>BASE: [wrkld]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3156</td>
<td>EGRB517</td>
<td>Heise,Rebecca</td>
<td>40540</td>
<td>3</td>
<td>M.W.F..10001050</td>
<td>50</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>2.0</td>
<td>EGRB517,EGRB411</td>
<td>0.5</td>
<td>LEC</td>
<td>BASE: [wrkld] / 2 CRN at same time</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3164</td>
<td>EGRB697</td>
<td>Heise,Rebecca</td>
<td>28942</td>
<td>15</td>
<td>.........</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>0.0</td>
<td>RES</td>
<td>RULE: [wrkld]=0.00 for INS, RES and FLD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3171</td>
<td>EGRB697</td>
<td>Heise,Rebecca</td>
<td>45891</td>
<td>4</td>
<td>.........</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>0.0</td>
<td>RES</td>
<td>RULE: [wrkld]=0.00 for INS, RES and FLD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3194</td>
<td>EGRB697</td>
<td>Heise,Rebecca</td>
<td>28930</td>
<td>3</td>
<td>.........</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>0.0</td>
<td>RES</td>
<td>RULE: [wrkld]=0.00 for INS, RES and FLD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3195</td>
<td>EGRB697</td>
<td>Heise,Rebecca</td>
<td>28934</td>
<td>7</td>
<td>.........</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>0.0</td>
<td>RES</td>
<td>RULE: [wrkld]=0.00 for INS, RES and FLD</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3196</td>
<td>EGRB697</td>
<td>Heise,Rebecca</td>
<td>45890</td>
<td>11</td>
<td>.........</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>0.0</td>
<td>RES</td>
<td>RULE: [wrkld]=0.00 for INS, RES and FLD</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3590</td>
<td>ENGR701</td>
<td>Heise,Rebecca</td>
<td>43901</td>
<td>9</td>
<td>.........</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>0.0</td>
<td>RES</td>
<td>RULE: [wrkld]=0.00 for INS, RES and FLD</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>stacked_df[(stacked_df[<span class="st">"TERM"</span>]<span class="op">==</span><span class="st">'202310'</span>)<span class="op">&amp;</span>(stacked_df[<span class="st">"instructor"</span>]<span class="op">==</span><span class="st">'Ferri,James'</span>)][[<span class="st">'COURSE'</span>,<span class="st">'instructor'</span>,<span class="st">'CRN'</span>,<span class="st">'MAX CREDITS'</span>,<span class="st">'time_code'</span>,<span class="st">'mtg_length'</span>,<span class="st">'shared_mtgs_cnt'</span>,<span class="st">'mtgs_per_wk'</span>,<span class="st">'mtgs_per_crn'</span>,<span class="st">'combined_count'</span>,<span class="st">'combined_sections'</span>,<span class="st">'sum_term_crse_wrkld_sample'</span>,<span class="st">'wrkld_sample_type'</span>,<span class="st">'wrkld_sample_note'</span>,<span class="st">'TITLE'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">COURSE</th>
<th data-quarto-table-cell-role="th">instructor</th>
<th data-quarto-table-cell-role="th">CRN</th>
<th data-quarto-table-cell-role="th">MAX CREDITS</th>
<th data-quarto-table-cell-role="th">time_code</th>
<th data-quarto-table-cell-role="th">mtg_length</th>
<th data-quarto-table-cell-role="th">shared_mtgs_cnt</th>
<th data-quarto-table-cell-role="th">mtgs_per_wk</th>
<th data-quarto-table-cell-role="th">mtgs_per_crn</th>
<th data-quarto-table-cell-role="th">combined_count</th>
<th data-quarto-table-cell-role="th">combined_sections</th>
<th data-quarto-table-cell-role="th">sum_term_crse_wrkld_sample</th>
<th data-quarto-table-cell-role="th">wrkld_sample_type</th>
<th data-quarto-table-cell-role="th">wrkld_sample_note</th>
<th data-quarto-table-cell-role="th">TITLE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2676</td>
<td>CLSE301</td>
<td>Ferri,James</td>
<td>42633</td>
<td>3</td>
<td>.T.R...15301645</td>
<td>115</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
<td>LEC</td>
<td>BASE: [wrkld]</td>
<td>TRANSPORT PHENOMENA I</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2688</td>
<td>CLSE585</td>
<td>Ferri,James</td>
<td>44879</td>
<td>3</td>
<td>..W....17001930</td>
<td>230</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
<td>LEC</td>
<td>BASE: [wrkld]</td>
<td>INTERFACIAL PHENOMENA</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2700</td>
<td>CLSE697</td>
<td>Ferri,James</td>
<td>37469</td>
<td>8</td>
<td>.........</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>0.0</td>
<td>RES</td>
<td>RULE: [wrkld]=0.00 for INS, RES and FLD</td>
<td>DIRECTED RESEARCH</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2707</td>
<td>CLSE697</td>
<td>Ferri,James</td>
<td>37073</td>
<td>3</td>
<td>.........</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>0.0</td>
<td>RES</td>
<td>RULE: [wrkld]=0.00 for INS, RES and FLD</td>
<td>DIRECTED RESEARCH</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2991</td>
<td>ENGR591</td>
<td>Ferri,James</td>
<td>44935</td>
<td>3</td>
<td>.........</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
<td>LEC</td>
<td>BASE: [wrkld]</td>
<td>TOP: SYSTEMS ENGINEERING I</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2999</td>
<td>ENGR691</td>
<td>Ferri,James</td>
<td>44989</td>
<td>4</td>
<td>..W....17001900</td>
<td>200</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
<td>LEC</td>
<td>BASE: [wrkld]</td>
<td>ST:ADV TOP IN INTERFACIAL PHEN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3004</td>
<td>ENGR701</td>
<td>Ferri,James</td>
<td>43323</td>
<td>9</td>
<td>.........</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>0.0</td>
<td>RES</td>
<td>RULE: [wrkld]=0.00 for INS, RES and FLD</td>
<td>POST-CANDIDACY DOCT RESEARCH</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Singleton ROND sections should not be zeroed out</strong></p>
<p>This first example shows a singleton ROND sections. We may see this if all the students enroll in the online section and no one enrolls in the face-to-face section.</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>stacked_df[(stacked_df[<span class="st">"TERM"</span>]<span class="op">==</span><span class="st">'202320'</span>)<span class="op">&amp;</span>(stacked_df[<span class="st">"instructor"</span>]<span class="op">==</span><span class="st">'Manic,Milos'</span>)][[<span class="st">'COURSE'</span>,<span class="st">'instructor'</span>,<span class="st">'CRN'</span>,<span class="st">'MAX CREDITS'</span>,<span class="st">'time_code'</span>,<span class="st">'mtg_length'</span>,<span class="st">'shared_mtgs_cnt'</span>,<span class="st">'mtgs_per_wk'</span>,<span class="st">'mtgs_per_crn'</span>,<span class="st">'sum_term_crse_wrkld_sample'</span>,<span class="st">'wrkld_sample_type'</span>,<span class="st">'wrkld_sample_note'</span>,<span class="st">'TITLE'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">COURSE</th>
<th data-quarto-table-cell-role="th">instructor</th>
<th data-quarto-table-cell-role="th">CRN</th>
<th data-quarto-table-cell-role="th">MAX CREDITS</th>
<th data-quarto-table-cell-role="th">time_code</th>
<th data-quarto-table-cell-role="th">mtg_length</th>
<th data-quarto-table-cell-role="th">shared_mtgs_cnt</th>
<th data-quarto-table-cell-role="th">mtgs_per_wk</th>
<th data-quarto-table-cell-role="th">mtgs_per_crn</th>
<th data-quarto-table-cell-role="th">sum_term_crse_wrkld_sample</th>
<th data-quarto-table-cell-role="th">wrkld_sample_type</th>
<th data-quarto-table-cell-role="th">wrkld_sample_note</th>
<th data-quarto-table-cell-role="th">TITLE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">3085</td>
<td>CMSC636</td>
<td>Manic,Milos</td>
<td>44831</td>
<td>3</td>
<td>M.W....12001315</td>
<td>115</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>1.000000</td>
<td>LEC</td>
<td>BASE: [wrkld]</td>
<td>NEURAL NETS AND DEEP LEARNING</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3101</td>
<td>CMSC697</td>
<td>Manic,Milos</td>
<td>36849</td>
<td>2</td>
<td>.........</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0.000000</td>
<td>RES</td>
<td>RULE: [wrkld]=0.00 for INS, RES and FLD</td>
<td>DIRECTED RESEARCH</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3102</td>
<td>CMSC697</td>
<td>Manic,Milos</td>
<td>36851</td>
<td>6</td>
<td>.........</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0.000000</td>
<td>RES</td>
<td>RULE: [wrkld]=0.00 for INS, RES and FLD</td>
<td>DIRECTED RESEARCH</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3559</td>
<td>ENGR497</td>
<td>Manic,Milos</td>
<td>45526</td>
<td>1</td>
<td>.........</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0.333333</td>
<td>VIP</td>
<td>RULE: [wrkld]=0.33 for VIP</td>
<td>VERTICALLY INTEGRATED PROJECTS</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3560</td>
<td>ENGR497</td>
<td>Manic,Milos</td>
<td>45527</td>
<td>2</td>
<td>.........</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0.333333</td>
<td>VIP</td>
<td>RULE: [wrkld]=0.33 for VIP</td>
<td>VERTICALLY INTEGRATED PROJECTS</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This second example shows a doubleton ROND+RINP section.</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>stacked_df[(stacked_df[<span class="st">"TERM"</span>]<span class="op">==</span><span class="st">'202410'</span>)<span class="op">&amp;</span>(stacked_df[<span class="st">"instructor"</span>]<span class="op">==</span><span class="st">'Ghosh,Preetam'</span>)][[<span class="st">'COURSE'</span>,<span class="st">'instructor'</span>,<span class="st">'CRN'</span>,<span class="st">'MAX CREDITS'</span>,<span class="st">'time_code'</span>,<span class="st">'mtg_length'</span>,<span class="st">'shared_mtgs_cnt'</span>,<span class="st">'mtgs_per_wk'</span>,<span class="st">'mtgs_per_crn'</span>,<span class="st">'sum_term_crse_wrkld_sample'</span>,<span class="st">'wrkld_sample_type'</span>,<span class="st">'wrkld_sample_note'</span>,<span class="st">'TITLE'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">COURSE</th>
<th data-quarto-table-cell-role="th">instructor</th>
<th data-quarto-table-cell-role="th">CRN</th>
<th data-quarto-table-cell-role="th">MAX CREDITS</th>
<th data-quarto-table-cell-role="th">time_code</th>
<th data-quarto-table-cell-role="th">mtg_length</th>
<th data-quarto-table-cell-role="th">shared_mtgs_cnt</th>
<th data-quarto-table-cell-role="th">mtgs_per_wk</th>
<th data-quarto-table-cell-role="th">mtgs_per_crn</th>
<th data-quarto-table-cell-role="th">sum_term_crse_wrkld_sample</th>
<th data-quarto-table-cell-role="th">wrkld_sample_type</th>
<th data-quarto-table-cell-role="th">wrkld_sample_note</th>
<th data-quarto-table-cell-role="th">TITLE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">3749</td>
<td>CMSC441</td>
<td>Ghosh,Preetam</td>
<td>43750</td>
<td>2</td>
<td>.........</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0.666667</td>
<td>CAP</td>
<td>RULE: [wrkld]=0.33 for every 4.0 students in CAP</td>
<td>SR DESIGN STUDIO I (LAB/PROJ)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3771</td>
<td>CMSC502</td>
<td>Ghosh,Preetam</td>
<td>37708</td>
<td>3</td>
<td>.T.R...15301645</td>
<td>115</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>0.500000</td>
<td>LEC</td>
<td>BASE: [wrkld] / 2 CRN at same time</td>
<td>PARALLEL ALGORITHMS</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3772</td>
<td>CMSC502</td>
<td>Ghosh,Preetam</td>
<td>37709</td>
<td>3</td>
<td>.T.R...15301645</td>
<td>115</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>0.500000</td>
<td>LEC</td>
<td>BASE: [wrkld] / 2 CRN at same time</td>
<td>PARALLEL ALGORITHMS</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3797</td>
<td>CMSC697</td>
<td>Ghosh,Preetam</td>
<td>37384</td>
<td>2</td>
<td>.........</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0.000000</td>
<td>RES</td>
<td>RULE: [wrkld]=0.00 for INS, RES and FLD</td>
<td>DIRECTED RESEARCH</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3798</td>
<td>CMSC697</td>
<td>Ghosh,Preetam</td>
<td>37385</td>
<td>3</td>
<td>.........</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0.000000</td>
<td>RES</td>
<td>RULE: [wrkld]=0.00 for INS, RES and FLD</td>
<td>DIRECTED RESEARCH</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3799</td>
<td>CMSC697</td>
<td>Ghosh,Preetam</td>
<td>37386</td>
<td>6</td>
<td>.........</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0.000000</td>
<td>RES</td>
<td>RULE: [wrkld]=0.00 for INS, RES and FLD</td>
<td>DIRECTED RESEARCH</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4261</td>
<td>ENGR701</td>
<td>Ghosh,Preetam</td>
<td>46939</td>
<td>9</td>
<td>.........</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0.000000</td>
<td>RES</td>
<td>RULE: [wrkld]=0.00 for INS, RES and FLD</td>
<td>POST-CANDIDACY DOCT RESEARCH</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="store-the-dataframe" class="level2">
<h2 class="anchored" data-anchor-id="store-the-dataframe">Store the dataframe</h2>
<p>We’re storing both the stacked and unstacked data. Note that the aggregate measures are stored with the stacked data only.</p>
<section id="store-to-a-local-csv-file" class="level3">
<h3 class="anchored" data-anchor-id="store-to-a-local-csv-file">Store to a local CSV file</h3>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Store as CSV files</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>sections_df.to_csv(<span class="st">'sections_df.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>stacked_df.to_csv(<span class="st">'stacked_df.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="store-the-data-in-google-sheets" class="level3">
<h3 class="anchored" data-anchor-id="store-the-data-in-google-sheets">Store the data in google sheets</h3>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the worksheet </span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>spreadsheet_key <span class="op">=</span> <span class="st">"1ZK7k8M85CXLof6FdeJYJuGFbfjsOXrCv5mc7OgUInWw"</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>worksheet_name <span class="op">=</span> <span class="st">"Source data"</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>data_to_write <span class="op">=</span> stacked_df.to_records(index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    sheet <span class="op">=</span> client.open_by_key(spreadsheet_key).worksheet(worksheet_name)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    sheet <span class="op">=</span> client.open_by_key(spreadsheet_key).add_worksheet( </span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>        title <span class="op">=</span> worksheet_name,nrows<span class="op">=</span><span class="dv">100</span>,ncols<span class="op">=</span><span class="dv">10</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>sheet.clear()</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>set_with_dataframe(worksheet<span class="op">=</span>sheet, dataframe<span class="op">=</span>stacked_df, include_index<span class="op">=</span><span class="va">False</span>,include_column_header<span class="op">=</span><span class="va">True</span>, resize<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="freshen-persistent-instructor-data" class="level3">
<h3 class="anchored" data-anchor-id="freshen-persistent-instructor-data">Freshen persistent instructor data</h3>
<p>This block identifies any instructors not found in the persistent instructor data and adds them to the list with default values.</p>
<p><strong>This code is not working yet.</strong> It should be fixed when a new semester is added and new instructors and courses are discovered in the imported worksheets.</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#worksheet_name = "Instructor data"</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">#summary_df = stacked_df.groupby('instructor')[['COLLEGE','DEPT']].apply(lambda x: x.mode().iloc[0]).#reset_index()</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">#summary_df = summary_df.sort_values(by=['COLLEGE','DEPT','instructor'])</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">#data_to_write = summary_df.to_records(index=False)</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">#try:</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">#    sheet = client.open_by_key(spreadsheet_key).worksheet(worksheet_name)</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">#except:</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co">#    nrows,ncols = summary_df.shape</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co">#    sheet = client.open_by_key(spreadsheet_key).add_worksheet( </span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co">#        title = worksheet_name,rows=nrows+1,cols=ncols+1</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co">#    )</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co">#sheet.clear()</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co">#set_with_dataframe(worksheet=sheet, dataframe=summary_df, include_index=False,include_column_header=True, resize=True)</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Find names in df2 that are not in df1</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co">##names_to_add = df2[~df2['name'].isin(df1['name'])]</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the rows with missing names from df2 to df1</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co">## df1 = pd.concat([df1, names_to_add], ignore_index=True)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>That’s all folks! Additional models can be added and the google sheets can be reviewed.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>