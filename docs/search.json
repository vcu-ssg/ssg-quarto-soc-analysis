[
  {
    "objectID": "30_explore.html",
    "href": "30_explore.html",
    "title": "Exploring the data",
    "section": "",
    "text": "For this analysis we’ll be using the stacked_df data frame from the cleaning process.\nI haven’t spend much time on this. My effort to date has been spent on developing and documenting the preparing of the data at the instructor level.\nSignificant effort was also invested in the corresponding google workbook."
  },
  {
    "objectID": "30_explore.html#columns-in-the-dataframe",
    "href": "30_explore.html#columns-in-the-dataframe",
    "title": "Exploring the data",
    "section": "Columns in the dataframe",
    "text": "Columns in the dataframe\n\n# Load the CSV file into a pandas data frame.\n\nstacked_df = pd.read_csv('stacked_df.csv')\n\n# Ensure that these 3 columns are treated as strings and not as numbers.\nfor col in ['TERM','COURSE','SECT']:\n  stacked_df[col] = stacked_df[col].astype(str)\n\n# Print a list of columns\nstacked_df.columns\n\nIndex(['TERM', 'PART_OF_TERM', 'COLLEGE', 'DEPT', 'COURSE', 'SECT', 'CRN',\n       'TYPE', 'MIN CREDITS', 'MAX CREDITS',\n       ...\n       'sum_term_crse_wrkld_a_lec', 'wrkld_a_note', 'wrkld_b_type',\n       'sum_term_crse_wrkld_b', 'sum_term_crse_wrkld_b_lec', 'wrkld_b_note',\n       'wrkld_c_type', 'sum_term_crse_wrkld_c', 'sum_term_crse_wrkld_c_lec',\n       'wrkld_c_note'],\n      dtype='object', length=102)"
  },
  {
    "objectID": "30_explore.html#college-wide-measures-over-time",
    "href": "30_explore.html#college-wide-measures-over-time",
    "title": "Exploring the data",
    "section": "College-wide measures over time",
    "text": "College-wide measures over time\nThis table presents a summary of courses (e.g., CMSC 255, CMSC 355, etc.), sections (or CRN), and student enrollments by semester in our data file.\n\n\n\n\n\nTerm\nTerm Name\nCourse Sum\nCRN Sum\nStuMtg Sum\nHours Sum\n\n\n\n\n202110\nFall 2020\n149\n416\n7967\n15929\n\n\n202120\nSpring 2021\n137\n444\n7393\n16400\n\n\n202130\nSummer 2021\n25\n112\n586\n1444\n\n\n202210\nFall 2021\n154\n422\n7362\n16329\n\n\n202220\nSpring 2022\n146\n448\n7327\n16677\n\n\n202230\nSummer 2022\n29\n107\n626\n1343\n\n\n202310\nFall 2022\n159\n434\n8306\n18012\n\n\n202320\nSpring 2023\n146\n458\n7692\n17790\n\n\n202330\nSummer 2023\n25\n104\n564\n1213\n\n\n202410\nFall 2023\n157\n451\n9497\n21222"
  },
  {
    "objectID": "30_explore.html#teaching-for-fall-2023-by-subject",
    "href": "30_explore.html#teaching-for-fall-2023-by-subject",
    "title": "Exploring the data",
    "section": "Teaching for Fall 2023 by subject",
    "text": "Teaching for Fall 2023 by subject\n\n\n\n\n\nDept\nCourse Sum\nCRN Sum\nStudent Sum\nHours Sum\n\n\n\n\nCMSC\n35\n95\n3552\n9235\n\n\nEGRB\n31\n64\n994\n2211\n\n\nEGRC\n14\n40\n432\n1021\n\n\nEGRE\n32\n70\n1488\n2803\n\n\nEGRM\n32\n103\n2215\n4925\n\n\nENGR\n13\n79\n816\n1027"
  },
  {
    "objectID": "40_workload.html",
    "href": "40_workload.html",
    "title": "Workloads",
    "section": "",
    "text": "These are experimental presentations of the data."
  },
  {
    "objectID": "40_workload.html#explore-tabular-data",
    "href": "40_workload.html#explore-tabular-data",
    "title": "Workloads",
    "section": "Explore tabular data",
    "text": "Explore tabular data\n\ncols = ['instructor','ins_dept','TERM','COURSE','TITLE','wrkld_sample_type','sum_term_crse_wrkld_sample','wrkld_sample_note']\nterms = [202410,202320]\n\ndf = stacked_df[stacked_df[\"TERM\"].isin(terms)][cols]\n\nbokeh_formatters = {\n    'TERM': NumberFormatter(format='000000')\n}\n\ntable = pn.widgets.Tabulator(df,\n    show_index=False,\n    formatters=bokeh_formatters\n)\n\ntable"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Analysis of Teaching",
    "section": "",
    "text": "This web report presents an application of a sample model of faculty workload over the past two semesters (Spring 2023 and Fall 2023).\nThis is intended to be a living analysis. As additions and corrections are found please let me know and we can implement the necessary changes and re-render the report.\nThis report was developed using Quarto, an open-source scientific and technical publishing designed with reproducibility in mind. Analyses were performed using python. The source code for the pages on this site are available in a github repository."
  },
  {
    "objectID": "index.html#report-organization",
    "href": "index.html#report-organization",
    "title": "Analysis of Teaching",
    "section": "Report organization",
    "text": "Report organization\nThe site is organized as follow:\n\nDownload - this section describes the source of data (VCU reports) and shows the files and semesters downloaded. This section is provided so that others can obtain the same data used for this report.\nClean - this section documents the cleaning strategies applied to the data obtained above. This section refactors and reshapes the data, adds new columns and corrects known errors. The data are stored in this repo, and are also uploaded to this google sheet.\nExplore - this section offers several sample analysis using the cleaned data. This report is generated using python and matplotlib. The examples are offered as demonstrations of the possible, not as part of a real analysis of workload."
  },
  {
    "objectID": "index.html#rolling-your-own-model",
    "href": "index.html#rolling-your-own-model",
    "title": "Analysis of Teaching",
    "section": "Rolling your own model",
    "text": "Rolling your own model\nThe resulting dataframe is available here for download as CSV.\nThe result dataframe is also uploaded to a google workbook and a sample analysis is conducted."
  },
  {
    "objectID": "index.html#persistent-data",
    "href": "index.html#persistent-data",
    "title": "Analysis of Teaching",
    "section": "Persistent data",
    "text": "Persistent data\nThe banner report used to create this report does not contain all the necessary data to complete the analysis (e.g., instructor department).\nPersistent data are stored in a google sheet.\nInstructor data - these data provide instructor departments and instructor roles, and an instructor workload designation. This table is necessary for the analysis.\nInstructor notes - these data offer additional details about instructors. It is expected that these data might be incorporated into a subsequent workload report. This table is optional to this analysis.\nCourse notes - these data offer additional details about the courses. This table is optional to this analysis."
  },
  {
    "objectID": "35_explore2.html",
    "href": "35_explore2.html",
    "title": "Exploring instructor measures",
    "section": "",
    "text": "For this analysis we’ll be using the stacked_df data frame from the cleaning process.\nI haven’t spend much time on this. My effort to date has been spent on developing and documenting the preparing of the data at the instructor level.\nSignificant effort was also invested in the corresponding google workbook.\nHUYEN - In the workbook above:"
  },
  {
    "objectID": "35_explore2.html#columns-in-the-dataframe",
    "href": "35_explore2.html#columns-in-the-dataframe",
    "title": "Exploring instructor measures",
    "section": "Columns in the dataframe",
    "text": "Columns in the dataframe\nLoad the data frame. The OJS code would like slightly different.\n\n# Load the data frame\nstacked_df = pd.read_csv('stacked_df.csv')\n\n# Force types of these columns to be strings\nfor col in ['TERM','COURSE','SECT']:\n  stacked_df[col] = stacked_df[col].astype(str)\n\n# print the columns.  Pandas will display an abbreviated table.\nprint(stacked_df.columns)\n\nIndex(['TERM', 'PART_OF_TERM', 'COLLEGE', 'DEPT', 'COURSE', 'SECT', 'CRN',\n       'TYPE', 'MIN CREDITS', 'MAX CREDITS',\n       ...\n       'sum_term_crse_wrkld_a_lec', 'wrkld_a_note', 'wrkld_b_type',\n       'sum_term_crse_wrkld_b', 'sum_term_crse_wrkld_b_lec', 'wrkld_b_note',\n       'wrkld_c_type', 'sum_term_crse_wrkld_c', 'sum_term_crse_wrkld_c_lec',\n       'wrkld_c_note'],\n      dtype='object', length=102)"
  },
  {
    "objectID": "35_explore2.html#college-wide-measures-over-time",
    "href": "35_explore2.html#college-wide-measures-over-time",
    "title": "Exploring instructor measures",
    "section": "College-wide measures over time",
    "text": "College-wide measures over time\nKey measures for these data include:\n\nNumber of Courses : A course is designed by a course number, for example, CMSC 508 or CMSC 210 or CMSC 355. In the table below, we present the sum of unique course numbers.\nNumber of CRNs : A CRN is a “course reference number”. Often a single course will be coded in Banner using multiple CRNS, one for each unique meeting time/place. The CRN SUM column presents the sum of individual CRNs.\nStuMtgSum : number of individual student meetings. Student enroll in CRNs, not courses. The stumtgsum measure represents the sum of students across all CRN. Depending on how a course is coded, this may double count students in an individual course.\nHours Sum : There are several ways to calculate this variable. In general, this is calculated on a PER CRN basis, multiplying the unique headcount in the CRN time the credit-hour value of a course (usually, 2, 3 or 4).\n\nThe table below shows these key measures accumulated by all semesters in the data set.\n\n# Create my four desired columns\n\n# lecture hours and non-lecture hours\nstacked_df['sum_term_crse_crn_hours_lec'] = 0.0\nstacked_df['sum_term_crse_crn_hours_non_lec'] = 0.0\nstacked_df.loc[stacked_df['wrkld_sample_type'] == 'LEC', 'sum_term_crse_crn_hours_lec'] = stacked_df['sum_term_crse_crn_hours']\nstacked_df.loc[stacked_df['wrkld_sample_type'] != 'LEC', 'sum_term_crse_crn_hours_non_lec'] = stacked_df['sum_term_crse_crn_hours']\n\n# lecture workload and non-lecture workload\nstacked_df['sum_term_crse_wrkld_sample_lec'] = stacked_df['sum_term_crse_wrkld_sample_lec']\nstacked_df['sum_term_crse_wrkld_sample_non_lec'] = stacked_df['sum_term_crse_wrkld_sample'] - stacked_df['sum_term_crse_wrkld_sample_lec']\n\n\nsummary_df = stacked_df.groupby(['TERM','period_name']).agg(\n  {'sum_term_crse':'sum',\n  'sum_term_crse_crn':'sum',\n  'sum_term_crse_crn_mtg_students':'sum',\n  'sum_term_crse_wrkld_sample_lec':'sum',\n  'sum_term_crse_wrkld_sample':'sum',\n  'sum_term_crse_crn_hours':'sum'}).reset_index()\n\nMarkdown(tabulate(\n  summary_df, \n  headers=['Term','Term Name','Course Sum','CRN Sum','StuMtg Sum','Hours Sum'],\n  numalign=\"right\",stralign=\"left\",\n  showindex=False,\n  floatfmt=\".0f\"  # Format numbers without decimals\n))\n\n\n\n\n\n\nTerm\nTerm Name\nCourse Sum\nCRN Sum\nStuMtg Sum\nHours Sum\n\n\n\n\n202110\nFall 2020\n149\n416\n7967\n188\n252\n15929\n\n\n202120\nSpring 2021\n137\n444\n7393\n147\n207\n16400\n\n\n202130\nSummer 2021\n25\n112\n586\n13\n14\n1444\n\n\n202210\nFall 2021\n154\n422\n7362\n172\n228\n16329\n\n\n202220\nSpring 2022\n146\n448\n7327\n156\n218\n16677\n\n\n202230\nSummer 2022\n29\n107\n626\n15\n17\n1343\n\n\n202310\nFall 2022\n159\n434\n8306\n157\n225\n18012\n\n\n202320\nSpring 2023\n146\n458\n7692\n140\n212\n17790\n\n\n202330\nSummer 2023\n25\n104\n564\n18\n19\n1213\n\n\n202410\nFall 2023\n157\n451\n9497\n162\n237\n21222"
  },
  {
    "objectID": "35_explore2.html#aggregate-measures-over-all-semesters",
    "href": "35_explore2.html#aggregate-measures-over-all-semesters",
    "title": "Exploring instructor measures",
    "section": "Aggregate measures over all semesters",
    "text": "Aggregate measures over all semesters"
  },
  {
    "objectID": "35_explore2.html#instructor-measures-for-spring-2023-and-fall-2023.",
    "href": "35_explore2.html#instructor-measures-for-spring-2023-and-fall-2023.",
    "title": "Exploring instructor measures",
    "section": "Instructor measures for Spring 2023 and Fall 2023.",
    "text": "Instructor measures for Spring 2023 and Fall 2023.\n\n# Filter stacked data frame for the two desired terms and desired department\ndf = stacked_df[stacked_df['TERM'].isin(['202320','202410'])]\ndf = df[df['DEPT'].isin(['CMSC'])]\n\n# Create summary data frame by instructor for key measures.\nsummary_df = df.groupby(['instructor']).agg({\n  'sum_term_crse':'sum',\n  'sum_term_crse_crn_hours':'sum',\n  'sum_term_crse_wrkld_sample_lec':'sum',\n  'sum_term_crse_wrkld_sample_non_lec':'sum',\n  'sum_term_crse_crn_hours_lec':'sum',\n  'sum_term_crse_crn_hours_non_lec':'sum'\n  }).reset_index()\n\n# Sort in descending order by credit hours\nsummary_df = summary_df.sort_values(by='sum_term_crse_crn_hours', ascending=False)\nprint(summary_df)\n\n                 instructor  sum_term_crse  sum_term_crse_crn_hours  \\\n14               Duke,Debra       4.000000                   2009.0   \n31            Sparks,Claire       3.028571                   1573.0   \n8       Chaitankar,Vijender       2.000000                   1332.0   \n3          Budwell,Caroline       2.358824                   1111.0   \n30             Sonmez,Ahmet       2.000000                   1104.0   \n18            Gusukuma,Luke       3.985714                   1019.0   \n11          Dahlberg,Robert       3.108824                    864.0   \n22             Leonard,John       2.608824                    728.0   \n15            Ghosh,Preetam       2.299300                    689.0   \n10          Cranston,Daniel       2.208030                    670.0   \n17              Grove,Ralph       1.285714                    616.0   \n12        Damevski,Kostadin       3.763585                    610.5   \n5             Bulut,Eyuphan       2.776190                    599.5   \n26             Nadeem,Tamer       1.624697                    475.0   \n32          Spinola,Rodrigo       1.144538                    300.0   \n0               Ahmed,Irfan       2.271522                    259.0   \n33  Thomson-McInnes,Bridget       4.660411                    233.0   \n7        Cano Rojas,Alberto       2.227871                    221.0   \n1              Arodz,Tomasz       2.442157                    207.0   \n20            Kurgan,Lukasz       1.585714                    203.0   \n23            Luo,Changqing       2.299300                    183.0   \n24              Manic,Milos       2.212698                    172.0   \n6             Byram,Abigail       2.000000                    165.0   \n4          Buffkin,Jonathan       2.000000                    162.0   \n28            Sands,Allison       0.250000                    156.0   \n34               Traub,Adam       0.250000                    156.0   \n27            Nishi,Manziba       1.000000                    126.0   \n13               Dinh,Thang       2.136601                    110.0   \n36           Zhou,Hongsheng       2.136601                     89.0   \n25            Mizelle,Erika       1.000000                     78.0   \n21                Lee,Aaron       1.000000                     66.0   \n9            Cios,Krzysztof       0.669935                     55.0   \n2             Bennett,Jason       0.500000                     51.0   \n19         Krawczyk,Bartosz       1.058824                     27.0   \n16            Gill,Satinder       0.050000                     24.0   \n29           Shepherd,David       0.027778                     18.0   \n35                  Ye,Cang       0.027778                      9.0   \n\n    sum_term_crse_wrkld_sample_lec  sum_term_crse_wrkld_sample_non_lec  \\\n14                            10.0                            1.333333   \n31                             7.5                            0.666667   \n8                              3.5                            0.000000   \n3                              6.0                            1.333333   \n30                             4.5                            1.333333   \n18                             6.5                            1.666667   \n11                             5.5                            3.666667   \n22                             3.0                            3.000000   \n15                             3.0                            1.666667   \n10                             3.0                            1.000000   \n17                             2.5                            0.333333   \n12                             2.5                            1.500000   \n5                              2.5                            1.166667   \n26                             2.5                            2.666667   \n32                             1.5                            1.666667   \n0                              2.0                            0.666667   \n33                             2.0                            2.333333   \n7                              2.0                            1.000000   \n1                              2.0                            1.000000   \n20                             2.0                            0.666667   \n23                             2.0                            1.000000   \n24                             2.0                            0.666667   \n6                              2.0                            0.000000   \n4                              2.0                            0.000000   \n28                             1.0                            0.333333   \n34                             1.0                            0.333333   \n27                             1.0                            0.000000   \n13                             2.0                            1.333333   \n36                             2.0                            0.666667   \n25                             1.0                            0.000000   \n21                             1.0                            0.000000   \n9                              1.0                            0.666667   \n2                              0.5                            0.000000   \n19                             1.0                            0.333333   \n16                             0.0                            1.000000   \n29                             0.0                            0.000000   \n35                             0.0                            0.000000   \n\n    sum_term_crse_crn_hours_lec  sum_term_crse_crn_hours_non_lec  \n14                       1477.0                            532.0  \n31                       1265.0                            308.0  \n8                        1332.0                              0.0  \n3                        1007.0                            104.0  \n30                        836.0                            268.0  \n18                        721.0                            298.0  \n11                        786.0                             78.0  \n22                        660.0                             68.0  \n15                        591.0                             98.0  \n10                        633.0                             37.0  \n17                        524.0                             92.0  \n12                        555.0                             55.5  \n5                         510.0                             89.5  \n26                        390.0                             85.0  \n32                        261.0                             39.0  \n0                         165.0                             94.0  \n33                        150.0                             83.0  \n7                         189.0                             32.0  \n1                         189.0                             18.0  \n20                        186.0                             17.0  \n23                        117.0                             66.0  \n24                        129.0                             43.0  \n6                         165.0                              0.0  \n4                         162.0                              0.0  \n28                         78.0                             78.0  \n34                         78.0                             78.0  \n27                        126.0                              0.0  \n13                         78.0                             32.0  \n36                         66.0                             23.0  \n25                         78.0                              0.0  \n21                         66.0                              0.0  \n9                          12.0                             43.0  \n2                          51.0                              0.0  \n19                         21.0                              6.0  \n16                          0.0                             24.0  \n29                          0.0                             18.0  \n35                          0.0                              9.0"
  },
  {
    "objectID": "35_explore2.html#show-summary-table",
    "href": "35_explore2.html#show-summary-table",
    "title": "Exploring instructor measures",
    "section": "Show summary table",
    "text": "Show summary table\n\n# Print table\nMarkdown(tabulate(\n  summary_df, \n  headers=['Instructor','Crses','Hours','Wrkld LEC','Wrkld NON','Hours LEC','Hours NON'],\n  numalign=\"right\",stralign=\"left\",\n  showindex=False,\n  floatfmt=\".1f\"  # Format numbers without decimals\n))\n\n\n\n\nInstructor\nCrses\nHours\nWrkld LEC\nWrkld NON\nHours LEC\nHours NON\n\n\n\n\nDuke,Debra\n4.0\n2009.0\n10.0\n1.3\n1477.0\n532.0\n\n\nSparks,Claire\n3.0\n1573.0\n7.5\n0.7\n1265.0\n308.0\n\n\nChaitankar,Vijender\n2.0\n1332.0\n3.5\n0.0\n1332.0\n0.0\n\n\nBudwell,Caroline\n2.4\n1111.0\n6.0\n1.3\n1007.0\n104.0\n\n\nSonmez,Ahmet\n2.0\n1104.0\n4.5\n1.3\n836.0\n268.0\n\n\nGusukuma,Luke\n4.0\n1019.0\n6.5\n1.7\n721.0\n298.0\n\n\nDahlberg,Robert\n3.1\n864.0\n5.5\n3.7\n786.0\n78.0\n\n\nLeonard,John\n2.6\n728.0\n3.0\n3.0\n660.0\n68.0\n\n\nGhosh,Preetam\n2.3\n689.0\n3.0\n1.7\n591.0\n98.0\n\n\nCranston,Daniel\n2.2\n670.0\n3.0\n1.0\n633.0\n37.0\n\n\nGrove,Ralph\n1.3\n616.0\n2.5\n0.3\n524.0\n92.0\n\n\nDamevski,Kostadin\n3.8\n610.5\n2.5\n1.5\n555.0\n55.5\n\n\nBulut,Eyuphan\n2.8\n599.5\n2.5\n1.2\n510.0\n89.5\n\n\nNadeem,Tamer\n1.6\n475.0\n2.5\n2.7\n390.0\n85.0\n\n\nSpinola,Rodrigo\n1.1\n300.0\n1.5\n1.7\n261.0\n39.0\n\n\nAhmed,Irfan\n2.3\n259.0\n2.0\n0.7\n165.0\n94.0\n\n\nThomson-McInnes,Bridget\n4.7\n233.0\n2.0\n2.3\n150.0\n83.0\n\n\nCano Rojas,Alberto\n2.2\n221.0\n2.0\n1.0\n189.0\n32.0\n\n\nArodz,Tomasz\n2.4\n207.0\n2.0\n1.0\n189.0\n18.0\n\n\nKurgan,Lukasz\n1.6\n203.0\n2.0\n0.7\n186.0\n17.0\n\n\nLuo,Changqing\n2.3\n183.0\n2.0\n1.0\n117.0\n66.0\n\n\nManic,Milos\n2.2\n172.0\n2.0\n0.7\n129.0\n43.0\n\n\nByram,Abigail\n2.0\n165.0\n2.0\n0.0\n165.0\n0.0\n\n\nBuffkin,Jonathan\n2.0\n162.0\n2.0\n0.0\n162.0\n0.0\n\n\nSands,Allison\n0.2\n156.0\n1.0\n0.3\n78.0\n78.0\n\n\nTraub,Adam\n0.2\n156.0\n1.0\n0.3\n78.0\n78.0\n\n\nNishi,Manziba\n1.0\n126.0\n1.0\n0.0\n126.0\n0.0\n\n\nDinh,Thang\n2.1\n110.0\n2.0\n1.3\n78.0\n32.0\n\n\nZhou,Hongsheng\n2.1\n89.0\n2.0\n0.7\n66.0\n23.0\n\n\nMizelle,Erika\n1.0\n78.0\n1.0\n0.0\n78.0\n0.0\n\n\nLee,Aaron\n1.0\n66.0\n1.0\n0.0\n66.0\n0.0\n\n\nCios,Krzysztof\n0.7\n55.0\n1.0\n0.7\n12.0\n43.0\n\n\nBennett,Jason\n0.5\n51.0\n0.5\n0.0\n51.0\n0.0\n\n\nKrawczyk,Bartosz\n1.1\n27.0\n1.0\n0.3\n21.0\n6.0\n\n\nGill,Satinder\n0.1\n24.0\n0.0\n1.0\n0.0\n24.0\n\n\nShepherd,David\n0.0\n18.0\n0.0\n0.0\n0.0\n18.0\n\n\nYe,Cang\n0.0\n9.0\n0.0\n0.0\n0.0\n9.0"
  },
  {
    "objectID": "35_explore2.html#plot-total-hours-without-colors",
    "href": "35_explore2.html#plot-total-hours-without-colors",
    "title": "Exploring instructor measures",
    "section": "Plot total hours without colors",
    "text": "Plot total hours without colors"
  },
  {
    "objectID": "35_explore2.html#hours-lec-and-non-lec-by-instructor",
    "href": "35_explore2.html#hours-lec-and-non-lec-by-instructor",
    "title": "Exploring instructor measures",
    "section": "Hours (lec and non-lec) by instructor",
    "text": "Hours (lec and non-lec) by instructor\n\nfig, ax = plt.subplots(figsize=(10, 6))\n\nsummary_df = summary_df.sort_values(by='sum_term_crse_crn_hours_lec', ascending=False)\n\ninstructors = summary_df['instructor'].str.split(\",\").str[0]\nlec_hours = summary_df['sum_term_crse_crn_hours_lec']\nnon_lec_hours = summary_df['sum_term_crse_crn_hours_non_lec']\n\n#bottom = np.zeros(len(instructors))\n\np1 = ax.barh(instructors, lec_hours, label='LEC', color='blue')\np2 = ax.barh(instructors, non_lec_hours, left=lec_hours, label='Non-LEC', color='orange')\n\nax.set_xlabel('Total Hours')\nax.set_ylabel('Instructor')\nax.set_title('Instructor Hours by LEC and Non-LEC')\nax.legend()\n\nplt.tick_params(axis='y', labelsize=6)  # Adjust the labelsize as needed\n\nplt.gca().invert_yaxis()\nplt.show()"
  },
  {
    "objectID": "35_explore2.html#workload-by-instructor-and-non-instructor",
    "href": "35_explore2.html#workload-by-instructor-and-non-instructor",
    "title": "Exploring instructor measures",
    "section": "Workload by instructor and non-instructor",
    "text": "Workload by instructor and non-instructor\n\nfig, ax = plt.subplots(figsize=(10, 6))\n\nsummary_df = summary_df.sort_values(by='sum_term_crse_wrkld_sample_lec', ascending=False)\n\ninstructors = summary_df['instructor'].str.split(\",\").str[0]\nlec = summary_df['sum_term_crse_wrkld_sample_lec']\nnon_lec = summary_df['sum_term_crse_wrkld_sample_non_lec']\n\n#bottom = np.zeros(len(instructors))\n\np1 = ax.barh(instructors, lec, label='LEC', color='blue')\np2 = ax.barh(instructors, non_lec, left=lec, label='Non-LEC', color='orange')\n\nax.set_xlabel('Total Hours')\nax.set_ylabel('Instructor')\nax.set_title('Instructor Workload by LEC and Non-LEC')\nax.legend()\n\nplt.tick_params(axis='y', labelsize=6)  # Adjust the labelsize as needed\n\nplt.gca().invert_yaxis()\nplt.show()"
  },
  {
    "objectID": "35_explore2.html#practice-with-multiple-bars",
    "href": "35_explore2.html#practice-with-multiple-bars",
    "title": "Exploring instructor measures",
    "section": "Practice with multiple bars",
    "text": "Practice with multiple bars\n\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport random\n\ninstructors = ['Instructor ' + chr(65 + i) for i in range(25)]\nvalues1 = [random.uniform(0., 7.) for _ in range(25)]\nvalues2 = [random.uniform(0., 7,) for _ in range(25)]\n\ndata = {\n    'Instructor': instructors,\n    'Value1': values1,\n    'Value2': values2,\n}\n\n# Create a DataFrame\ndf = pd.DataFrame(data)\ndf = df.sort_values(by='Value2', ascending=True)\n\n# Set the figure size\nplt.figure(figsize=(8, 4))\n\n# Create the left subplot (left bar)\nax1 = plt.subplot(121)\nax1.barh(df['Instructor'], -1.0 * df['Value1'], color='green', label='Left Bar')\nax1.set_xlim(-7, 0)  # Set x-axis limits\nax1.set_xlabel('Values')\nax1.set_title('Left Bar')\nax1.set_yticklabels([\"\"] * len(df['Instructor']))\nax1.yaxis.tick_right()  # Move y-axis ticks to the right\n#ax1.set_yticklabels([])  # Remove y-axis labels\n\n# Remove border from the left subplot\nax1.spines['top'].set_visible(False)\nax1.spines['right'].set_visible(False)\n\n# Create the right subplot (right bar)\nax2 = plt.subplot(122)\nax2.barh(df['Instructor'], df['Value2'], color='blue', label='Right Bar')\nax2.set_xlim(0, 7)  # Set x-axis limits\nax2.set_xlabel('Values')\nax2.set_title('Right Bar')\n\n# Remove border from the right subplot\nax2.spines['top'].set_visible(False)\nax2.spines['left'].set_visible(False)\n#ax2.yaxis.tick_right()  # Move y-axis ticks to the right\n\n# Adjust spacing between subplots\nplt.tight_layout()\nplt.tick_params(axis='y', labelsize=6)  # Adjust the labelsize as needed\n\n# Show the plot\nplt.show()\n\n/var/folders/18/psjn4k0d4dq6666tll98386w0000gn/T/ipykernel_6927/2059536265.py:28: UserWarning: set_ticklabels() should only be used with a fixed number of ticks, i.e. after set_ticks() or using a FixedLocator.\n  ax1.set_yticklabels([\"\"] * len(df['Instructor']))"
  },
  {
    "objectID": "10_download.html",
    "href": "10_download.html",
    "title": "Downloading the data",
    "section": "",
    "text": "Data were pulled from the VCU Reporting Center in the Staff | Course Schedule Report as shown below:\nReports are run by semester for the College of Engineering and stored in separate files. Care should be taken to open each file after it’s been saved and RESAVE the file into XLSX format.\n\n\n\n\n\n\n\n\n\n\nThe files are named appropriately and stored in the data folder in this repository.\n\n\n\n\n\nFile name\nTerm Code\nAcad Year\nPeriod Code\nPeriod Name\n\n\n\n\nVCU-SOC-202130-SU2021.xlsx\n202130\nAY20-21\nSU2021\nSummer 2021\n\n\nVCU-SOC-202330-SU2023.xlsx\n202330\nAY22-23\nSU2023\nSummer 2023\n\n\nVCU-SOC-202220-SP2022.xlsx\n202220\nAY21-22\nSP2022\nSpring 2022\n\n\nVCU-SOC-202230-SU2022.xlsx\n202230\nAY21-22\nSU2022\nSummer 2022\n\n\nVCU-SOC-202310-FA2022.xlsx\n202310\nAY22-23\nFA2022\nFall 2022\n\n\nVCU-SOC-202320-SP2023.xlsx\n202320\nAY22-23\nSP2023\nSpring 2023\n\n\nVCU-SOC-202410-FA2023.xlsx\n202410\nAY23-24\nFA2023\nFall 2023\n\n\nVCU-SOC-202110-FA2020.xlsx\n202110\nAY20-21\nFA2020\nFall 2020\n\n\nVCU-SOC-202120-SP2021.xlsx\n202120\nAY20-21\nSP2021\nSpring 2021\n\n\nVCU-SOC-202210-FA2021.xlsx\n202210\nAY21-22\nFA2021\nFall 2021\n\n\n\n\n\nThese data are difficult to work in separate files and often contain incorrect or inconsistent data. A significant process of data cleaning was undertaken prior to computing workloads."
  },
  {
    "objectID": "10_download.html#data-sources",
    "href": "10_download.html#data-sources",
    "title": "Downloading the data",
    "section": "",
    "text": "Data were pulled from the VCU Reporting Center in the Staff | Course Schedule Report as shown below:\nReports are run by semester for the College of Engineering and stored in separate files. Care should be taken to open each file after it’s been saved and RESAVE the file into XLSX format.\n\n\n\n\n\n\n\n\n\n\nThe files are named appropriately and stored in the data folder in this repository.\n\n\n\n\n\nFile name\nTerm Code\nAcad Year\nPeriod Code\nPeriod Name\n\n\n\n\nVCU-SOC-202130-SU2021.xlsx\n202130\nAY20-21\nSU2021\nSummer 2021\n\n\nVCU-SOC-202330-SU2023.xlsx\n202330\nAY22-23\nSU2023\nSummer 2023\n\n\nVCU-SOC-202220-SP2022.xlsx\n202220\nAY21-22\nSP2022\nSpring 2022\n\n\nVCU-SOC-202230-SU2022.xlsx\n202230\nAY21-22\nSU2022\nSummer 2022\n\n\nVCU-SOC-202310-FA2022.xlsx\n202310\nAY22-23\nFA2022\nFall 2022\n\n\nVCU-SOC-202320-SP2023.xlsx\n202320\nAY22-23\nSP2023\nSpring 2023\n\n\nVCU-SOC-202410-FA2023.xlsx\n202410\nAY23-24\nFA2023\nFall 2023\n\n\nVCU-SOC-202110-FA2020.xlsx\n202110\nAY20-21\nFA2020\nFall 2020\n\n\nVCU-SOC-202120-SP2021.xlsx\n202120\nAY20-21\nSP2021\nSpring 2021\n\n\nVCU-SOC-202210-FA2021.xlsx\n202210\nAY21-22\nFA2021\nFall 2021\n\n\n\n\n\nThese data are difficult to work in separate files and often contain incorrect or inconsistent data. A significant process of data cleaning was undertaken prior to computing workloads."
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "This site was creating in quarto."
  },
  {
    "objectID": "20_clean.html",
    "href": "20_clean.html",
    "title": "Cleaning the data",
    "section": "",
    "text": "This script describes the data and walks through a process of data cleaning.\nAt completion of this script all the individual semester data files will be combined into a single dataframe for analysis, and the dataframe will be refactored for cleaner analysis.\nTLDR: Here is a link to the cleaned dataframe. This dataframe contains one tuple per (TERM,CRN,INSTRUCTOR,MEETING_CODE).\nTLDR: Here is a link to the google sheet with the cleaned data loaded in the “source data” tab and other sheets referencing the source data."
  },
  {
    "objectID": "20_clean.html#data-sources",
    "href": "20_clean.html#data-sources",
    "title": "Cleaning the data",
    "section": "Data sources",
    "text": "Data sources\nThe files are named appropriately and stored in the data folder in this repository."
  },
  {
    "objectID": "20_clean.html#data-cleaning",
    "href": "20_clean.html#data-cleaning",
    "title": "Cleaning the data",
    "section": "Data Cleaning",
    "text": "Data Cleaning\nThe following sections combine the individual sources of data and clean them up.\n\nCombining to single data frame\nThe following section combines each XLSX into a single data frame. The contents of the files are variable in length depending on the number of sections taught during any given semester.\nThe appropriate block starts one row after the row with the keyword TERM in the first column, denoting the header row. The appropriate block ends with the row prior to the row with the keyword N =.\nWe’re assuming that all xlsx workbooks share the same columns and names.\n\n# Initialize an empty list to store trimmed DataFrames\ntrimmed_dfs = []\n\n# Iterate through the list of XLSX file names\nfor file_name in xlsx_df['file_name']:\n    # Load the XLSX file into a DataFrame\n    full_path = os.path.join(directory_path, file_name)\n    df = pd.read_excel(full_path)\n    \n    # Find the row index where \"TERM\" is in the first column\n    term_index = df.index[df.iloc[:, 0] == \"TERM\"].tolist()[0]\n    \n    # Find the row index where \"N=\" is in the first column\n    n_index = df.index[df.iloc[:, 0].str.startswith(\"N =\").fillna(False)].tolist()[0]\n\n    # Clip the desired block and add column names\n    trimmed_df = df.loc[term_index + 1 : n_index - 1]\n    trimmed_df.columns = df.iloc[term_index].values\n\n    # Append the trimmed DataFrame to the list\n    trimmed_dfs.append(trimmed_df)\n\n# Combine the individual dataframes into one big one.\nsections_df = pd.concat(trimmed_dfs, ignore_index=True)\n\n\n\nMerge in the term and period data from the xlsx_df dataframe\nThe following code merges in the term and period data with the section data. First ensure that the key columns are strings, then merge away.\n\nsections_df['SECT'] = sections_df['SECT'].astype(str)\nsections_df['TERM'] = sections_df['TERM'].astype(str)\nxlsx_df['term_code'] = xlsx_df['term_code'].astype(str)\nsections_df = pd.merge(sections_df,xlsx_df,left_on='TERM', right_on='term_code', how='left')\n\n\n\nFix known errors\nThe data in Banner doesn’t always reflect reality. This step corrects known errors in the data.\nNote that the section data are stored one row per term-crn-meeting period.\nThe purpose of this section is to demonstrate an auditable process for documenting changes to the source data.\nThere is nothing magic about the changes below. As I shared the data with others, they found that the banner data did not reflect reality. For this workload analysis we want the data to reflect reality, so we fix it.\nAdditional fixes are expected to be added as new eyes look at their data.\n\n# Spring 2023: CMSC475 John Leonard taught for David Shepherd\nfix_sections(1,'Swap Leonard for Shepherd',{'TERM':'202320','CRN':'43471'},{'PRIMARY INSTRUCTOR FIRST NAME':'John','PRIMARY INSTRUCTOR LAST NAME':'Leonard'})\n\n# Fall 2024: CMSC391 is cross listed with COAR463.\n# Total enrollment 34 across two instructors (Bennett and Leonard)\n# Currently Banner shows only 20 in the JL section and doesn't mention the COAR section.\nfix_sections(2,'Fix incorrect cross listing',{'TERM':'202410','CRN':'46263'},{'ACTUAL ENROLLMENT':34})\n\nfix_sections(3,\"Remove Duke as 2nd instructor\",{'TERM':'202410','CRN':'40553'},{'SECONDARY INSTRUCTOR FIRST NAME':'','SECONDARY INSTRUCTOR LAST NAME':''})\nfix_sections(4,\"Remove Duke as 2nd instructor\",{'TERM':'202410','CRN':'40554'},{'SECONDARY INSTRUCTOR FIRST NAME':'','SECONDARY INSTRUCTOR LAST NAME':''})\nfix_sections(5,\"Remove Duke as 2nd instructor\",{'TERM':'202410','CRN':'40555'},{'SECONDARY INSTRUCTOR FIRST NAME':'','SECONDARY INSTRUCTOR LAST NAME':''})\n\nfix_sections(6,\"Remove Sparks as 2nd instructor\",{'TERM':'202320','CRN':'17442'},{'SECONDARY INSTRUCTOR FIRST NAME':'','SECONDARY INSTRUCTOR LAST NAME':''})\nfix_sections(7,\"Remove Duke as 2nd instructor\",{'TERM':'202320','CRN':'33698'},{'SECONDARY INSTRUCTOR FIRST NAME':'','SECONDARY INSTRUCTOR LAST NAME':''})\nfix_sections(8,\"Remove Duke as 2nd instructor\",{'TERM':'202320','CRN':'41891'},{'SECONDARY INSTRUCTOR FIRST NAME':'','SECONDARY INSTRUCTOR LAST NAME':''})\nfix_sections(9,\"Capstone common course is LEC not SEM\",{'TERM':'202320','CRN':'45290'},{'TYPE':'LEC'})\n\n\n\nReshape the data\nThe current dataframe sections_df contains one record per term-crn-meeting period tuple. Within each tuple there can be up to 2 instructors. We need to reshape the data with the instructors in a single column.\nWhile we’re here we can combine instructor first and last name, and drop verbose columns.\n\ncols = sections_df.columns\nvalues_to_remove = ['PRIMARY INSTRUCTOR FIRST NAME','PRIMARY INSTRUCTOR LAST NAME','SECONDARY INSTRUCTOR FIRST NAME','SECONDARY INSTRUCTOR LAST NAME']\ncols = [x for x in cols if x not in values_to_remove]\n\nsections_df['ins1_last'] = sections_df['PRIMARY INSTRUCTOR LAST NAME']\nsections_df['ins1_first'] = sections_df['PRIMARY INSTRUCTOR FIRST NAME']\nsections_df['ins2_last'] = sections_df['SECONDARY INSTRUCTOR LAST NAME']\nsections_df['ins2_first'] = sections_df['SECONDARY INSTRUCTOR FIRST NAME']\nsections_df['instructor_1'] = sections_df['ins1_last']+sections_df['ins1_first'].apply(lambda x: ',' if x != \"\" else \"\")+sections_df['ins1_first']\nsections_df['instructor_2'] = sections_df['ins2_last']+sections_df['ins2_first'].apply(lambda x: ',' if x != \"\" else \"\")+sections_df['ins2_first']\nsections_df['instructor_1'].fillna('',inplace=True)\nsections_df['instructor_2'].fillna('',inplace=True)\n\nstacked_df = pd.melt(sections_df,\n    id_vars=cols,\n    value_vars=['instructor_1','instructor_2'],\n    var_name='instructor source',\n    value_name='instructor'\n)\n\n\n\nClean up rows\nThe process above introduces records with missing instructor_2. This code removes records missing instructor_2.\n\n# remove rows with empty instructor 1.  Keep rows with empty instructor 1.\nstacked_df = stacked_df[ ~ ((stacked_df['instructor source']=='instructor_2') & (stacked_df['instructor']=='')) ]\n\nIn some summer courses an instructor was not listed in the data. An instructor name is generated using the course and semester. This can be cleaned later.\n\n# replace any missing instructors with note\nstacked_df.loc[stacked_df[\"instructor\"].isin(['']),\"instructor\"] = stacked_df[stacked_df[\"instructor\"].isin([''])]['COURSE']+' '+stacked_df[stacked_df[\"instructor\"].isin([''])]['TERM']+' '+stacked_df[stacked_df[\"instructor\"].isin([''])]['CRN']\n\nSome sections, for example RES sections or cancelled sections have zero enrollments. These are removed, keeping only sections with positive enrollments.\n\n# drop rows with zero enrollments\nstacked_df = stacked_df[stacked_df['ACTUAL ENROLLMENT']>0]\n\nWhile not necessary, the resulting dataframe can be sorted so that it looks pretty when saved to a CSV.\n\n# Sort the data frame so it looks pretty in the output file.\nstacked_df = stacked_df.sort_values(['TERM','DEPT','COURSE','SECT','instructor source','instructor'])\n\n\n\nAdd additional data columns\nWe may need the subject and the course number in the workload model analysis.\n\nstacked_df[\"course_subject\"] = stacked_df[\"COURSE\"].str[:4]\nstacked_df[\"course_number\"] = stacked_df[\"COURSE\"].str[4:]\n\nFor each section, add a new field with the count of instructors sharing this section. This helps with workload and other computations later.\n\n# Number of instructors sharing a common CRN.\nstacked_df[\"instructor_cnt\"] = stacked_df.groupby(['TERM','COURSE','CRN'])['CRN'].transform('count') / stacked_df.groupby(['TERM','COURSE','CRN','instructor'])['instructor'].transform('count') \n\nstacked_df[\"capstone_cnt\"] = 0.0  # used downstream to provide an actual capstone count rather than an estimated count of capstone sections.\n\nIt’s getting old adding new columns, then having to rework the formuluas in the rather brittle google sheet. I’m adding a few spare columns here to be used as necessary. This is the best place to add the new columns, just prior to the calculation of the aggregate measures and workload attributes.\n\nstacked_df[\"lec_only_course_list\"] = \"\"\nstacked_df[\"spare_col_2\"] = 0\nstacked_df[\"spare_col_3\"] = 0\nstacked_df[\"spare_col_4\"] = 0\nstacked_df[\"spare_col_5\"] = 0\nstacked_df[\"spare_col_6\"] = 0\n\n\n\nMerge persistent instructor data\nThe Banner report that we’re using for this analysis does not include all the necessary data for a proper analysis. The report infers the offering department of the course (e.g., ENGR497 or CMSC475), but not the home department of the instructor. For example, capstone courses are coded ad ENGR497, but the record won’t include the home department of the instructor, making it difficult to roll up all the courses by home department of the instructor.\nWe store persistent instructor and course data in a separate google sheet. As these persistent data are changed or corrected, this analysis should be regenerated to use these amended data.\nThe code below merges the persistent instructor data from the google sheet into the working dataframe.\n\n# Define the scope\nscope = ['https://www.googleapis.com/auth/spreadsheets']\n\n# Start the OAuth flow\nflow = InstalledAppFlow.from_client_secrets_file(\n    '/Users/winniehuynh81/Desktop/vcussg_dashboards/client_secret_5229018863-5m24tu79nikg6ik3hfh3aunndkip9hn3.apps.googleusercontent.com.json', scope)\ncredentials = flow.run_local_server(port=0)\n\n# authorize the client\n# creds = ServiceAccountCredentials.from_json_keyfile_name(credential_file, scope)\nclient = gspread.authorize(credentials)\n\nspreadsheet_key = \"1ZK7k8M85CXLof6FdeJYJuGFbfjsOXrCv5mc7OgUInWw\"\nworksheet_name = \"Instructor data\"\nsheet = client.open_by_key(spreadsheet_key).worksheet(worksheet_name)\ninstructor_df = get_as_dataframe(worksheet=sheet, evaluate_formulas=True )\n\nstacked_df = pd.merge( stacked_df,instructor_df,left_on='instructor',right_on='instructor',how='left')\n\nworksheet_name = \"Instructor notes\"\nsheet = client.open_by_key(spreadsheet_key).worksheet(worksheet_name)\ninstructor_notes_df = get_as_dataframe(worksheet=sheet, evaluate_formulas=True )\n\nstacked_df = pd.merge( stacked_df,instructor_notes_df,left_on='instructor',right_on='instructor',how='left')\n\nPlease visit this URL to authorize this application: https://accounts.google.com/o/oauth2/auth?response_type=code&client_id=5229018863-5m24tu79nikg6ik3hfh3aunndkip9hn3.apps.googleusercontent.com&redirect_uri=http%3A%2F%2Flocalhost%3A51300%2F&scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fspreadsheets&state=drc8NawCrL08OL8wRuULUmXAqePodY&access_type=offline\n\n\n\n\nMerge persistent course data\nPersistent course data is also stored in the google sheet and merged with the working dataframe.\n\n# spreadsheet_key = \"1ZK7k8M85CXLof6FdeJYJuGFbfjsOXrCv5mc7OgUInWw\" from above!\nworksheet_name = \"Course notes\"\nsheet = client.open_by_key(spreadsheet_key).worksheet(worksheet_name)\ncourse_notes_df = get_as_dataframe(worksheet=sheet, evaluate_formulas=True )\n\nstacked_df = pd.merge( stacked_df,course_notes_df,left_on='COURSE',right_on='crse',how='left')\n\n\n\nIdentify shared rooms\nSome CRN share the same classroom and instructor. Examples might include an UG and GR section sharing the same lecture, or multiple LEC/LAB combos sharing the same LEC with different LAB rooms and time.\nTo properly identify shared lectures we need to identify unique combinations of days of week and rooms and assign store these values for later aggregation.\n\ntime_cols = ['MON-IND','TUE-IND','WED-IND','THU-IND','FRI-IND','SAT-IND','SUN-IND','BEGIN TIME','END TIME']\nroom_cols = ['BUILDING','ROOM']\n\nstacked_df[\"time_code\"] = \"\"\nfor col in time_cols:\n    stacked_df[col] = stacked_df[col].fillna('.')\n    stacked_df[\"time_code\"] = stacked_df[\"time_code\"] + stacked_df[col].astype(str)\nstacked_df['time_id'] = pd.factorize(stacked_df['time_code'])[0]\n\nstacked_df[\"room_code\"] = \"\"\nfor col in room_cols:\n    stacked_df[col] = stacked_df[col].fillna('.')\n    stacked_df[\"room_code\"] = stacked_df[\"room_code\"] + stacked_df[col].astype(str)\nstacked_df['room_id'] = pd.factorize(stacked_df['room_code'])[0]\n\nstacked_df[\"meeting_code\"] = stacked_df[\"room_code\"] + stacked_df[\"time_code\"]\nstacked_df['meeting_id'] = pd.factorize(stacked_df['meeting_code'])[0]\n\nday_cols = ['MON-IND','TUE-IND','WED-IND','THU-IND','FRI-IND','SAT-IND','SUN-IND']\nstacked_df[\"mtgs_per_wk\"] = 0\nfor col in day_cols:\n    stacked_df[col] = stacked_df[col].fillna('.')\n    stacked_df['mtgs_per_wk'] = stacked_df[\"mtgs_per_wk\"] + (stacked_df[col] != \".\").astype(int)\n\nstacked_df[\"BEGIN TIME\"] = stacked_df[\"BEGIN TIME\"].replace(\".\",\"0\")\nstacked_df[\"END TIME\"] = stacked_df[\"END TIME\"].replace(\".\",\"0\")\nstacked_df['mtg_length'] = stacked_df[\"END TIME\"].astype(int) - stacked_df[\"BEGIN TIME\"].astype(int)\n\nstacked_df['shared_mtgs_cnt'] =  stacked_df.groupby(['TERM','instructor','time_id'])['time_id'].transform('count')\nstacked_df.loc[(stacked_df['time_code'].isin(['.........'])),'shared_mtgs_cnt'] = 1\n\nstacked_df['mtgs_per_crn'] =  stacked_df.groupby(['TERM','CRN','instructor'])['CRN'].transform('count')\n\n\n\nFind all courses taught by same instructor at the same time\nThis code builds a list of separate courses taught by an instructor at the same time. This code is similar to the code above with the enhancement that it produces an explicit list of courses that share the same room and time.\n\ndef concat_courses(group):\n    return ','.join(group['COURSE'])\n\ntemp_df = pd.DataFrame();\nkeys = ['TERM','instructor','time_code']\ntemp_df[\"concat\"] = stacked_df.groupby(keys).apply(concat_courses)\ntemp_df[\"list\"] = temp_df[\"concat\"].apply( lambda x :  list(set(x.split(\",\"))) )\ntemp_df[\"combined_count\"] = temp_df[\"list\"].apply( lambda x :  len(x) )\ntemp_df[\"combined_sections\"] = temp_df[\"list\"].apply( lambda x :  \",\".join(x) )\ntemp_df = temp_df.reset_index()\ntemp_df = temp_df[ (temp_df['time_code']!='.........')&(temp_df['combined_count']>1)]\ntemp_df = temp_df[['TERM','instructor','time_code','combined_count','combined_sections']]\nstacked_df = pd.merge(stacked_df,temp_df,left_on=keys, right_on=keys,how=\"left\")\n\n\n\nCGEP: convert to IND rather than LEC from workload perspective\nCardinal Education (formally known as the Commonwealth Graduate Engineering Program (CGEP)) is a collaborative effort among six participating universities and institutions throughout the Commonwealth of Virginia. It utilizes virtual learning classrooms and education technology in synchronous and asynchronous formats to provide working engineers the opportunity to earn a master’s degree in engineering from any of the six participating universities/institutions.\nCGEP courses hosted at VCU are coded as LEC in Banner and must be associated with a VCU instructor. This ensures that the student receives proper credit towards graduation. However, from a workload perspective, these courses do not require local instructor preparation or teaching effort.\nThis section recodes CGEP courses to independent study (IND).\n\n# Function to set the 'TYPE' column based on a string search in 'TITLE'\ndef set_type_based_on_search(row):\n    title = row['TITLE']\n    newtype = row['TYPE']\n    if 'CGEP' in title:\n        newtype = 'IND'\n    return newtype\n\n# Apply the function to the entire DataFrame\nstacked_df['TYPE'] = stacked_df.apply(set_type_based_on_search, axis=1)\n\nNote that additional spare columns are added to persistent instructor and course google sheets.\n\n\nCompute appropriate aggregate measures\nThese measures are used in later calculations for numbers of courses, sections, instructors, etc.\nThese computations are normalized to the appropriate group so that they sum to the correct values when aggregated at the specified group level.\n\n# Create various aggregate columns\nstacked_df['sum_term'] = 1.0 / stacked_df.groupby(['TERM'])['TERM'].transform('count')\nstacked_df['sum_term_crse'] = 1.0 / stacked_df.groupby(['TERM','COURSE'])['COURSE'].transform('count')\nstacked_df['sum_term_crse_crn'] = 1.0 / stacked_df.groupby(['TERM','COURSE','CRN','time_code'])['CRN'].transform('count') / stacked_df['mtgs_per_crn']\nstacked_df['sum_term_crse_crn_mtg_students'] = stacked_df['ACTUAL ENROLLMENT'] * stacked_df['sum_term_crse_crn'] * stacked_df['mtgs_per_crn']\nstacked_df['sum_term_crse_crn_hours'] =  stacked_df['sum_term_crse_crn_mtg_students'] * stacked_df['MAX CREDITS']  / stacked_df['mtgs_per_crn']\n\n\n\nPlaceholder Workload model assignments\nThese are placeholders for any proposed workload model based on course and instructor attributes.\nFor each workload model, there is a:\n\nsum_term_crse_wrkld containing the numeric assignment of workload for that entry in the dataframe.\nwrkld__type* containing the recoded course type. For example, some LEC sections that are actually labs are coded labs. Capstones are also highlighted.\nwrkld_note containing a note about the specific workload assignment.\n\n\nstacked_df['wrkld_sample_type'] = stacked_df['TYPE']\nstacked_df['sum_term_crse_wrkld_sample'] = 0.0\nstacked_df['sum_term_crse_wrkld_sample_lec'] = 0.0\nstacked_df['wrkld_sample_note'] = \"\"\nstacked_df['wrkld_a_type'] = stacked_df['TYPE']\nstacked_df['sum_term_crse_wrkld_a'] = 0.0\nstacked_df['sum_term_crse_wrkld_a_lec'] = 0.0\nstacked_df['wrkld_a_note'] = \"\"\nstacked_df['wrkld_b_type'] = stacked_df['TYPE']\nstacked_df['sum_term_crse_wrkld_b'] = 0.0\nstacked_df['sum_term_crse_wrkld_b_lec'] = 0.0\nstacked_df['wrkld_b_note'] = \"\"\nstacked_df['wrkld_c_type'] = stacked_df['TYPE']\nstacked_df['sum_term_crse_wrkld_c'] = 0.0\nstacked_df['sum_term_crse_wrkld_c_lec'] = 0.0\nstacked_df['wrkld_c_note'] = \"\""
  },
  {
    "objectID": "20_clean.html#sample-workload-model",
    "href": "20_clean.html#sample-workload-model",
    "title": "Cleaning the data",
    "section": "Sample workload model",
    "text": "Sample workload model\nThis is the sample workload model. The assigned faculty workoad will be stored in the sum_term_crse_wrklod_sample field. Here is the model:\n\nmodel_sample = {\n    'base_lecture_value':1.0,\n    'labs_per_lecture':3.0,\n    'vips_per_lecture':3.0,\n    'capstones_per_lecture': 3.0,\n    'students_per_capstone': 4.0,\n    'seminars_per_lecture': 1.0,\n    'res_ind_fld_per_lecture': 0.0,\n    'large_classes': [ [80,1.5],[160,2.0],[240,2.5] ]\n}\n\n\nEach section/CRN is worth a full teaching credit.\nResearch, indepedent study and coop/intern sections receive zero teaching credit in this workload model. Instructors receive credit through their salary if they’re staff. Research active faculty get reduced teaching loads.\nLab sections including actual course labs, capstone/senior design, and VIP receive 1/3 credit. This is consistent with the model that 3 lab hours is equivalent to 1 teaching hour. (e.g., 3-3-4 courses.) NOTE that laboratory sections are NOT coded as separate labs, rather they are coded as LEC making it difficult to discern these. See EGRE306 for an example.\nSeminar sections get full section credit as a positive incentive. There is a limited number of SEM courses, they are important to the curriculum, and we want them covered.\nCapstone designs are scaled to give one LAB (0.33 per above) unit per groups of 4 students.\n\n\nAssign BASE workload to all sections\nAssign base workload to all records. All sections independent of section type start with a base workload of 1.\nAdjust base workload for courses shared by multiple instructors.\nIn some cases, a shared instructor was included in Banner so that the shared instructor could monitor the course in Canvas only, without offering additional teaching effort. In these cases, I recommend adding a “FIX” (listed above) to remove the secondary instructor from the workload data, ensuring that they don’t get credit for a class they aren’t actually co-teaching.\n\n# Assign standard workload : One teaching course shared across multiple instructors\nstacked_df[\"sum_term_crse_wrkld_sample\"] = model_sample['base_lecture_value']\n# Update note\nstacked_df.loc[(stacked_df['wrkld_sample_type']=='LEC'),'wrkld_sample_note'] = \"BASE: [wrkld] \"\n\n# Adjust for multiple instructors\nstacked_df[\"sum_term_crse_wrkld_sample\"] = stacked_df[\"sum_term_crse_wrkld_sample\"] / stacked_df[\"instructor_cnt\"]\n# Update note\nstacked_df.loc[(stacked_df['wrkld_sample_type']=='LEC')&(stacked_df['instructor_cnt']>1.0),'wrkld_sample_note'] = \"BASE: [wrkld] / (2 co-teaching) \"\n\n\n\nAdjust for courses taught at same time by same instructor\n\n# adjust workload for CRN sharing same teaching time\nstacked_df.loc[(stacked_df['shared_mtgs_cnt']>1),'sum_term_crse_wrkld_sample'] = stacked_df.loc[(stacked_df['shared_mtgs_cnt']>1),'sum_term_crse_wrkld_sample'] / stacked_df.loc[(stacked_df['shared_mtgs_cnt']>1),'shared_mtgs_cnt'] \n\n# Update note to reflect adjustment\nstacked_df.loc[(stacked_df['shared_mtgs_cnt']>1),'wrkld_sample_note'] = (\n  stacked_df.loc[(stacked_df['shared_mtgs_cnt']>1),'wrkld_sample_note'] + \"/ \" + \n  stacked_df.loc[(stacked_df['shared_mtgs_cnt']>1),'shared_mtgs_cnt'].astype(str) +\" CRN at same time\"\n)\n\n\n\nAdjust for capstone workloads\nCapstone / senior design courses are coded differently in each department within the college. Further, some of these course numbers change over time (across semesters).\nA list of capstone courses was assembled manually and then applied to convert the capstone sections to CAP.\nThis code is applied in two steps with an opportunity to introduce adjustments to the estimate of capstones.\nIn this sample workload model, estimates of the number of capstones are rounded up (CEIL) to the next highest integer number of capstones.\n\n# Assign CAP workload\n\ncapstones_per_lecture = model_sample['capstones_per_lecture']\nstudents_per_capstone = model_sample['students_per_capstone']\n\nsenior_design_courses = ['CLSC403','EGRB401','EGRB402','CMSC441','CMSC442','CMSC451','CMSC452','EGMN402','EGMN403','ENGR402','ENGR403','EGRE404','EGRE405']\nfor course in senior_design_courses:\n    # Set section type\n    stacked_df.loc[(stacked_df['COURSE']==course)&(stacked_df['TYPE']=='LAB'),'wrkld_sample_type'] = 'CAP'\n    \n    # Estimate number of capstone sections using load of \"students_per_capstone\". Round up or down.\n    # This code was added after the initial code build, so we're storing the capstone_cnt in one of the spares we created above.\n    stacked_df.loc[(stacked_df['COURSE']==course)&(stacked_df['wrkld_sample_type']=='CAP'),'capstone_cnt'] = ( 1.0* stacked_df.loc[(stacked_df['COURSE']==course)&(stacked_df['wrkld_sample_type']=='CAP'),'ACTUAL ENROLLMENT'].astype(float) / students_per_capstone)\n\n    # apply CEIL function\n    stacked_df.loc[(stacked_df['COURSE']==course)&(stacked_df['wrkld_sample_type']=='CAP'),'capstone_cnt'] = stacked_df.loc[(stacked_df['COURSE']==course)&(stacked_df['wrkld_sample_type']=='CAP'),'capstone_cnt'].apply( np.ceil )\n\nNow, apply any necessary fixes.\n\n## apply any fixes to number of capstone sections. Use TERM,CRN as keys\n\nNow, actually compute the workload based on the capstone_cnt.\n\nfor course in senior_design_courses:\n    # Using the capstone count above, calculate the capstone workload\n    stacked_df.loc[(stacked_df['COURSE']==course)&(stacked_df['wrkld_sample_type']=='CAP'),'sum_term_crse_wrkld_sample'] = (\n     stacked_df.loc[(stacked_df['COURSE']==course)&(stacked_df['wrkld_sample_type']=='CAP'),'sum_term_crse_crn'] / capstones_per_lecture * ( stacked_df.loc[(stacked_df['COURSE']==course)&(stacked_df['wrkld_sample_type']=='CAP'),'capstone_cnt'] ) )\n\n    # Update note to show adjustments\n    stacked_df.loc[(stacked_df['COURSE']==course)&(stacked_df['wrkld_sample_type']=='CAP'),'wrkld_sample_note'] = (f\"RULE: [wrkld]={(1.0/capstones_per_lecture):0.2f} for every {students_per_capstone} students in CAP (CAP=\" +\n     stacked_df.loc[(stacked_df['COURSE']==course)&(stacked_df['wrkld_sample_type']=='CAP'),'capstone_cnt'].astype(str) + \")\")\n\n\n\nDistinguish VIP workloads\nVertically Integrated Programs (VIP) provide undergraduate students the opportunity to participate in course-based, multiyear, multidisciplinary, team-based projects under the guidance of faculty and graduate students. These projects are in the faculty areas of expertise, with the main criterion for participation being that of mutual interest.\nManaging a VIP requires effort on the part of the faculty, yet at a lower rate than a standard class.\n\n# Assign VIP workload\n\nvips_per_lecture = model_sample['vips_per_lecture']\n\nstacked_df.loc[stacked_df['course_number'].isin(['497']),'wrkld_sample_type'] = \"VIP\"\nstacked_df.loc[stacked_df['wrkld_sample_type'].isin(['VIP']),'wrkld_sample_note'] = f\"RULE: [wrkld]={(1.0/vips_per_lecture):0.2f} for VIP\"\nstacked_df.loc[(stacked_df['wrkld_sample_type'].isin(['VIP']))&(stacked_df['instructor_cnt']>1.0),'wrkld_sample_note'] = f\"RULE: [wrkld]={(1.0/vips_per_lecture):0.2f} for VIP (co-teaching)\"\nstacked_df.loc[stacked_df['wrkld_sample_type'].isin(['VIP']),'sum_term_crse_wrkld_sample'] = stacked_df.loc[stacked_df['wrkld_sample_type'].isin(['VIP']),'sum_term_crse_wrkld_sample'] / vips_per_lecture\n\n\n\nDistinguish LAB workloads\nLaboratory sections (LAB) are an important part of an engineering and computer science curriculum.\nLAB sections require effort on the part of the faculty member, but at a reduced rate.\nIdentifying lab sections is tricky. The College often codes lab sections differently across departments. Some are coded properly as LAB sections.\nIn other cases, LAB sections are coded as LEC because they share the same CRN as their owner lecture. To capture these cases a special logic is introduced. If a section is taught once per week (e.g., M or W or TH) and the CRN has more than one meeting period, then the section with one meeting period is designated a LAB section.\nIn reviewing the data I found some really odd coding. To accomodate this, I added an override block to turn specific tuples into lab sections.\n\n# Assign LAB workload\nlabs_per_lecture = model_sample['labs_per_lecture']\n\n# Assign LAB sections\nstacked_df.loc[(stacked_df['mtgs_per_crn']>1)&(stacked_df['wrkld_sample_type']=='LEC')&(stacked_df['mtgs_per_wk']==1),'wrkld_sample_type'] = 'LAB'\n\n# Apply overrides for LAB sections\n\nfix_stacked(100,\"2x lab mtg\",\n {'TERM':'202410','CRN':12151,'time_code':'.T.R...14511559','instructor':'Abdelwahed,Sherif'},\n {'wrkld_sample_type':'LAB'}\n)\n\n# Create a note for all LAB sections\nstacked_df.loc[stacked_df['wrkld_sample_type'].isin(['LAB']),'wrkld_sample_note'] = f\"RULE: [wrkld]={(1.0/labs_per_lecture):0.2f} for LAB\"\n\n# Assign workload\nstacked_df.loc[stacked_df['wrkld_sample_type'].isin(['LAB']),'sum_term_crse_wrkld_sample'] = stacked_df.loc[stacked_df['wrkld_sample_type'].isin(['LAB']),'sum_term_crse_wrkld_sample'] / labs_per_lecture\n\n# Create a special note for LAB sections that used the special logic to be identified.\nstacked_df.loc[(stacked_df['mtgs_per_crn']>1)&(stacked_df['wrkld_sample_type']=='LAB')&(stacked_df['mtgs_per_wk']==1),'wrkld_sample_note'] = stacked_df.loc[(stacked_df['mtgs_per_crn']>1)&(stacked_df['wrkld_sample_type']=='LAB')&(stacked_df['mtgs_per_wk']==1),'wrkld_sample_note'] + \" (LAB: 1 mtg per wk rule)\"\n\n\n\nDistinguish RES, IND and FLD\nRES, IND and FLD sections are variable unit placeholders in banner that contribute to the full-time status calculation of a student, but don’t necessarily reflect effort of the faculty mentor.\nResearch active faculty are most associated with RES, IND and FLD. To capture the workload we have two options:\n\nWe can associate these units with a non-zero workload value, or\nWe can reduce the workloads of research active faculty.\n\nTo do both would double-count the effort of RES, IND and FLD sections.\nFor purposes of this workload model, we’ll zero these out and let research active faculty have reduced workloads.\n\n# Exclude teaching credit for research (RES), independent study (IND), and intern/coop (FLD).\n# Credit is given for these activities in reduced teaching (research active) or summer pay.\nstacked_df.loc[stacked_df['wrkld_sample_type'].isin(['RES','IND','FLD']),'wrkld_sample_note'] = \"RULE: [wrkld]=0.00 for INS, RES and FLD\"\nstacked_df.loc[stacked_df['wrkld_sample_type'].isin(['RES','IND','FLD']),'sum_term_crse_wrkld_sample'] = model_sample['res_ind_fld_per_lecture']\n\n\n\nDistinguish SEM workloads\nThe seminar class is an important part of our curriculum and requires effort of those organizing the course.\nIn this workload model, the seminar counts as a full workload course.\n\n# Assign SEM workload\n# Ensure that SEM get full credit because we want to reward the faculty member for doing it!\n\nseminars_per_lecture = model_sample['seminars_per_lecture']\n\nstacked_df.loc[stacked_df['wrkld_sample_type'].isin(['SEM']),'wrkld_sample_note'] = f\"RULE: [wrkld] / {seminars_per_lecture} for SEM\"\nstacked_df.loc[(stacked_df['wrkld_sample_type'].isin(['SEM']))&(stacked_df['instructor_cnt']>1.0),'wrkld_sample_note'] = f\"RULE: [wrkld] / {seminars_per_lecture} for SEM (co-teaching)\"\nstacked_df.loc[stacked_df['wrkld_sample_type'].isin(['SEM']),'sum_term_crse_wrkld_sample'] = stacked_df.loc[stacked_df['wrkld_sample_type'].isin(['SEM']),'sum_term_crse_wrkld_sample'] / seminars_per_lecture\n\n\n\nAdjust for large lectures\nLarger lectures require more effort. The code blocks below adjust the base workload for large classes.\n\n#  Process large classes using thresholds and weights in model_sample parameters.\n\nfor threshhold,weight in model_sample['large_classes']:\n    stacked_df.loc[(stacked_df['ACTUAL ENROLLMENT']>=threshhold)&(stacked_df['wrkld_sample_type']=='LEC'),\"sum_term_crse_wrkld_sample\"] = weight / stacked_df[\"instructor_cnt\"]\n    stacked_df.loc[(stacked_df['ACTUAL ENROLLMENT']>=threshhold)&(stacked_df['wrkld_sample_type']=='LEC'),\"wrkld_sample_note\"] = f\"BASE: [wrkld] = {weight} per CRN ENRL>={threshhold}\"\n    stacked_df.loc[(stacked_df['ACTUAL ENROLLMENT']>=threshhold)&(stacked_df['wrkld_sample_type']=='LEC')&(stacked_df['instructor_cnt']>1.0),'wrkld_sample_note'] = f\"BASE: [wrkld]={weight/2.0} per CRN ENRL>={threshhold} (co-teaching)\"\n\n\n\nStore LEC-only workload in separate column.\n\nstacked_df['sum_term_crse_wrkld_sample_lec'] = 0.0\nstacked_df.loc[(stacked_df['wrkld_sample_type']=='LEC'),'sum_term_crse_wrkld_sample_lec'] = stacked_df.loc[(stacked_df['wrkld_sample_type']=='LEC'),'sum_term_crse_wrkld_sample']\n\n\n\nStore list of LECT-only courses\n\ndef list_courses( x ):\n    l = x.unique().tolist()\n    l = list(filter(lambda item: item != \"\", l))\n    return \",\".join(l)\n\ntemp  = stacked_df.copy()\ntemp[\"lec-only-course\"] = \"\"\ntemp.loc[temp['wrkld_sample_type']=='LEC',\"lec-only-course\"] = temp.loc[temp['wrkld_sample_type']=='LEC',\"COURSE\"]\nstacked_df['lec_only_course_list'] = temp.groupby(['TERM','instructor'])['lec-only-course'].transform( list_courses )\n\nstacked_df[(stacked_df['instructor']=='Leonard,John')&(stacked_df['TERM'].isin(['202410','202320']))][['TERM','COURSE','lec_only_course_list']]\n\n\n\n\n\n  \n    \n      \n      TERM\n      COURSE\n      lec_only_course_list\n    \n  \n  \n    \n      3056\n      202320\n      CMSC442\n      CMSC475\n    \n    \n      3072\n      202320\n      CMSC475\n      CMSC475\n    \n    \n      3554\n      202320\n      ENGR497\n      CMSC475\n    \n    \n      3556\n      202320\n      ENGR497\n      CMSC475\n    \n    \n      3737\n      202410\n      CMSC391\n      CMSC391,CMSC508\n    \n    \n      3748\n      202410\n      CMSC441\n      CMSC391,CMSC508\n    \n    \n      3773\n      202410\n      CMSC508\n      CMSC391,CMSC508\n    \n    \n      4225\n      202410\n      ENGR497\n      CMSC391,CMSC508\n    \n    \n      4227\n      202410\n      ENGR497\n      CMSC391,CMSC508\n    \n  \n\n\n\n\n\n\nSummary\nAt this point the model building is done and the workload assignments are stored in the appropriate columns."
  },
  {
    "objectID": "20_clean.html#examples-checks-and-verifications",
    "href": "20_clean.html#examples-checks-and-verifications",
    "title": "Cleaning the data",
    "section": "Examples, checks and verifications",
    "text": "Examples, checks and verifications\nThe following code blocks are added as unique situations are discovered. The code below shows how these situations are handled and demonstrates how they were corrected.\nAs odd situations are revealed, add a code block here to clearly show the inconsistency. Then, change the workload code above until the situation clears up AND you don’t screw up any of the other situations.\n\nExample: LECT / LAB\nIn this example, a lecture/lab course was coded as 3 separate CRN. Each CRN has a main lecture and a single-meeting-period lab.\nAll three lectures share the same meeting time and are combined into a single workload LECT. Each lab section is assigned 1/3 workload.\nHowever, two of the lab sections share a common meeting time, so they are combined into a single 1/3 workload section.\n\ndef show_block( df,keys,cols):\n    tdf = df\n    for key in keys.keys():\n        tdf = tdf[tdf[key]==keys[key]]\n    return tdf[cols]\n\nshow_block(stacked_df,\n    {'TERM':'202410','COURSE':'EGMN416'},\n    ['COURSE','CRN','TYPE','TITLE','instructor','time_code',\n    'sum_term_crse_crn',\n    'sum_term_crse_crn_mtg_students',\n    'sum_term_crse_crn_hours',\n    'sum_term_crse_wrkld_sample','wrkld_sample_type','wrkld_sample_note']\n)\n\n\n\n\n\n  \n    \n      \n      COURSE\n      CRN\n      TYPE\n      TITLE\n      instructor\n      time_code\n      sum_term_crse_crn\n      sum_term_crse_crn_mtg_students\n      sum_term_crse_crn_hours\n      sum_term_crse_wrkld_sample\n      wrkld_sample_type\n      wrkld_sample_note\n    \n  \n  \n    \n      4117\n      EGMN416\n      45899\n      LEC\n      MECHATRONICS\n      Hadimani,Ravi\n      ....F..14001650\n      0.5\n      31.0\n      46.5\n      0.333333\n      LAB\n      RULE: [wrkld]=0.33 for LAB (LAB: 1 mtg per wk ...\n    \n    \n      4118\n      EGMN416\n      45899\n      LEC\n      MECHATRONICS\n      Hadimani,Ravi\n      M...F..13001350\n      0.5\n      31.0\n      46.5\n      0.333333\n      LEC\n      BASE: [wrkld] / 3 CRN at same time\n    \n    \n      4119\n      EGMN416\n      32709\n      LEC\n      MECHATRONICS\n      Hadimani,Ravi\n      M......14001650\n      0.5\n      30.0\n      45.0\n      0.166667\n      LAB\n      RULE: [wrkld]=0.33 for LAB (LAB: 1 mtg per wk ...\n    \n    \n      4120\n      EGMN416\n      32709\n      LEC\n      MECHATRONICS\n      Hadimani,Ravi\n      M...F..13001350\n      0.5\n      30.0\n      45.0\n      0.333333\n      LEC\n      BASE: [wrkld] / 3 CRN at same time\n    \n    \n      4121\n      EGMN416\n      46922\n      LEC\n      MECHATRONICS\n      Hadimani,Ravi\n      M......14001650\n      0.5\n      29.0\n      43.5\n      0.166667\n      LAB\n      RULE: [wrkld]=0.33 for LAB (LAB: 1 mtg per wk ...\n    \n    \n      4122\n      EGMN416\n      46922\n      LEC\n      MECHATRONICS\n      Hadimani,Ravi\n      M...F..13001350\n      0.5\n      29.0\n      43.5\n      0.333333\n      LEC\n      BASE: [wrkld] / 3 CRN at same time\n    \n  \n\n\n\n\n\nsum_term_crse_crn represents the number of unique CRNs. This value is split across multiple meeting times per CRN.\nsum_term_crse_crn_mtg_students represents the number of students in each crn-meeting time. This value is useful to determine how many students are in any given meeting time.\nsum_term_crse_crn_hours represents the number of credit hours associated with a CRN. This value is split across multiple meeting times.\n\n\n\nExample: LECT sharing a common time\nIn this example, two CRN are sharing a common teaching time and their workloads are split across the two CRN.\n\nshow_block(stacked_df,\n    {'TERM':'202320','instructor':\"Heise,Rebecca\"},\n    ['COURSE','CRN','TYPE','TITLE','instructor','time_code','sum_term_crse_wrkld_sample','wrkld_sample_type','wrkld_sample_note']\n)\n\n\n\n\n\n  \n    \n      \n      COURSE\n      CRN\n      TYPE\n      TITLE\n      instructor\n      time_code\n      sum_term_crse_wrkld_sample\n      wrkld_sample_type\n      wrkld_sample_note\n    \n  \n  \n    \n      3128\n      EGRB111\n      43476\n      LEC\n      INTRO TO BIOL SYS ENGINEERING\n      Heise,Rebecca\n      M.W.F..900950\n      1.0\n      LEC\n      BASE: [wrkld]\n    \n    \n      3150\n      EGRB411\n      40539\n      LEC\n      CELL MECHANICS & MECHANOBIOL\n      Heise,Rebecca\n      M.W.F..10001050\n      0.5\n      LEC\n      BASE: [wrkld] / 2 CRN at same time\n    \n    \n      3154\n      EGRB491\n      45797\n      LEC\n      ST: PULMONARY LAB RESEARCH\n      Heise,Rebecca\n      .........\n      1.0\n      LEC\n      BASE: [wrkld]\n    \n    \n      3156\n      EGRB517\n      40540\n      LEC\n      CELL MECHANICS & MECHANOBIOLOG\n      Heise,Rebecca\n      M.W.F..10001050\n      0.5\n      LEC\n      BASE: [wrkld] / 2 CRN at same time\n    \n    \n      3164\n      EGRB697\n      28942\n      RES\n      DIRECTED RES IN BIOMEDICAL EGR\n      Heise,Rebecca\n      .........\n      0.0\n      RES\n      RULE: [wrkld]=0.00 for INS, RES and FLD\n    \n    \n      3171\n      EGRB697\n      45891\n      RES\n      DIRECTED RES IN BIOMEDICAL EGR\n      Heise,Rebecca\n      .........\n      0.0\n      RES\n      RULE: [wrkld]=0.00 for INS, RES and FLD\n    \n    \n      3194\n      EGRB697\n      28930\n      RES\n      DIRECTED RES IN BIOMEDICAL EGR\n      Heise,Rebecca\n      .........\n      0.0\n      RES\n      RULE: [wrkld]=0.00 for INS, RES and FLD\n    \n    \n      3195\n      EGRB697\n      28934\n      RES\n      DIRECTED RES IN BIOMEDICAL EGR\n      Heise,Rebecca\n      .........\n      0.0\n      RES\n      RULE: [wrkld]=0.00 for INS, RES and FLD\n    \n    \n      3196\n      EGRB697\n      45890\n      RES\n      DIRECTED RES IN BIOMEDICAL EGR\n      Heise,Rebecca\n      .........\n      0.0\n      RES\n      RULE: [wrkld]=0.00 for INS, RES and FLD\n    \n    \n      3590\n      ENGR701\n      43901\n      RES\n      POST-CANDIDACY DOCT RESEARCH\n      Heise,Rebecca\n      .........\n      0.0\n      RES\n      RULE: [wrkld]=0.00 for INS, RES and FLD\n    \n  \n\n\n\n\n\n\nExample: Miscode?\nThis record shows two CRN overlapping in teaching time, but not exactly matching teaching times. Is this for real? Is this a miscode? My initial guess is that this is a miscode and the times should be corrected. This can be accomplished with a FIX record above.\n\nshow_block(stacked_df,\n    {'TERM':'202310','instructor':\"Ferri,James\"},\n    ['COURSE','CRN','TYPE','TITLE','instructor','time_code','MODALITY CODE','sum_term_crse_wrkld_sample','wrkld_sample_type','wrkld_sample_note']\n)\n\n\n\n\n\n  \n    \n      \n      COURSE\n      CRN\n      TYPE\n      TITLE\n      instructor\n      time_code\n      MODALITY CODE\n      sum_term_crse_wrkld_sample\n      wrkld_sample_type\n      wrkld_sample_note\n    \n  \n  \n    \n      2676\n      CLSE301\n      42633\n      LEC\n      TRANSPORT PHENOMENA I\n      Ferri,James\n      .T.R...15301645\n      RINP\n      1.0\n      LEC\n      BASE: [wrkld]\n    \n    \n      2688\n      CLSE585\n      44879\n      LEC\n      INTERFACIAL PHENOMENA\n      Ferri,James\n      ..W....17001930\n      RINP\n      1.0\n      LEC\n      BASE: [wrkld]\n    \n    \n      2700\n      CLSE697\n      37469\n      RES\n      DIRECTED RESEARCH\n      Ferri,James\n      .........\n      RINS\n      0.0\n      RES\n      RULE: [wrkld]=0.00 for INS, RES and FLD\n    \n    \n      2707\n      CLSE697\n      37073\n      RES\n      DIRECTED RESEARCH\n      Ferri,James\n      .........\n      RINS\n      0.0\n      RES\n      RULE: [wrkld]=0.00 for INS, RES and FLD\n    \n    \n      2991\n      ENGR591\n      44935\n      LEC\n      TOP: SYSTEMS ENGINEERING I\n      Ferri,James\n      .........\n      RONA\n      1.0\n      LEC\n      BASE: [wrkld]\n    \n    \n      2999\n      ENGR691\n      44989\n      LEC\n      ST:ADV TOP IN INTERFACIAL PHEN\n      Ferri,James\n      ..W....17001900\n      RINP\n      1.0\n      LEC\n      BASE: [wrkld]\n    \n    \n      3004\n      ENGR701\n      43323\n      RES\n      POST-CANDIDACY DOCT RESEARCH\n      Ferri,James\n      .........\n      RINS\n      0.0\n      RES\n      RULE: [wrkld]=0.00 for INS, RES and FLD\n    \n  \n\n\n\n\n\n\nExample: Singleton ROND\nThis shows a singleton ROND sections. Synchronous on-line sections (ROND) should always be taught with an in-person section. In this case I can only imagine that no students enrolled in the RINP/face-to-face section and it was dropped during earlier data cleaning.\n\nshow_block(stacked_df,\n    {'TERM':'202320','instructor':\"Manic,Milos\"},\n    ['COURSE','CRN','TYPE','TITLE','instructor','time_code','MODALITY CODE','sum_term_crse_wrkld_sample','wrkld_sample_type','wrkld_sample_note']\n)\n\n\n\n\n\n  \n    \n      \n      COURSE\n      CRN\n      TYPE\n      TITLE\n      instructor\n      time_code\n      MODALITY CODE\n      sum_term_crse_wrkld_sample\n      wrkld_sample_type\n      wrkld_sample_note\n    \n  \n  \n    \n      3085\n      CMSC636\n      44831\n      LEC\n      NEURAL NETS AND DEEP LEARNING\n      Manic,Milos\n      M.W....12001315\n      ROND\n      1.000000\n      LEC\n      BASE: [wrkld]\n    \n    \n      3101\n      CMSC697\n      36849\n      RES\n      DIRECTED RESEARCH\n      Manic,Milos\n      .........\n      RINS\n      0.000000\n      RES\n      RULE: [wrkld]=0.00 for INS, RES and FLD\n    \n    \n      3102\n      CMSC697\n      36851\n      RES\n      DIRECTED RESEARCH\n      Manic,Milos\n      .........\n      RINS\n      0.000000\n      RES\n      RULE: [wrkld]=0.00 for INS, RES and FLD\n    \n    \n      3559\n      ENGR497\n      45526\n      LAB\n      VERTICALLY INTEGRATED PROJECTS\n      Manic,Milos\n      .........\n      RINS\n      0.333333\n      VIP\n      RULE: [wrkld]=0.33 for VIP\n    \n    \n      3560\n      ENGR497\n      45527\n      LAB\n      VERTICALLY INTEGRATED PROJECTS\n      Manic,Milos\n      .........\n      RINS\n      0.333333\n      VIP\n      RULE: [wrkld]=0.33 for VIP\n    \n  \n\n\n\n\n\n\nExample: Doubleton ROND+RINP\nThis second example shows a doubleton ROND+RINP section.\n\nshow_block(stacked_df,\n    {'TERM':'202410','instructor':\"Ghosh,Preetam\"},\n    ['COURSE','CRN','TYPE','TITLE','instructor','time_code','MODALITY CODE','sum_term_crse_wrkld_sample','wrkld_sample_type','wrkld_sample_note']\n)\n\n\n\n\n\n  \n    \n      \n      COURSE\n      CRN\n      TYPE\n      TITLE\n      instructor\n      time_code\n      MODALITY CODE\n      sum_term_crse_wrkld_sample\n      wrkld_sample_type\n      wrkld_sample_note\n    \n  \n  \n    \n      3749\n      CMSC441\n      43750\n      LAB\n      SR DESIGN STUDIO I (LAB/PROJ)\n      Ghosh,Preetam\n      .........\n      RONL\n      0.666667\n      CAP\n      RULE: [wrkld]=0.33 for every 4.0 students in C...\n    \n    \n      3771\n      CMSC502\n      37708\n      LEC\n      PARALLEL ALGORITHMS\n      Ghosh,Preetam\n      .T.R...15301645\n      RINP\n      0.500000\n      LEC\n      BASE: [wrkld] / 2 CRN at same time\n    \n    \n      3772\n      CMSC502\n      37709\n      LEC\n      PARALLEL ALGORITHMS\n      Ghosh,Preetam\n      .T.R...15301645\n      ROND\n      0.500000\n      LEC\n      BASE: [wrkld] / 2 CRN at same time\n    \n    \n      3797\n      CMSC697\n      37384\n      RES\n      DIRECTED RESEARCH\n      Ghosh,Preetam\n      .........\n      RINS\n      0.000000\n      RES\n      RULE: [wrkld]=0.00 for INS, RES and FLD\n    \n    \n      3798\n      CMSC697\n      37385\n      RES\n      DIRECTED RESEARCH\n      Ghosh,Preetam\n      .........\n      RINS\n      0.000000\n      RES\n      RULE: [wrkld]=0.00 for INS, RES and FLD\n    \n    \n      3799\n      CMSC697\n      37386\n      RES\n      DIRECTED RESEARCH\n      Ghosh,Preetam\n      .........\n      RINS\n      0.000000\n      RES\n      RULE: [wrkld]=0.00 for INS, RES and FLD\n    \n    \n      4261\n      ENGR701\n      46939\n      RES\n      POST-CANDIDACY DOCT RESEARCH\n      Ghosh,Preetam\n      .........\n      RINS\n      0.000000\n      RES\n      RULE: [wrkld]=0.00 for INS, RES and FLD\n    \n  \n\n\n\n\n\n\nExample: odd counting\nVerifying actual enrollment vs sum_term_crse_wrkld_sample\n\nshow_block(stacked_df,\n    {'TERM':'202410','instructor':\"Duke,Debra\",'COURSE':'CMSC256'},\n    ['COURSE','CRN','TYPE','TITLE','instructor','time_code','MODALITY CODE','ACTUAL ENROLLMENT','MAX CREDITS','time_code','sum_term_crse_crn_mtg_students','sum_term_crse_crn_hours',\n    'sum_term_crse_wrkld_sample','wrkld_sample_type','wrkld_sample_note']\n)\n\n\n\n\n\n  \n    \n      \n      COURSE\n      CRN\n      TYPE\n      TITLE\n      instructor\n      time_code\n      MODALITY CODE\n      ACTUAL ENROLLMENT\n      MAX CREDITS\n      time_code\n      sum_term_crse_crn_mtg_students\n      sum_term_crse_crn_hours\n      sum_term_crse_wrkld_sample\n      wrkld_sample_type\n      wrkld_sample_note\n    \n  \n  \n    \n      3719\n      CMSC256\n      36067\n      LEC\n      DATA STRUCTURE & OBJECT PROG\n      Duke,Debra\n      ..W....13001450\n      RONB\n      83\n      4\n      ..W....13001450\n      83.0\n      166.0\n      0.333333\n      LAB\n      RULE: [wrkld]=0.33 for LAB (LAB: 1 mtg per wk ...\n    \n    \n      3720\n      CMSC256\n      36067\n      LEC\n      DATA STRUCTURE & OBJECT PROG\n      Duke,Debra\n      .T.R...12301345\n      RONB\n      83\n      4\n      .T.R...12301345\n      83.0\n      166.0\n      1.500000\n      LEC\n      BASE: [wrkld] = 1.5 per CRN ENRL>=80\n    \n    \n      3721\n      CMSC256\n      41689\n      LEC\n      DATA STRUCTURE & OBJECT PROG\n      Duke,Debra\n      ..W....16001750\n      ROND\n      31\n      4\n      ..W....16001750\n      31.0\n      62.0\n      0.333333\n      LAB\n      RULE: [wrkld]=0.33 for LAB (LAB: 1 mtg per wk ...\n    \n    \n      3722\n      CMSC256\n      41689\n      LEC\n      DATA STRUCTURE & OBJECT PROG\n      Duke,Debra\n      .T.R...16001715\n      ROND\n      31\n      4\n      .T.R...16001715\n      31.0\n      62.0\n      1.000000\n      LEC\n      BASE: [wrkld]\n    \n  \n\n\n\n\n\n\nExample: odd counting\nVerifying actual enrollment vs sum_term_crse_wrkld_sample\n\nshow_block(stacked_df,\n    {'TERM':'202410','instructor':\"Duke,Debra\",'COURSE':'CMSC256'},\n    ['COURSE','CRN','TYPE','TITLE','instructor','time_code','MODALITY CODE','ACTUAL ENROLLMENT','MAX CREDITS','time_code','sum_term_crse_crn_mtg_students','sum_term_crse_crn_hours',\n    'sum_term_crse_wrkld_sample','wrkld_sample_type','wrkld_sample_note']\n)\n\n\n\n\n\n  \n    \n      \n      COURSE\n      CRN\n      TYPE\n      TITLE\n      instructor\n      time_code\n      MODALITY CODE\n      ACTUAL ENROLLMENT\n      MAX CREDITS\n      time_code\n      sum_term_crse_crn_mtg_students\n      sum_term_crse_crn_hours\n      sum_term_crse_wrkld_sample\n      wrkld_sample_type\n      wrkld_sample_note\n    \n  \n  \n    \n      3719\n      CMSC256\n      36067\n      LEC\n      DATA STRUCTURE & OBJECT PROG\n      Duke,Debra\n      ..W....13001450\n      RONB\n      83\n      4\n      ..W....13001450\n      83.0\n      166.0\n      0.333333\n      LAB\n      RULE: [wrkld]=0.33 for LAB (LAB: 1 mtg per wk ...\n    \n    \n      3720\n      CMSC256\n      36067\n      LEC\n      DATA STRUCTURE & OBJECT PROG\n      Duke,Debra\n      .T.R...12301345\n      RONB\n      83\n      4\n      .T.R...12301345\n      83.0\n      166.0\n      1.500000\n      LEC\n      BASE: [wrkld] = 1.5 per CRN ENRL>=80\n    \n    \n      3721\n      CMSC256\n      41689\n      LEC\n      DATA STRUCTURE & OBJECT PROG\n      Duke,Debra\n      ..W....16001750\n      ROND\n      31\n      4\n      ..W....16001750\n      31.0\n      62.0\n      0.333333\n      LAB\n      RULE: [wrkld]=0.33 for LAB (LAB: 1 mtg per wk ...\n    \n    \n      3722\n      CMSC256\n      41689\n      LEC\n      DATA STRUCTURE & OBJECT PROG\n      Duke,Debra\n      .T.R...16001715\n      ROND\n      31\n      4\n      .T.R...16001715\n      31.0\n      62.0\n      1.000000\n      LEC\n      BASE: [wrkld]"
  },
  {
    "objectID": "20_clean.html#store-the-dataframe",
    "href": "20_clean.html#store-the-dataframe",
    "title": "Cleaning the data",
    "section": "Store the dataframe",
    "text": "Store the dataframe\nWe’re storing both the stacked and unstacked data. Note that the aggregate measures are stored with the stacked data only.\n\nStore to a local CSV file\n\n# Store as CSV files\nsections_df.to_csv('sections_df.csv', index=False)\nstacked_df.to_csv('stacked_df.csv', index=False)\n\n\n\nStore the data in google sheets\n\n# Open the worksheet \nspreadsheet_key = \"1ZK7k8M85CXLof6FdeJYJuGFbfjsOXrCv5mc7OgUInWw\"\nworksheet_name = \"Source data\"\n\ndata_to_write = stacked_df.to_records(index=False)\ntry:\n    sheet = client.open_by_key(spreadsheet_key).worksheet(worksheet_name)\nexcept:\n    sheet = client.open_by_key(spreadsheet_key).add_worksheet( \n        title = worksheet_name,nrows=100,ncols=10\n    )\ntry:\n    sheet.clear()\n    set_with_dataframe(worksheet=sheet, dataframe=stacked_df, include_index=False,include_column_header=True, resize=True)\nexcept:\n    print(f\"Data can't be written\")\n\nData can't be written\n\n\n\n\nFreshen persistent instructor data\nThis block identifies any instructors not found in the persistent instructor data and adds them to the list with default values.\nThis code is not working yet. It should be fixed when a new semester is added and new instructors and courses are discovered in the imported worksheets.\n\n#worksheet_name = \"Instructor data\"\n#summary_df = stacked_df.groupby('instructor')[['COLLEGE','DEPT']].apply(lambda x: x.mode().iloc[0]).#reset_index()\n#summary_df = summary_df.sort_values(by=['COLLEGE','DEPT','instructor'])\n#data_to_write = summary_df.to_records(index=False)\n#try:\n#    sheet = client.open_by_key(spreadsheet_key).worksheet(worksheet_name)\n#except:\n#    nrows,ncols = summary_df.shape\n#    sheet = client.open_by_key(spreadsheet_key).add_worksheet( \n#        title = worksheet_name,rows=nrows+1,cols=ncols+1\n#    )\n#sheet.clear()\n#set_with_dataframe(worksheet=sheet, dataframe=summary_df, include_index=False,include_column_header=True, resize=True)\n\n# Find names in df2 that are not in df1\n##names_to_add = df2[~df2['name'].isin(df1['name'])]\n\n# Add the rows with missing names from df2 to df1\n## df1 = pd.concat([df1, names_to_add], ignore_index=True)"
  },
  {
    "objectID": "20_clean.html#summary-1",
    "href": "20_clean.html#summary-1",
    "title": "Cleaning the data",
    "section": "Summary",
    "text": "Summary\nThat’s all folks! Additional models can be added and the google sheets can be reviewed.\nNow the real analysis can begin:\n\nhere is a link to a google sheet that shows tables created from the dataframe.\nhere is a HTML report that is still evolving.\nhere is the CSV for the cleaned dataframe. This dataframe contains one tuple per (TERM,CRN,INSTRUCTOR,MEETING_CODE)."
  },
  {
    "objectID": "instructor_workload.html",
    "href": "instructor_workload.html",
    "title": "Instructor Workload",
    "section": "",
    "text": "Sort by:   Total Hours Lecture Hours Total Workload Lecture Workload Alphabet \n\n\n▲\n\n\n▼\n\n\n\n// Importing D3.js\nd3 = require('d3@6')\n\n\n\n\n\n\n\n// Attach the CSV file\nfileAttachment = FileAttachment(\"selected_data.csv\")\n\n\n\n\n\n\n\n// Load the CSV data\ndata = await fileAttachment.csv()\n\n\n\n\n\n\n\n// Filter and transform data\ntransformedData = data.map(d =&gt; ({\n  instructor: d.instructor,\n  total_hours: +d.sum_term + +d.sum_term_crse + +d.sum_term_crse_crn + +d.sum_term_crse_crn_mtg_students + +d.sum_term_crse_crn_hours,\n  lec_hours: d.wrkld_sample_type === 'LEC' ? +d.sum_term_crse_crn_hours : 0,\n  total_workload: +d.sum_term_crse_wrkld_sample,\n  lec_workload: d.wrkld_sample_type === 'LEC' ? +d.sum_term_crse_wrkld_sample_lec : 0,\n  dept: d.ins_dept,\n  role: d.ins_role,\n  course: d.COURSE\n}));\n\n\n\n\n\n\n\n// aggregate data\naggregatedData = d3.rollups(transformedData, v =&gt; ({\n  total_hours: d3.sum(v, d =&gt; d.total_hours),\n  lec_hours: d3.sum(v, d =&gt; d.lec_hours),\n  total_workload: d3.sum(v, d =&gt; d.total_workload),\n  courses: Array.from(new Set(v.map(d =&gt; d.course))),\n  lec_workload: d3.sum(v, d =&gt; d.lec_workload),\n  ins_dept: v[0].dept,\n  ins_role: v[0].role\n}), d =&gt; d.instructor).map(([instructor, values]) =&gt; ({ instructor, ...values}));\n\n\n\n\n\n\n\nmargin = ({top: 20, right: 20, bottom: 20, left: 40 })\n\n\n\n\n\n\n\nheight = 1700 - margin.top - margin.bottom\n\n\n\n\n\n\n\nwidth = 850 + margin.left - margin.right\n\n\n\n\n\n\n\n{\n  const minHeight = 700;\n  const minWidth = 600;\n\n  const svgWidth = width + margin.left + margin.right;\n  const svgHeight = height + margin.top + margin.bottom;\n\n  let dynamicHeight = Math.max((aggregatedData.length || 0) * 10 + margin.top + margin.bottom, minHeight);\n  let dynamicWidth = Math.max(width, minWidth);\n\n  margin.bottom = Math.max(margin.bottom, 50); // space for x-axis tick marks\n  margin.right = Math.max(margin.right, 150);\n\n  const middleGap = 220;\n  const chartWidth = width/2  - middleGap/2;\n\n  // set up mirrored chart \n  const xScaleLeft = d3.scaleLinear()\n    .domain([0, d3.max(aggregatedData, d =&gt; Math.max(d.total_hours, d.lec_hours))])\n    .range([chartWidth, 0]); // ranging from middle to left \n  \n  const xScaleRight = d3.scaleLinear()\n    .domain([0, d3.max(aggregatedData, d =&gt; Math.max(d.total_workload, d.lec_workload))])\n    .range([width/2 + middleGap/2, width]); // ranging from middle to right\n\n  const yScale = d3.scaleBand()\n    .domain(aggregatedData.map(d =&gt; d.instructor))\n    .range([0, height])\n    .paddingInner(0.1);\n\n  // create svg container\n  const svg = d3.create(\"svg\")\n    .attr('width', svgWidth)\n    .attr('height', svgHeight)\n    .attr(\"viewBox\", `0 0 ${width + margin.left + margin.right} ${dynamicHeight}`)\n    //.style(\"border\", \"1px solid black\");\n\n  const g = svg.append(\"g\").attr(\"transform\", `translate(${margin.left}, ${margin.top})`)\n\n  const chartGroup = svg.append(\"g\").attr(\"transform\", `translate(${margin.left},${margin.top})`);\n\n\n   // Define legend data\n  const legendMarginTop = -30;\n  const legendXStart = margin.left;\n  const legendSpacing = 200;\n  const legendYPosition = legendMarginTop;\n  \n  const legendData = [\n    { color: \"skyblue\", label: \"Total Hours\" },\n    { color: \"blue\", label: \"Lecture Hours\" },\n    { color: \"lightgreen\", label: \"Total Workload\" },\n    { color: \"green\", label: \"Lecture Workload\" }\n  ];\n\n  // Position the legend at the top within the newly adjusted margin space\n  const legend = chartGroup.selectAll(\".legend\")\n    .data(legendData)\n    .enter().append(\"g\")\n      .attr(\"class\", \"legend\")\n      .attr(\"transform\", (d, i) =&gt; `translate(${legendXStart + i * legendSpacing}, ${-margin.top + legendMarginTop})`);\n  \n  legend.append(\"rect\")\n      .attr(\"x\", 30)\n      .attr(\"y\", 0)\n      .attr(\"width\", 18)\n      .attr(\"height\", 18)\n      .style(\"fill\", d =&gt; d.color);\n  \n  legend.append(\"text\")\n      .attr(\"x\", 24)\n      .attr(\"y\", 9)\n      .attr(\"dy\", \".35em\")\n      .style(\"text-anchor\", \"end\")\n      .text(d =&gt; d.label);\n\n  // check boxes\n  const departments = [\n    'CMSC', 'EGRB', 'EGRC', 'EGRE', 'EGRM', 'ENGR', 'INNO', 'EBRC', 'COAR'\n  ];\n\n  const roles = [\n    'TTT', 'Adjunct', 'Term'\n  ]\n  \n  const checkboxSize = 15; // Size of the checkbox\n  const spacing = 20; // Spacing between checkboxes\n  \n  // Initial filter state\n  let selectedDepartments = new Set();\n  let selectedRoles = new Set();\n\n  const rightMargin = 0;\n  const checkBoxStartX = width - rightMargin;\n\n  // Add headings for Departments and Roles\n  svg.append('text')\n      .attr('x', checkBoxStartX)\n      .attr('y', 20)\n      .text('Departments:')\n      .style('font-weight', 'bold');\n  \n  svg.append('text')\n      .attr('x', checkBoxStartX)\n      .attr('y', 40 + (departments.length + 1) * spacing)\n      .text('Roles:')\n      .style('font-weight', 'bold');\n  \n  // Draw checkboxes for departments\n  departments.forEach((dept, index) =&gt; {\n      const group = svg.append('g')\n          .attr('transform', `translate(${checkBoxStartX}, ${40 + index * spacing})`)\n          .attr('class', 'dept-filter')\n          .style('cursor', 'pointer')\n          .on('click', function() {\n              if (selectedDepartments.has(dept)) {\n                  selectedDepartments.delete(dept);\n                  d3.select(this).select('rect').attr('fill', 'none');\n              } else {\n                  selectedDepartments.add(dept);\n                  d3.select(this).select('rect').attr('fill', 'black');\n              }\n              //applyFilters();\n              applyCurrentState();\n          });\n  \n      group.append('rect')\n          .attr('width', checkboxSize)\n          .attr('height', checkboxSize)\n          .attr('fill', selectedDepartments.has(dept) ? 'black' : 'none')\n          .attr('stroke', 'black');\n  \n      group.append('text')\n          .attr('x', checkboxSize + 5)\n          .attr('y', checkboxSize / 2)\n          .attr('alignment-baseline', 'middle')\n          .text(dept);\n  });\n  \n  // Draw checkboxes for roles\n  roles.forEach((role, index) =&gt; {\n      const group = svg.append('g')\n          .attr('transform', `translate(${checkBoxStartX}, ${40 + (departments.length + 1) * spacing + (index + 1) * spacing})`)\n          .attr('class', 'role-filter')\n          .style('cursor', 'pointer')\n          .on('click', function() {\n              if (selectedRoles.has(role)) {\n                  selectedRoles.delete(role);\n                  d3.select(this).select('rect').attr('fill', 'none');\n              } else {\n                  selectedRoles.add(role);\n                  d3.select(this).select('rect').attr('fill', 'black');\n              }\n              //applyFilters();\n              applyCurrentState();\n          });\n  \n      group.append('rect')\n          .attr('width', checkboxSize)\n          .attr('height', checkboxSize)\n          .attr('fill', selectedRoles.has(role) ? 'black' : 'none')\n          .attr('stroke', 'black');\n  \n      group.append('text')\n          .attr('x', checkboxSize + 5)\n          .attr('y', checkboxSize / 2)\n          .attr('alignment-baseline', 'middle')\n          .text(role);\n  });\n\n  // tick line\n  const axisOffset = 50; // amount to move the axis down \n  const axisOffset2 = 70; //extend length of tick line \n  \n  const xAxisLeft = d3.axisBottom(xScaleLeft)\n    .ticks(5)\n    .tickSizeInner(-(height - margin.top - margin.bottom + axisOffset2))\n    .tickSizeOuter(0);\n\n  const xAxisRight = d3.axisBottom(xScaleRight)\n    .ticks(5)\n    .tickSizeInner(-(height - margin.top - margin.bottom + axisOffset2))\n    .tickSizeOuter(0);\n\n  svg.append(\"g\")\n    .attr(\"class\", \"x-axis-left\")\n    .attr(\"transform\", `translate(0, ${height - margin.bottom + axisOffset})`)\n    .call(xAxisLeft)\n    .selectAll(\".tick line\") \n    .attr(\"stroke\", \"#ccc\");\n  \n  svg.append(\"g\")\n    .attr(\"class\", \"x-axis-right\")\n    .attr(\"transform\", `translate(0, ${height - margin.bottom + axisOffset})`)\n    .call(xAxisRight)\n    .selectAll(\".tick line\") \n    .attr(\"stroke\", \"#ccc\");\n\n  // Create a tooltip div that is hidden by default\n  var tooltip = d3.select(\"body\").append(\"div\")\n    .attr(\"class\", \"tooltip\")\n    .style(\"opacity\", 0)\n    .style(\"position\", \"absolute\")\n    .style(\"text-align\", \"center\")\n    .style(\"width\", \"150px\")\n    .style(\"height\", \"auto\")\n    .style(\"padding\", \"2px\")\n    .style(\"font\", \"12px sans-serif\")\n    .style(\"color\", \"white\")\n    .style(\"background\", \"black\")\n    .style(\"border\", \"0px\")\n    .style(\"border-radius\", \"8px\")\n    .style(\"pointer-events\", \"none\");\n\n  // labels\n  const instructorXPosition = width/2 + 15;\n  svg.selectAll(\".label-instructor\") // append instructor - middleGap\n   .data(aggregatedData)\n   .enter().append(\"text\")\n     .attr(\"class\", \"label-instructor\")\n     .attr(\"x\", instructorXPosition)\n     .attr(\"y\", d =&gt; yScale(d.instructor) + yScale.bandwidth() / 2)\n     .attr(\"dy\", \".35em\")\n     .attr(\"text-anchor\", \"end\")\n     .text(d =&gt; d.instructor)\n     .style(\"font-size\", \"10px\");\n\n  const departmentXPosition = width/2 + 25;\n  svg.selectAll(\".label-department\") // append departments - middleGap\n     .data(aggregatedData)\n     .enter().append(\"text\")\n     .attr(\"class\", \"label-department\")\n     .attr(\"x\", departmentXPosition)\n     .attr(\"y\", d =&gt; yScale(d.instructor) + yScale.bandwidth() / 2)\n     .attr(\"dy\", \".35em\")\n     .attr(\"text-anchor\", \"start\")\n     .text(d =&gt; d.ins_dept)\n     .style(\"font-size\", \"10px\");\n\n  const roleXPosition = width/2 + 80;\n  // Append roles\n  svg.selectAll(\".label-role\")\n     .data(aggregatedData)\n     .enter().append(\"text\")\n     .attr(\"class\", \"label-role\")\n     .attr(\"x\", roleXPosition)\n     .attr(\"y\", d =&gt; yScale(d.instructor) + yScale.bandwidth() / 2)\n     .attr(\"dy\", \".35em\")\n     .attr(\"text-anchor\", \"middle\")\n     .text(d =&gt; `(${d.ins_role})`)\n     .style(\"font-size\", \"10px\");\n\n  // draw bars - middleGap\n  svg.selectAll(\".bar-total-hours\")\n    .data(aggregatedData)\n    .enter().append(\"rect\")\n      .attr(\"class\", \"bar-total-hours\")\n      .attr(\"x\", d =&gt; xScaleLeft(d.total_hours))\n      .attr(\"y\", d =&gt; yScale(d.instructor))\n      .attr(\"width\", d =&gt; chartWidth - xScaleLeft(d.total_hours))\n      .attr(\"height\", yScale.bandwidth())\n      .attr(\"fill\", \"skyblue\");\n\n  svg.selectAll(\".bar-lec-hours\")\n    .data(aggregatedData)\n    .enter().append(\"rect\")\n      .attr(\"class\", \"bar-lec-hours\")\n      .attr(\"x\", d =&gt; xScaleLeft(d.lec_hours))\n      .attr(\"y\", d =&gt; yScale(d.instructor))\n      .attr(\"width\", d =&gt; chartWidth - xScaleLeft(d.lec_hours))\n      .attr(\"height\", yScale.bandwidth())\n      .attr(\"fill\", \"blue\");\n\n  svg.selectAll(\".bar-total-workload\")\n    .data(aggregatedData)\n    .enter().append(\"rect\")\n      .attr(\"class\", \"bar-total-workload\")\n      .attr(\"x\", width/2 + middleGap/2)\n      .attr(\"y\", d =&gt; yScale(d.instructor))\n      .attr(\"width\", d =&gt; xScaleRight(d.total_workload) - (width/2 + middleGap/2))\n      .attr(\"height\", yScale.bandwidth())\n      .attr(\"fill\", \"lightgreen\");\n\n  svg.selectAll(\".bar-lec-workload\")\n    .data(aggregatedData)\n    .enter().append(\"rect\")\n      .attr(\"class\", \"bar-lec-workload\")\n      .attr(\"x\", width/2 + middleGap/2)\n      .attr(\"y\", d =&gt; yScale(d.instructor))\n      .attr(\"width\", d =&gt; xScaleRight(d.lec_workload) - (width/2 + middleGap/2))\n      .attr(\"height\", yScale.bandwidth())\n      .attr(\"fill\", \"green\");\n\n  let currentState = {\n    sortCriterion: null,\n    sortOrderAscending: true,\n    selectedDepartments: new Set(),\n    selectedRoles: new Set()\n  }\n\n   // Sort helper functions\n  function sortAscending(criterion) {\n    return (a, b) =&gt; {\n      if (typeof a[criterion] === 'string') {\n        return a[criterion].localeCompare(b[criterion]);\n      }\n      return a[criterion] - b[criterion];\n    };\n  }\n\n  function sortDescending(criterion) {\n    return (a, b) =&gt; {\n      if (typeof a [criterion] === 'string') {\n        return b[criterion].localeCompare(a[criterion]);\n      }\n      return b[criterion] - a[criterion];\n    };\n  }\n\n  function sortData(criterion, ascending) {\n    currentState.sortCriterion = criterion;\n    currentState.sortOrderAscending = ascending;\n    applyCurrentState();\n  }\n  \n    // Function to update filtering state and apply changes\n  function filterData() {\n    currentState.selectedDepartments = new Set(\n      d3.selectAll(\".dept-filter:checked\").nodes().map(d =&gt; d.value)\n    );\n\n    currentState.selectedRoles = new Set(\n      d3.selectAll(\".role-filter:checked\").nodes().map(d =&gt; d.value)\n    ); \n    \n    applyCurrentState();\n  }\n\n  // Function to update bars\n  function updateBars(selector, data, xScale, fillColor, transition, isRightSide) {\n      let bars = svg.selectAll(selector)\n          .data(data, d =&gt; d.instructor);\n  \n      // Enter and Update selections\n      bars.enter().append(\"rect\")\n          .attr(\"class\", selector.replace('.', ''))\n          .attr(\"fill\", fillColor)\n          .merge(bars) // Merging enter and update selections\n          .transition(transition)\n          .attr(\"x\", d =&gt; isRightSide ? width / 2 : xScale(d.total_hours))\n          .attr(\"y\", d =&gt; yScale(d.instructor))\n          .attr(\"width\", d =&gt; isRightSide ? xScale(d.total_workload) - (width / 2) : (width / 2 - middleGap) - xScale(d.total_hours))\n          .attr(\"height\", yScale.bandwidth());\n  \n      // Exit selection\n      bars.exit().remove();\n  }\n  \n  // Function to update labels\n  function updateLabels(selector, data, xPos, textAccessor, transition) {\n      let labels = svg.selectAll(selector)\n                      .data(data, d =&gt; d.instructor);\n  \n      labels.enter().append(\"text\")\n          .attr(\"class\", selector.substring(1)) \n          .merge(labels)\n          .transition(transition)\n          .attr(\"x\", xPos)\n          .attr(\"y\", d =&gt; yScale(d.instructor) + yScale.bandwidth() / 2)\n          .attr(\"dy\", \".35em\")\n          .text(textAccessor);\n     labels.exit().remove();\n  }\n  \n   function updateChart(displayData) {\n      // Update yScale's range and domain\n      yScale.domain(displayData.map(d =&gt; d.instructor))\n            .padding(0.1);\n  \n      // Transition for bars and labels\n      const t = svg.transition().duration(500);\n  \n      // Update chart elements in updateChart function\n      updateBars(\".bar-total-hours\", displayData, xScaleLeft, \"skyblue\", t, false);  // Left side bar\n      updateBars(\".bar-lec-hours\", displayData, xScaleLeft, \"blue\", t, false);      // Left side bar\n      updateBars(\".bar-total-workload\", displayData, xScaleRight, \"lightgreen\", t, true); // Right side bar\n      updateBars(\".bar-lec-workload\", displayData, xScaleRight, \"green\", t, true);   // Right side bar\n       \n      // Update labels\n      updateLabels(\".label-instructor\", displayData, instructorXPosition, d =&gt; d.instructor, t);\n      updateLabels(\".label-department\", displayData, departmentXPosition, d =&gt; d.ins_dept, t);\n      updateLabels(\".label-role\", displayData, roleXPosition, d =&gt; `(${d.ins_role})`, t);\n  \n  \n      // Select and bind data for total hours bars\n      let barsTotalHours = svg.selectAll(\".bar-total-hours\")\n                              .data(displayData, d =&gt; d.instructor);\n      \n      // Enter + Update Selection for total hours bars\n      barsTotalHours.enter().append(\"rect\")\n          .attr(\"class\", \"bar-total-hours\")\n          // Initial attributes for new elements\n          .attr(\"fill\", \"skyblue\")\n          .merge(barsTotalHours) // Merging enter and update selections\n          // Add mouse event\n          .on(\"mouseover\", function(event, d) {\n              let format = d3.format(\".2f\");\n              tooltip.transition()\n                  .duration(200)\n                  .style(\"opacity\", .9);\n              tooltip.html(`\n                  &lt;div class=\"tooltip-content\"&gt;\n                      &lt;strong&gt;${d.instructor}&lt;/strong&gt;&lt;br&gt;\n                      &lt;span class=\"tooltip-text\"&gt;Total Hours: ${format(d.total_hours)}&lt;/span&gt;&lt;br&gt;\n                      &lt;ul&gt;${d.courses.map(course =&gt; `&lt;li&gt;${course}&lt;/li&gt;`).join('')}&lt;/ul&gt;\n                  &lt;/div&gt;\n              `)\n                  .style(\"left\", (event.pageX + 5) + \"px\")\n                  .style(\"top\", (event.pageY - 28) + \"px\");\n          })\n          .on(\"mouseout\", function() {\n              tooltip.transition()\n                  .duration(500)\n                  .style(\"opacity\", 0);\n          })\n          .transition(t)\n          .attr(\"x\", d =&gt; xScaleLeft(d.total_hours))\n          .attr(\"y\", d =&gt; yScale(d.instructor))\n          .attr(\"width\", d =&gt; chartWidth - xScaleLeft(d.total_hours))\n          .attr(\"height\", yScale.bandwidth());\n   \n      barsTotalHours.exit().remove();\n  \n      \n      // Select and bind data for lecture hours bars\n      let barsLectureHours = svg.selectAll(\".bar-lec-hours\")\n                                .data(displayData, d =&gt; d.instructor);\n        \n        // Enter + Update Selection for lecture hours bars\n        barsLectureHours.enter().append(\"rect\")\n            .attr(\"class\", \"bar-lec-hours\")\n            .attr(\"fill\", \"blue\")\n            .merge(barsLectureHours)\n            // add mouse event\n            .on(\"mouseover\", function(event, d) {\n                let format = d3.format(\".2f\");\n                tooltip.transition()\n                    .duration(200)\n                    .style(\"opacity\", .9);\n                tooltip.html(`\n                  &lt;div class=\"tooltip-content\"&gt;\n                      &lt;strong&gt;${d.instructor}&lt;/strong&gt;&lt;br&gt;\n                      &lt;span class=\"tooltip-text\"&gt;Lecture Hours: ${format(d.lec_hours)}&lt;/span&gt;&lt;br&gt;\n                      &lt;ul&gt;${d.courses.map(course =&gt; `&lt;li&gt;${course}&lt;/li&gt;`).join('')}&lt;/ul&gt;\n                  &lt;/div&gt;\n                `)\n                    .style(\"left\", (event.pageX + 5) + \"px\")\n                    .style(\"top\", (event.pageY - 28) + \"px\");\n            })\n            .on(\"mouseout\", function() {\n                tooltip.transition()\n                    .duration(500)\n                    .style(\"opacity\", 0);\n            })\n            .transition(t)\n            .attr(\"x\", d =&gt; xScaleLeft(d.lec_hours))\n            .attr(\"y\", d =&gt; yScale(d.instructor))\n            .attr(\"width\", d =&gt; chartWidth - xScaleLeft(d.lec_hours))\n            .attr(\"height\", yScale.bandwidth());\n            \n        barsLectureHours.exit().remove();\n  \n      \n      let barsTotalWorkload = svg.selectAll(\".bar-total-workload\")\n                       .data(displayData, d =&gt; d.instructor);\n\n        barsTotalWorkload.enter().append(\"rect\")\n            .merge(barsTotalWorkload)\n            .attr(\"class\", \"bar-total-workload\")\n            .attr(\"x\", width/2 + middleGap/2)\n            .attr(\"y\", d =&gt; yScale(d.instructor))\n            .attr(\"width\", d =&gt; xScaleRight(d.total_workload) - (width/2 + middleGap/2))\n            .attr(\"height\", yScale.bandwidth())\n            .attr(\"fill\", \"lightgreen\")\n              // Add mouse event\n            .on(\"mouseover\", function(event, d) {\n                let format = d3.format(\".2f\");\n                tooltip.transition()\n                    .duration(200)\n                    .style(\"opacity\", 0.9);\n                tooltip.html(`\n                  &lt;div class=\"tooltip-content\"&gt;\n                      &lt;strong&gt;${d.instructor}&lt;/strong&gt;&lt;br&gt;\n                      &lt;span class=\"tooltip-text\"&gt;Total Workload: ${format(d.total_workload)}&lt;/span&gt;&lt;br&gt;\n                      &lt;ul&gt;${d.courses.map(course =&gt; `&lt;li&gt;${course}&lt;/li&gt;`).join('')}&lt;/ul&gt;\n                  &lt;/div&gt;\n                `)\n                    .style(\"left\", (event.pageX + 10) + \"px\")\n                    .style(\"top\", (event.pageY - 15) + \"px\");\n            })\n            .on(\"mouseout\", function() {\n                tooltip.transition()\n                    .duration(500)\n                    .style(\"opacity\", 0);\n            });\n              \n        barsTotalWorkload.transition(t)\n            .attr(\"x\", width/2 + middleGap/2)\n            .attr(\"y\", d =&gt; yScale(d.instructor))\n            .attr(\"y\", d =&gt; yScale(d.instructor))\n            .attr(\"width\",  d =&gt; xScaleRight(d.total_workload) - (width/2 + middleGap/2));\n        \n        barsTotalWorkload.exit().remove();\n\n     let barsLectureWorkload = svg.selectAll(\".bar-lec-workload\")\n                               .data(displayData, d =&gt; d.instructor);\n        \n        barsLectureWorkload.enter().append(\"rect\")\n            .attr(\"class\", \"bar-lec-workload\")\n            .merge(barsLectureWorkload)\n            .attr(\"x\", width/2 + middleGap/2)\n            .attr(\"y\", d =&gt; yScale(d.instructor))\n            .attr(\"width\", d =&gt; xScaleRight(d.lec_workload) - (width/2 + middleGap/2))\n            .attr(\"height\", yScale.bandwidth())\n            .attr(\"fill\", \"green\")\n              // Add mouse event\n            .on(\"mouseover\", function(event, d) {\n                let format = d3.format(\".2f\");\n                tooltip.transition()\n                    .duration(200)\n                    .style(\"opacity\", 0.9);\n                tooltip.html(`\n                  &lt;div class=\"tooltip-content\"&gt;\n                      &lt;strong&gt;${d.instructor}&lt;/strong&gt;&lt;br&gt;\n                      &lt;span class=\"tooltip-text\"&gt; Lecture Workload: ${format(d.lec_workload)}&lt;/span&gt;&lt;br&gt;\n                      &lt;ul&gt;${d.courses.map(course =&gt; `&lt;li&gt;${course}&lt;/li&gt;`).join('')}&lt;/ul&gt;\n                  &lt;/div&gt;\n                `)\n                    .style(\"left\", (event.pageX + 10) + \"px\")\n                    .style(\"top\", (event.pageY - 15) + \"px\");\n            })\n            .on(\"mouseout\", function() {\n                tooltip.transition()\n                    .duration(500)\n                    .style(\"opacity\", 0);\n            });\n        \n          barsLectureWorkload.transition(t)\n              .attr(\"x\", width/2 + middleGap/2)\n              .attr(\"y\", d =&gt; yScale(d.instructor))\n              .attr(\"y\", d =&gt; yScale(d.instructor))\n              .attr(\"width\", d =&gt; xScaleRight(d.lec_workload) - (width/2 + middleGap/2));\n          \n          barsLectureWorkload.exit().remove();\n    \n      // Update instructor labels\n     let instructorLabels = svg.selectAll(\".label-instructor\")\n                            .data(displayData, d =&gt; d.instructor);\n  \n        instructorLabels.enter().append(\"text\")\n            .attr(\"class\", \"label-instructor\")\n            .merge(instructorLabels) // merge enter and update selections\n            .transition(t)\n            .attr(\"x\", instructorXPosition)\n            .attr(\"y\", d =&gt; yScale(d.instructor) + yScale.bandwidth() / 2)\n            .attr(\"dy\", \".35em\")\n            .attr(\"text-anchor\", \"end\")\n            .text(d =&gt; d.instructor)\n            .style(\"font-size\", \"10px\");\n        \n        instructorLabels.exit().remove();\n      \n      // Update department labels\n      let departmentLabels = svg.selectAll(\".label-department\")\n                                .data(displayData, d =&gt; d.instructor);\n      \n        departmentLabels.enter().append(\"text\")\n            .attr(\"class\", \"label-department\")\n            .merge(departmentLabels) \n            .transition(t)\n            .attr(\"x\", departmentXPosition)\n            .attr(\"y\", d =&gt; yScale(d.instructor) + yScale.bandwidth() / 2)\n            .attr(\"dy\", \".35em\")\n            .attr(\"text-anchor\", \"start\")\n            .text(d =&gt; d.ins_dept)\n            .style(\"font-size\", \"10px\");\n        \n        departmentLabels.exit().remove();\n      \n          \n      // Update role labels\n      let roleLabels = svg.selectAll(\".label-role\")\n                      .data(displayData, d =&gt; d.instructor);\n  \n        roleLabels.enter().append(\"text\")\n            .attr(\"class\", \"label-role\")\n            .merge(roleLabels) \n            .transition(t)\n            .attr(\"x\", roleXPosition)\n            .attr(\"y\", d =&gt; yScale(d.instructor) + yScale.bandwidth() / 2)\n            .attr(\"dy\", \".35em\")\n            .attr(\"text-anchor\", \"middle\")\n            .text(d =&gt; `(${d.ins_role})`)\n            .style(\"font-size\", \"10px\");\n        \n        roleLabels.exit().remove();\n  \n   }\n  \n    // Attach event listeners to filter checkboxes\n    d3.selectAll(\".dept-filter, .role-filter\").on(\"change\", filterData);\n\n    // Function to apply sorting and filtering\n  function applyCurrentState() {\n    // Apply filter first\n    let filteredData = aggregatedData.filter(d =&gt; \n      (selectedDepartments.size === 0 || selectedDepartments.has(d.ins_dept)) &&\n      (selectedRoles.size === 0 || selectedRoles.has(d.ins_role))\n    );\n  \n    // Then apply sorting\n    if (currentState.sortCriterion) {\n      const sortFunction = currentState.sortOrderAscending\n        ? sortAscending(currentState.sortCriterion)\n        : sortDescending(currentState.sortCriterion);\n      filteredData.sort(sortFunction);\n    }\n  \n    // Update the charts with the filtered and sorted data\n    updateChart(filteredData);\n  }\n  \n  applyCurrentState();\n\n  // Function to attach event listeners to sorting controls\n  function attachSortingEventListeners() {\n    // Listen for changes on the dropdown menu\n    d3.select(\"#sorting-criteria\").on(\"change\", function() {\n      const selectedCriterion = d3.select(this).node().value;\n      // ascending sort as default action\n      sortData(selectedCriterion, true);\n    });\n  \n    // Attach event listeners for sorting\n    d3.select(\"#sort-asc\").on(\"click\", function() {\n      const selectedCriterion = d3.select(\"#sorting-criteria\").property(\"value\");\n      sortData(selectedCriterion, true); \n    });\n    \n    d3.select(\"#sort-desc\").on(\"click\", function() {\n      const selectedCriterion = d3.select(\"#sorting-criteria\").property(\"value\");\n      sortData(selectedCriterion, false); \n    });\n  }\n\n  attachSortingEventListeners();      \n\n  return svg.node();\n}"
  },
  {
    "objectID": "test-dashboard.html",
    "href": "test-dashboard.html",
    "title": "Sort Button Test",
    "section": "",
    "text": "Sort by:   Total Hours Lecture Hours Total Workload Lecture Workload Alphabet \n\n\n▲\n\n\n▼"
  },
  {
    "objectID": "visual1.html",
    "href": "visual1.html",
    "title": "Analysis of Teaching",
    "section": "",
    "text": "margin = ({top: 20, right: 20, bottom: 40, left: 40})\n\n[margin.left, width - margin.right] // the x-range\n\nheight = (aggregatedData.length || 0) * 10;\n\n{\n\n  // Use scales for bar chart\n  const middleGap = 220;\n  \n  const xScaleLeft = d3.scaleLinear()\n  .domain([0, d3.max(aggregatedData, d => Math.max(d.total_hours, d.lec_hours))])\n  .range([width / 2 - middleGap, 0]); // ranging from middle to left \n\n  const xScaleRight = d3.scaleLinear()\n    .domain([0, d3.max(aggregatedData, d => Math.max(d.total_workload, d.lec_workload))])\n    .range([width / 2 + middleGap, width]); // ranging from middle to right\n  \n  const yScale = d3.scaleBand()\n    .domain(aggregatedData.map(d => d.instructor))\n    .range([0, height])\n    .padding(0.1);\n\n  // Create svg container\n  const svg = d3.create(\"svg\").attr(\"viewBox\", [0, 0, width, height]);\n\n  // Create a tooltip div that is hidden by default:\n  var tooltip = d3.select(\"body\").append(\"div\")\n    .attr(\"class\", \"tooltip\")\n    .style(\"opacity\", 0)\n    .style(\"position\", \"absolute\")\n    .style(\"text-align\", \"center\")\n    .style(\"width\", \"150px\")\n    .style(\"height\", \"auto\")\n    .style(\"padding\", \"2px\")\n    .style(\"font\", \"12px sans-serif\")\n    .style(\"background\", \"lightsteelblue\")\n    .style(\"border\", \"0px\")\n    .style(\"border-radius\", \"8px\")\n    .style(\"pointer-events\", \"none\");\n\n  // Add a group element that will contain actual chart (bars, axes, labels)\n  const g = svg.append(\"g\").attr(\"transform\", `translate(${margin.left},${margin.top})`);\n  \n  // Add labels\n  const labelOffset = 95;\n  \n  // Define the positions for each column\n  const instructorXPosition = width / 2 - labelOffset; \n  const departmentXPosition = width / 2 - labelOffset + 10; \n  const roleXPosition = width / 2 - labelOffset + 65; \n\n  // Define the bottom axis for the left side\n  const xAxisLeft = d3.axisBottom(xScaleLeft)\n     .ticks(8)\n     .tickSizeInner(-height)\n     //.tickSizeOuter(0);\n\n    // Append left axis\n  svg.append(\"g\")\n     .attr(\"class\", \"x axis left\")\n     .attr(\"transform\", `translate(0,${height - margin.bottom})`)\n     .call(xAxisLeft);\n\n  // Define the bottom axis for the right side\n  const xAxisRight = d3.axisBottom(xScaleRight)\n    .ticks(5) \n    .tickSizeInner(-height);\n\n  // Append right axis\n  svg.append(\"g\")\n     .attr(\"class\", \"x axis right\")\n     .attr(\"transform\", `translate(-220, ${height - margin.bottom})`)\n     .call(xAxisRight);\n    \n  // Append instructor names\n  svg.selectAll(\".label-instructor\")\n     .data(aggregatedData)\n     .enter().append(\"text\")\n     .attr(\"class\", \"label-instructor\")\n     .attr(\"x\", instructorXPosition)\n     .attr(\"y\", d => yScale(d.instructor) + yScale.bandwidth() / 2)\n     .attr(\"dy\", \".35em\")\n     .attr(\"text-anchor\", \"end\")\n     .text(d => d.instructor)\n     .style(\"font-size\", \"10px\");\n\n  // Append departments\n  svg.selectAll(\".label-department\")\n     .data(aggregatedData)\n     .enter().append(\"text\")\n     .attr(\"class\", \"label-department\")\n     .attr(\"x\", departmentXPosition)\n     .attr(\"y\", d => yScale(d.instructor) + yScale.bandwidth() / 2)\n     .attr(\"dy\", \".35em\")\n     .attr(\"text-anchor\", \"start\")\n     .text(d => d.ins_dept)\n     .style(\"font-size\", \"10px\");\n  \n  // Append roles\n  svg.selectAll(\".label-role\")\n     .data(aggregatedData)\n     .enter().append(\"text\")\n     .attr(\"class\", \"label-role\")\n     .attr(\"x\", roleXPosition)\n     .attr(\"y\", d => yScale(d.instructor) + yScale.bandwidth() / 2)\n     .attr(\"dy\", \".35em\")\n     .attr(\"text-anchor\", \"middle\")\n     .text(d => `(${d.ins_role})`)\n     .style(\"font-size\", \"10px\");\n\n  // Define legend data\n  const legendData = [\n    { color: \"skyblue\", label: \"Total Hours\" },\n    { color: \"blue\", label: \"Lecture Hours\" },\n    { color: \"lightgreen\", label: \"Total Workload\" },\n    { color: \"green\", label: \"Lecture Workload\" }\n  ];\n\n  // Legend configuration\n  const legendMargin = { top: 10, right: 160, bottom: 10, left: 10 };\n  const legendRectSize = 15; // size of the legend color box\n  const legendSpacing = 4; // spacing between color box and text\n  \n  // Create a group for the legend\n  const legend = svg.append(\"g\")\n    .attr(\"class\", \"legend\")\n    .attr(\"transform\", `translate(${width - legendMargin.right}, ${legendMargin.top})`);\n  \n  // Add legend items\n  legend.selectAll(\".legend-item\")\n    .data(legendData)\n    .enter().append(\"g\")\n    .attr(\"class\", \"legend-item\")\n    .attr(\"transform\", (d, i) => `translate(0, ${i * (legendRectSize + legendSpacing)})`)\n    .each(function(d) {\n  // Add color box\n  d3.select(this).append(\"rect\")\n    .attr(\"width\", legendRectSize)\n    .attr(\"height\", legendRectSize)\n    .style(\"fill\", d.color);\n\n  // Add text label\n  d3.select(this).append(\"text\")\n    .attr(\"x\", legendRectSize + legendSpacing)\n    .attr(\"y\", legendRectSize - legendSpacing)\n    .text(d.label);\n  });\n\n  // Initial current state object\n  let currentState = {\n    sortCriterion: null,\n    sortOrderAscending: true,\n    selectedDepartments: new Set(),\n    selectedRoles: new Set()\n  };\n  \n  // Sort helper functions\n  const sortAscending = criterion => (a, b) => d3.ascending(a[criterion], b[criterion]);\n  const sortDescending = criterion => (a, b) => d3.descending(a[criterion], b[criterion]);\n\n   function sortData(criterion, ascending) {\n    currentState.sortCriterion = criterion;\n    currentState.sortOrderAscending = ascending;\n    applyCurrentState();\n  }\n\n    // Function to update filtering state and apply changes\n  function filterData() {\n    currentState.selectedDepartments = new Set(\n      d3.selectAll(\".dept-filter:checked\").nodes().map(d => d.value)\n    );\n\n    currentState.selectedRoles = new Set(\n      d3.selectAll(\".role-filter:checked\").nodes().map(d => d.value)\n    ); \n    \n    applyCurrentState();\n  }\n\n  // Function to update bars\n  function updateBars(selector, data, xScale, fillColor, transition, isRightSide) {\n      let bars = svg.selectAll(selector)\n          .data(data, d => d.instructor);\n  \n      // Enter and Update selections\n      bars.enter().append(\"rect\")\n          .attr(\"class\", selector.replace('.', ''))\n          .attr(\"fill\", fillColor)\n          .merge(bars) // Merging enter and update selections\n          .transition(transition)\n          .attr(\"x\", d => isRightSide ? width / 2 : xScale(d.total_hours))\n          .attr(\"y\", d => yScale(d.instructor))\n          .attr(\"width\", d => isRightSide ? xScale(d.total_workload) - (width / 2) : (width / 2 - middleGap) - xScale(d.total_hours))\n          .attr(\"height\", yScale.bandwidth());\n  \n      // Exit selection\n      bars.exit().remove();\n  }\n  \n  // Function to update labels\n  function updateLabels(selector, data, xPos, textAccessor, transition) {\n      let labels = svg.selectAll(selector)\n                      .data(data, d => d.instructor);\n  \n      labels.enter().append(\"text\")\n          .attr(\"class\", selector.substring(1)) \n          .merge(labels)\n          .transition(transition)\n          .attr(\"x\", xPos)\n          .attr(\"y\", d => yScale(d.instructor) + yScale.bandwidth() / 2)\n          .attr(\"dy\", \".35em\")\n          .text(textAccessor);\n     labels.exit().remove();\n  }\n  \n function updateChart(displayData) {\n    // Update yScale domain based on new data order\n    const barHeight = 10;  // Fixed height for each bar\n    const totalHeight = displayData.length * barHeight;  // Total height based on number of data points\n  \n    // Update yScale's range and domain\n    yScale.range([0, totalHeight])\n          .domain(displayData.map(d => d.instructor))\n          .padding(0.1);\n  \n    // Adjust SVG container to the new height\n    svg.attr(\"height\", totalHeight)\n       .attr(\"viewBox\", [0, 0, width, totalHeight]);\n\n  \n    // Transition for bars and labels\n    const t = svg.transition().duration(500);\n\n    // Update chart elements in updateChart function\n    updateBars(\".bar-total-hours\", displayData, xScaleLeft, \"skyblue\", t, false);  // Left side bar\n    updateBars(\".bar-lec-hours\", displayData, xScaleLeft, \"blue\", t, false);      // Left side bar\n    updateBars(\".bar-total-workload\", displayData, xScaleRight, \"lightgreen\", t, true); // Right side bar\n    updateBars(\".bar-lec-workload\", displayData, xScaleRight, \"green\", t, true);   // Right side bar\n     \n    // Update labels\n    updateLabels(\".label-instructor\", displayData, instructorXPosition, d => d.instructor, t);\n    updateLabels(\".label-department\", displayData, departmentXPosition, d => d.ins_dept, t);\n    updateLabels(\".label-role\", displayData, roleXPosition, d => `(${d.ins_role})`, t);\n\n\n    // Select and bind data for total hours bars\n    let barsTotalHours = svg.selectAll(\".bar-total-hours\")\n                            .data(displayData, d => d.instructor);\n    \n    // Enter + Update Selection for total hours bars\n    barsTotalHours.enter().append(\"rect\")\n        .attr(\"class\", \"bar-total-hours\")\n        // Initial attributes for new elements\n        .attr(\"fill\", \"skyblue\")\n        .merge(barsTotalHours) // Merging enter and update selections\n        // Add mouse event\n        .on(\"mouseover\", function(event, d) {\n            let format = d3.format(\".2f\");\n            tooltip.transition()\n                .duration(200)\n                .style(\"opacity\", .9);\n            tooltip.html(`\n                <div class=\"tooltip-content\">\n                    <strong>${d.instructor}</strong><br>\n                    <span class=\"tooltip-text\">Total Hours: ${format(d.total_hours)}</span><br>\n                    <ul>${d.courses.map(course => `<li>${course}</li>`).join('')}</ul>\n                </div>\n            `)\n                .style(\"left\", (event.pageX + 5) + \"px\")\n                .style(\"top\", (event.pageY - 28) + \"px\");\n        })\n        .on(\"mouseout\", function() {\n            tooltip.transition()\n                .duration(500)\n                .style(\"opacity\", 0);\n        })\n        .transition(t)\n        .attr(\"x\", d => xScaleLeft(d.total_hours))\n        .attr(\"y\", d => yScale(d.instructor))\n        .attr(\"width\", d => (width / 2 - middleGap) - xScaleLeft(d.total_hours))\n        .attr(\"height\", yScale.bandwidth());\n    \n    // Exit Selection for total hours bars\n    barsTotalHours.exit().remove();\n\n    \n    // Select and bind data for lecture hours bars\n    let barsLectureHours = svg.selectAll(\".bar-lec-hours\")\n                              .data(displayData, d => d.instructor);\n      \n      // Enter + Update Selection for lecture hours bars\n      barsLectureHours.enter().append(\"rect\")\n          .attr(\"class\", \"bar-lec-hours\")\n          .attr(\"fill\", \"blue\")\n          .merge(barsLectureHours)\n          // add mouse event\n          .on(\"mouseover\", function(event, d) {\n              let format = d3.format(\".2f\");\n              tooltip.transition()\n                  .duration(200)\n                  .style(\"opacity\", .9);\n              tooltip.html(`\n                <div class=\"tooltip-content\">\n                    <strong>${d.instructor}</strong><br>\n                    <span class=\"tooltip-text\">Lecture Hours: ${format(d.lec_hours)}</span><br>\n                    <ul>${d.courses.map(course => `<li>${course}</li>`).join('')}</ul>\n                </div>\n              `)\n                  .style(\"left\", (event.pageX + 5) + \"px\")\n                  .style(\"top\", (event.pageY - 28) + \"px\");\n          })\n          .on(\"mouseout\", function() {\n              tooltip.transition()\n                  .duration(500)\n                  .style(\"opacity\", 0);\n          })\n          .transition(t)\n          .attr(\"x\", d => xScaleLeft(d.lec_hours))\n          .attr(\"y\", d => yScale(d.instructor))\n          .attr(\"width\", d => (width / 2 - middleGap) - xScaleLeft(d.lec_hours))\n          .attr(\"height\", yScale.bandwidth());\n          \n      \n      // Exit Selection for lecture hours bars\n      barsLectureHours.exit().remove();\n\n    \n   let barsTotalWorkload = svg.selectAll(\".bar-total-workload\")\n                       .data(displayData, d => d.instructor);\n\n      barsTotalWorkload.enter().append(\"rect\")\n          .merge(barsTotalWorkload)\n          .attr(\"class\", \"bar-total-workload\")\n          .attr(\"x\", width / 2)\n          .attr(\"y\", d => yScale(d.instructor))\n          .attr(\"width\", d => Math.max(1, xScaleRight(d.total_workload) - (width / 2 + middleGap)))\n          .attr(\"height\", yScale.bandwidth())\n          .attr(\"fill\", \"lightgreen\")\n            // Add mouse event\n          .on(\"mouseover\", function(event, d) {\n              let format = d3.format(\".2f\");\n              tooltip.transition()\n                  .duration(200)\n                  .style(\"opacity\", 0.9);\n              tooltip.html(`\n                <div class=\"tooltip-content\">\n                    <strong>${d.instructor}</strong><br>\n                    <span class=\"tooltip-text\">Total Workload: ${format(d.total_workload)}</span><br>\n                    <ul>${d.courses.map(course => `<li>${course}</li>`).join('')}</ul>\n                </div>\n              `)\n                  .style(\"left\", (event.pageX + 10) + \"px\")\n                  .style(\"top\", (event.pageY - 15) + \"px\");\n          })\n          .on(\"mouseout\", function() {\n              tooltip.transition()\n                  .duration(500)\n                  .style(\"opacity\", 0);\n          });\n            \n      barsTotalWorkload.transition(t)\n          .attr(\"y\", d => yScale(d.instructor))\n          .attr(\"width\", d => Math.max(1, xScaleRight(d.total_workload) - (width / 2 + middleGap)));\n      \n      barsTotalWorkload.exit().remove();\n\n   let barsLectureWorkload = svg.selectAll(\".bar-lec-workload\")\n                             .data(displayData, d => d.instructor);\n      \n      barsLectureWorkload.enter().append(\"rect\")\n          .attr(\"class\", \"bar-lec-workload\")\n          .merge(barsLectureWorkload)\n          .attr(\"x\", width / 2)\n          .attr(\"y\", d => yScale(d.instructor))\n          .attr(\"width\", d => Math.max(1, xScaleRight(d.lec_workload) - (width / 2 + middleGap)))\n          .attr(\"height\", yScale.bandwidth())\n          .attr(\"fill\", \"green\")\n            // Add mouse event\n          .on(\"mouseover\", function(event, d) {\n              let format = d3.format(\".2f\");\n              tooltip.transition()\n                  .duration(200)\n                  .style(\"opacity\", 0.9);\n              tooltip.html(`\n                <div class=\"tooltip-content\">\n                    <strong>${d.instructor}</strong><br>\n                    <span class=\"tooltip-text\"> Lecture Workload: ${format(d.lec_workload)}</span><br>\n                    <ul>${d.courses.map(course => `<li>${course}</li>`).join('')}</ul>\n                </div>\n              `)\n                  .style(\"left\", (event.pageX + 10) + \"px\")\n                  .style(\"top\", (event.pageY - 15) + \"px\");\n          })\n          .on(\"mouseout\", function() {\n              tooltip.transition()\n                  .duration(500)\n                  .style(\"opacity\", 0);\n          });\n      \n      barsLectureWorkload.transition(t)\n          .attr(\"y\", d => yScale(d.instructor))\n          .attr(\"width\", d => Math.max(1, xScaleRight(d.lec_workload) - (width / 2 + middleGap)));\n      \n      barsLectureWorkload.exit().remove();\n\n    // Update instructor labels\n   let instructorLabels = svg.selectAll(\".label-instructor\")\n                          .data(displayData, d => d.instructor);\n\n      instructorLabels.enter().append(\"text\")\n          .attr(\"class\", \"label-instructor\")\n          .merge(instructorLabels) // merge enter and update selections\n          .transition(t)\n          .attr(\"x\", instructorXPosition)\n          .attr(\"y\", d => yScale(d.instructor) + yScale.bandwidth() / 2)\n          .attr(\"dy\", \".35em\")\n          .attr(\"text-anchor\", \"end\")\n          .text(d => d.instructor)\n          .style(\"font-size\", \"10px\");\n      \n      instructorLabels.exit().remove();\n    \n    // Update department labels\n    let departmentLabels = svg.selectAll(\".label-department\")\n                              .data(displayData, d => d.instructor);\n    \n      departmentLabels.enter().append(\"text\")\n          .attr(\"class\", \"label-department\")\n          .merge(departmentLabels) \n          .transition(t)\n          .attr(\"x\", departmentXPosition)\n          .attr(\"y\", d => yScale(d.instructor) + yScale.bandwidth() / 2)\n          .attr(\"dy\", \".35em\")\n          .attr(\"text-anchor\", \"start\")\n          .text(d => d.ins_dept)\n          .style(\"font-size\", \"10px\");\n      \n      departmentLabels.exit().remove();\n    \n        \n    // Update role labels\n    let roleLabels = svg.selectAll(\".label-role\")\n                    .data(displayData, d => d.instructor);\n\n      roleLabels.enter().append(\"text\")\n          .attr(\"class\", \"label-role\")\n          .merge(roleLabels) \n          .transition(t)\n          .attr(\"x\", roleXPosition)\n          .attr(\"y\", d => yScale(d.instructor) + yScale.bandwidth() / 2)\n          .attr(\"dy\", \".35em\")\n          .attr(\"text-anchor\", \"middle\")\n          .text(d => `(${d.ins_role})`)\n          .style(\"font-size\", \"10px\");\n      \n      roleLabels.exit().remove();\n\n }\n\n  // Attach event listeners to filter checkboxes\n  d3.selectAll(\".dept-filter, .role-filter\").on(\"change\", filterData);\n\n    // Function to apply sorting and filtering\n  function applyCurrentState() {\n    // Apply filter first\n    let displayData = aggregatedData.filter(d => \n      (currentState.selectedDepartments.size === 0 || currentState.selectedDepartments.has(d.ins_dept)) &&\n      (currentState.selectedRoles.size === 0 || currentState.selectedRoles.has(d.ins_role))\n    );\n  \n    // Then apply sorting\n    if (currentState.sortCriterion) {\n      const sortFunction = currentState.sortOrderAscending\n        ? sortAscending(currentState.sortCriterion)\n        : sortDescending(currentState.sortCriterion);\n      displayData.sort(sortFunction);\n    }\n  \n    // Update the chart with the filtered and sorted data\n    updateChart(displayData);\n  }\n  \n  // Initial rendering of the chart\n  applyCurrentState();\n  \n   // Attach event listeners to buttons\n  function attachSortButtonListeners() {\n\n    d3.select(\"#sortTotalHoursAsc\").on(\"click\", () => sortData(\"total_hours\", true));\n    d3.select(\"#sortTotalHoursDesc\").on(\"click\", () => sortData(\"total_hours\", false));\n  \n    d3.select(\"#sortLectureHoursAsc\").on(\"click\", () => sortData(\"lec_hours\", true));\n    d3.select(\"#sortLectureHoursDesc\").on(\"click\", () => sortData(\"lec_hours\", false));\n      \n    d3.select(\"#sortTotalWorkloadAsc\").on(\"click\", () => sortData(\"total_workload\", true));\n    d3.select(\"#sortTotalWorkloadDesc\").on(\"click\", () => sortData(\"total_workload\", false));\n\n    d3.select(\"#sortLectureWorkloadAsc\").on(\"click\", () => sortData(\"lec_workload\", true));\n    d3.select(\"#sortLectureWorkloadDesc\").on(\"click\", () => sortData(\"lec_workload\", false));\n\n    d3.select(\"#sortAlphabetAsc\").on(\"click\", () => sortData(\"instructor\", true));\n    d3.select(\"#sortAlphabetDesc\").on(\"click\", () => sortData(\"instructor\", false));\n  }\n    attachSortButtonListeners();\n  \n  // Return the SVG node\n  return svg.node();\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nIf sorting by criteria other than the alphabet isn’t working correctly, you should check the following areas in your code:\n\nSorting Criteria Matching: Ensure that the sorting criteria you pass to the sortData function match the actual properties in your data objects. For example, if you’re sorting by total_hours, the property in your data objects must be exactly total_hours, not totalHours or any other variation.\nData Type: Ensure that the data you’re trying to sort is in the correct type. For example, numerical data should be sorted as numbers, not as strings. If the data is in string format, it may sort incorrectly. You might need to convert string representations of numbers to actual numbers before sorting.\nSorting Function Logic: Verify that your sorting functions sortAscending and sortDescending are implemented correctly. They should be able to compare any two data points based on the specified criterion correctly.\nCheck the sortData function: Ensure that this function is correctly setting the sortCriterion and sortOrderAscending in your currentState object, and that it’s calling applyCurrentState or similar function to re-render the chart based on the new sorting order.\n\nHere’s a basic outline of what the relevant parts of the code might look like:\n// Sort helper functions\nconst sortAscending = criterion => (a, b) => d3.ascending(a[criterion], b[criterion]);\nconst sortDescending = criterion => (a, b) => d3.descending(a[criterion], b[criterion]);\n\nfunction sortData(criterion, ascending) {\n  currentState.sortCriterion = criterion;\n  currentState.sortOrderAscending = ascending;\n  applyCurrentState();\n}\n\nfunction applyCurrentState() {\n  let displayData = aggregatedData.filter(d => \n    (currentState.selectedDepartments.size === 0 || currentState.selectedDepartments.has(d.ins_dept)) &&\n    (currentState.selectedRoles.size === 0 || currentState.selectedRoles.has(d.ins_role))\n  );\n\n  if (currentState.sortCriterion) {\n    const sortFunction = currentState.sortOrderAscending\n      ? sortAscending(currentState.sortCriterion)\n      : sortDescending(currentState.sortCriterion);\n    displayData.sort(sortFunction);\n  }\n\n  updateChart(displayData);\n}\nCheck the following in the above code:\n\nThe criterion parameter in the sortData function exactly matches the property names in your data objects.\nThe sortAscending and sortDescending functions are being called with the correct criterion.\nThe applyCurrentState function effectively sorts and then updates the chart.\n\nIf these are all correct and the issue persists, you may need to debug further by logging the intermediate steps and outputs to ensure the data is being manipulated as expected at each stage."
  },
  {
    "objectID": "test-button.html",
    "href": "test-button.html",
    "title": "Sort Button Test",
    "section": "",
    "text": "Sort by:   Total Hours Lecture Hours Total Workload Lecture Workload Alphabet \n\n\n▲\n\n\n▼"
  }
]